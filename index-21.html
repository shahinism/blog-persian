<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="wot-verification" content="1e0ce5594a67af53269c">
<base href="https://5hah.in/index-21.html">
<meta name="description" content="Sometimes you gotta run before you can walk">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>شاهین (old posts, page 21) | شاهین</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://5hah.in/index-21.html">
<link rel="prev" href="index-22.html" type="text/html">
<link rel="next" href="index-20.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
  <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

  <div class="navigator">
    
  </div>

  <nav class="navbar navbar-default"><div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="."><img src="assets/images/logo.png"></a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
<li>
<a href="stories/about-me">درباره</a>
                </li>
<li>
<a href="docs/resume.pdf">رزومه</a>
                </li>
<li>
<a href="archive.html">آرشیو</a>
                </li>
<li>
<a href="categories/">دسته‌ها</a>
                </li>
<li>
<a href="rss.xml">خوراک</a>

                    
        </li>
</ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container-fluid -->
  </nav><div class="jumbotron">
    <section class="container"><div id="headerbox" class="col-md-6 col-md-offset-3 text-center">
        <h1>شاهین</h1>
        <hr class="hdrline">
<a class="social" href="https://github.com/shahinism">
          <img src="assets/images/github.png"></a>
        <a class="social" href="https://twitter.com/shahinism">
          <img src="assets/images/twitter.png"></a>
        <a class="social" href="https://ir.linkedin.com/in/shahinism">
          <img src="assets/images/linkedin.png"></a>
      </div>
    </section>
</div>

  <div class="container" id="content" role="main">
    <!--Body content-->
    <div class="col-md-6 col-md-offset-3">
      <div class="row">
        
<div class="postindex">
    <article class="h-entry post-text"><div class="text-center">

        <h1 class="p-name entry-title"><a href="posts/wp/chtwr-z-wbstgy-bh-gythb-frr-khnym-p/" class="u-url">چطور از وابستگی به گیت‌هاب فرار کنیم: پشتیبان‌گیری از مخازن گیت</a></h1>
            شاهین
      <a href="posts/wp/chtwr-z-wbstgy-bh-gythb-frr-khnym-p/" rel="bookmark"><time class="published dt-published" datetime="2013-01-22T22:22:49+03:30" title="2013-01-22 22:22">2013-01-22 22:22</time></a>
    </div>
    <div class="e-content entry-content">
    <div>
<p></p>
<blockquote>
<p>یکی از نکاتی که قطعی‌های اخیر گیت‌هاب گوشزد می‌کنند این است که گیت به عنوان یک سیستم مدیریت نسخهٔ غیر متمرکز طراحی شده. بسیاری از مردم به این صورت آن را مورد استفاده قرار نمی‌دهند. به جای داشتن چند بایگانی راه دور‌، داده‌ها را به یک جا می‌فرستند و در اصل بیش از اندازه به گیت‌هاب تکیه می‌کنند. کسانی را دیده‌ام که کل سازمان‌شان را بر پایهٔ گیت‌هاب بنا کرده‌اند‌، چیز‌هایی نظیر گسترش اسکریپت‌های سایت‌شان و نصب اسکریپ‌ها برای توسعه دهندگان جدید‌شان. علاوه بر این‌، dependency manager‌هایی مثل Composer و Cocoapods نیز به گیت‌هاب وابسته‌اند تا پیش‌نیاز‌هایشان را دریافت کنند. اگر گیت‌هاب Down شود‌، شما نمی‌توانید پیش‌نیاز‌های‌تان را دستکاری کنید و یا نمونه‌های جدید‌تری به آن‌ها اضافه کنید. در یک دنیای ایده‌آل این Dependency manager‌ها باید قابلیت‌ پشتیبانی توکار از mirror‌ها را داشته باشند‌، ولی در حال حاضر من چنین قابلیت‌هایی را نمی‌بینم.</p>
<p>چیزی که من می‌خواهم انجام دهم این است که نشان‌تان دهم که چقدر آسان است که با استفاده از سرور‌های راه دور گیت در آن واحد به دو سرور مختلف داده‌های‌تان را ارسال کنید. اگر گیت‌هاب Down شد‌، مهم نیست‌، بر فرض این که همه افراد تیم‌تان از این راهنما پیروی کرده باشند‌، کد از طریق bitbucket نیز در دسترس خواهد بود‌، یا هر جای دیگری که شما انتخاب کرده‌اید. اما این راهنما از گیت‌هاب و بیت‌باکت به عنوان mirror استفاده می‌کند.</p>
<ol>
<li>اول فرض می‌کنم که شما یک سرور راه دور برای گیت‌هاب به عنوان "origin" ایجاد کرده‌اید. آن را به github تغییر نام دهید:</li>
</ol>
<pre class="code literal-block"><span></span>git remote rename origin github
</pre>


<ol>
<li>
<p>یک مخزن جدید روی بیت‌باکت هم‌نام همان چیزی که در گیت‌هاب دارید بسازید.</p>
</li>
<li>
<p>این مخزن جدید را به صورت زیر به سرور‌های راه دور‌تان اضافه کنید. ولی مطمئن باشید که اسمش bitbucket باشد و نه origin. این‌طور:</p>
</li>
</ol>
<pre class="code literal-block"><span></span>git remote add bitbucket ssh://git@bitbucket.org/username/somerepo.git

git push -u bitbucket --all
</pre>


<ol>
<li>
<p>و حالا با یک ادیتور از شاخهٔ ‎.git در مخزن گیت‌تان فایل config را باز کنید.</p>
</li>
<li>
<p>نوبت این است که url‌های مربوط به هر سرور راه دور را به مجموعهٔ جدیدی به اسم origin اضافه کنیم. می‌شود چیزی شبیه این:</p>
</li>
</ol>
<pre class="code literal-block"><span></span><span class="o">[</span>remote <span class="s2">"origin"</span><span class="o">]</span>

<span class="nv">url</span> <span class="o">=</span> git@github.com:username/somerepo.git

<span class="nv">url</span> <span class="o">=</span> ssh://git@bitbucket.org/username/somerepo.git
</pre>


<ol>
<li>دفعهٔ بعد که از دستور git push origin استفاده کردید‌، مخزن در هر دو سرور راه دور آپلود خواهد شد.</li>
</ol>
<p>به همین راحتی.</p>
<p>نسخه‌های اخیر گیت این اجازه را به شما می‌دهند که چند جا را به عنوان مخزن راه دور یک مجموعه معرفی کنید. ولی من ترجیح می‌دهم که ببینم چه کاری انجام می‌دهم.</p>
</blockquote>

<p><strong>نکته از شاهینیسم:</strong> بهتر است از یک public-key برای گیت‌هاب و بیت‌باکت استفاده کنید. این‌طوری مرحلهٔ شناسایی هر دو سرور مثل هم خواهد بود ;-)</p>
</div>
    </div>

    <div class="text-center">
                    <a class="btn btn-success" href="posts/wp/chtwr-z-wbstgy-bh-gythb-frr-khnym-p/#disqus_thread" data-disqus-identifier="cache/posts/wp/chtwr-z-wbstgy-bh-gythb-frr-khnym-p.html">Comments</a>


    </div>

    </article><article class="h-entry post-text"><div class="text-center">

        <h1 class="p-name entry-title"><a href="posts/wp/expect-dstyr-bhwsh-shm-dr-shl-skhrypth/" class="u-url">expect دستیار باهوش شما در شل اسکریپت‌ها!</a></h1>
            شاهین
      <a href="posts/wp/expect-dstyr-bhwsh-shm-dr-shl-skhrypth/" rel="bookmark"><time class="published dt-published" datetime="2013-01-10T22:33:39+03:30" title="2013-01-10 22:33">2013-01-10 22:33</time></a>
    </div>
    <div class="e-content entry-content">
    <div>
<p>اگر تا به حال شل اسکریپت نوشته باشید‌، اگر حد اعتیادتان به آن اندازه باشد که بخواهید هر کاری را آسان‌تر کنید‌، اگر تنبلی‌تان گرفته باشد که بعد از آسان شدن کار‌هایتان با یک شل اسکریپت‌، رمز‌های جاهای مختلف را به یاد آورید تا اسکریپت‌تان درست کار کند‌‌، یا آن‌قدر به مغزتان فشار آورید که جواب صحیح یک سوال اسکریپت را پیدا کنید‌، آن وقت‌ می‌توانید درک کنید که expect چه ابزار خارق‌العاده‌ای است.</p>
<p>کار expect خیلی ساده است‌، بعد از اجرای اسکریپت‌تان‌، منتظر می‌ماند که اتفاق خاصی رخ دهد‌، مثلا دستوری در اسکریپت از شما رمز بخواهد‌، آن وقت expect وارد میدان می‌شود و رمز را وارد می‌کند. یعنی دیگر نیازی نیست که شما دخالتی داشته باشید. اگر فکر می‌کنید که خوب این که کار سختی نیست و از این حرف‌ها که خوب اول باید بگویم که کور خوانده‌اید و دوم این که بی‌خیال ادامهٔ این متن شوید ;-)</p>
<p>حالا شیوهٔ عملکرد expect معلوم شد‌، بهتر است نگاهی بیاندازیم به وضعیت من. بنا به دلایل کاملا غیر عادی و نامعلومی‌، در کشوری کاملا آزاد‌، نیاز دارم که از sshuttle برای انجام برخی امور استفاده کنم. این برنامه برای انجام دادن درست کار‌هایش‌، نیاز به iptables دارد که خوب من دوست ندارم که کاربر عادی‌ام به آن دسترسی داشته باشد. پس همین دوست نداشتن من یک مرحلهٔ اضافه در فرآیند استفاده از sshuttle هزینه دارد. یعنی یک همچین چیزی:</p>
<pre class="code literal-block"><span></span>su

Vared Kardan Ramz

<span class="nb">cd</span> /home/shahin/bin/sshutle

./sshuttle ...

Vared Kardan Ramz
</pre>


<p>که خوب بعد از اولین تلاش کانکت نمی‌شود و باید دوباره دستور را بزنم و منتظر بمانم تا پرامپت رمز ssh ظاهر شود و باقی قضایا. خوب کمی سخت است. البته این را هم اضافه کنم که خوب می‌دانم می‌توانم کانکت بدون رمز ssh داشته باشم‌. می‌توانم دستور را درون یک path قرار دهم. می‌توانم‌، می‌توانم‌… ولی این روشی است که من کار می‌کنم ;-)</p>
<p>این است که دست به دامن expect می‌شوم و همچین اسکریپتی می‌نویسم:</p>
<pre class="code literal-block"><span></span><span class="ch">#!/usr/bin/expect -f</span>



<span class="k">if</span> <span class="o">{[</span>llength <span class="nv">$argv</span><span class="o">]</span> !<span class="o">=</span> 5<span class="o">}</span> <span class="o">{</span>
    puts <span class="s2">"usage: ssh.exp client_root_pass username password server port"</span>
<span class="nb">exit</span> 1

<span class="o">}</span>



<span class="nb">set</span> rootpass <span class="o">[</span>lrange <span class="nv">$argv</span> <span class="m">0</span> 0<span class="o">]</span>

<span class="nb">set</span> username <span class="o">[</span>lrange <span class="nv">$argv</span> <span class="m">1</span> 1<span class="o">]</span>

<span class="nb">set</span> password <span class="o">[</span>lrange <span class="nv">$argv</span> <span class="m">2</span> 2<span class="o">]</span>

<span class="nb">set</span> server <span class="o">[</span>lrange <span class="nv">$argv</span> <span class="m">3</span> 3<span class="o">]</span>

<span class="nb">set</span> port <span class="o">[</span>lrange <span class="nv">$argv</span> <span class="m">4</span> 4<span class="o">]</span>



<span class="nb">set</span> timeout -1



spawn su -c <span class="s2">"/home/shahin/bin/sshuttle/sshuttle --dns -r </span><span class="nv">$username</span><span class="s2">@</span><span class="nv">$server</span><span class="s2">:</span><span class="nv">$port</span><span class="s2"> 0/0 -vv"</span>

match_max 100000

expect <span class="s2">"Password:*"</span>

send -- <span class="s2">"</span><span class="nv">$rootpass</span><span class="s2">\r"</span>



expect <span class="s2">"*?assword:*"</span>

send -- <span class="s2">"</span><span class="nv">$password</span><span class="s2">\r"</span>

send -- <span class="s2">"\r"</span>

expect eof
</pre>


<p>حالا همانطور که معلوم است کافی است همچین دستوری را تایپ کنم:</p>
<pre class="code literal-block"><span></span>./ssh.exp client_root_pass username password server port
</pre>


<p>حالا می‌شود این اسکریپت را بدون هیچ ضرر اضافه‌ای به path اضافه کرد و حالش را برد. برای این که بفهمید این اسکریپت چطور کار می‌کند راهنما‌های زیادی در اینترنت می‌یابید. man page خود برنامه هم می‌تواند کمک خوبی باشد. ضمن این که اگر اسکریپت نویسی بدانید‌، چیز زیادی برای یاد گرفتن پیش‌رویتان نیست ;-)</p>
</div>
    </div>

    <div class="text-center">
                    <a class="btn btn-success" href="posts/wp/expect-dstyr-bhwsh-shm-dr-shl-skhrypth/#disqus_thread" data-disqus-identifier="cache/posts/wp/expect-dstyr-bhwsh-shm-dr-shl-skhrypth.html">Comments</a>


    </div>

    </article><article class="h-entry post-text"><div class="text-center">

        <h1 class="p-name entry-title"><a href="posts/wp/6-sl-blg-nwsy/" class="u-url">۶ سال شاهینیسم</a></h1>
            شاهین
      <a href="posts/wp/6-sl-blg-nwsy/" rel="bookmark"><time class="published dt-published" datetime="2013-01-02T09:28:12+03:30" title="2013-01-02 09:28">2013-01-02 09:28</time></a>
    </div>
    <div class="e-content entry-content">
    <div>
<p>دیگر شاهین‌، شاهین قبلی نبود. نمی‌توانست باشد. همانطور که می‌خواست شده بود. آن‌هایی که نوشته‌هایش را می‌خواندند می‌دید. یاد گرفته بود به حرف‌شان بیاورد. خیلی‌هاشان مثل اطرافیانم در دنیای واقعی بودند. با همان بچه بازی‌ها. با همان نق نق‌ها. خیلی‌های دیگر عدایش را در می‌آوردند که مثلا بهترند. اما خیلی‌ها هم بودند که واقعا عالی بودند. از آن‌هایی که آرزو می‌کنی یک ساعت کنارشان بنشینی و گپ بزنی. از آن‌هایی که دوست داری اجتماعت باشند.</p>
<p>امروز دیگر شاهین‌، منی شده که دارد سعی می‌کند نقابش را بردارد. هر چند خوب می‌داند که… . به هر حال‌، شش سال شد. شش سال تغییرم مبارک ;-)</p>
</div>
    </div>

    <div class="text-center">
                    <a class="btn btn-success" href="posts/wp/6-sl-blg-nwsy/#disqus_thread" data-disqus-identifier="cache/posts/wp/6-sl-blg-nwsy.html">Comments</a>


    </div>

    </article><article class="h-entry post-text"><div class="text-center">

        <h1 class="p-name entry-title"><a href="posts/wp/twlyd-khwdkhr-flsh-khrt-nglysy-bh-frsy/" class="u-url">تولید خودکار فلش کارت انگلیسی به فارسی برای Anki با کمی شل اسکریپت</a></h1>
            شاهین
      <a href="posts/wp/twlyd-khwdkhr-flsh-khrt-nglysy-bh-frsy/" rel="bookmark"><time class="published dt-published" datetime="2012-12-13T21:24:31+03:30" title="2012-12-13 21:24">2012-12-13 21:24</time></a>
    </div>
    <div class="e-content entry-content">
    <div>
<p>ولی خوب‌، ایمان هم کالیبرش بالاست‌. شاید هم کمال همنشین… این است که بعد از یک مدتی که خیلی ذوق داشت و همه مدل فلش کارت آماده می‌کرد‌، چون سختش بود‌، کم کم فرمت‌های آماده شده را آنقدر کم کرد که این اواخر دیگر تنها kvtml آماده می‌کرد‌. فرمتی که آماده کردنش خیلی آسان‌تر از باقی قضایا بود‌، ولی مال نرم‌افزار بسیار به درد نخور kwordquiz میزکار KDE بود! این بود که دو سه هفته پیش‌، این ایده به سرم افتاد که اول کمی از کار ایمان کم کنم‌! بندهٔ خدا زحمت زیادی می‌کشد و به هر حال حیف است که فقط مصرف کننده باشم‌. این شد که با پایتون اسکریپتی برایش نوشتم که kvtml‌ها را خیلی راحت به anki تبدیل کند‌. ذکر خیر این اسکریپت را خودش <a title="kvtml 2 anki in emanlog" href="http://emanlog.com/?p=292" target="_blank">کرده‌</a>.</p>
<p>معنی این اسکریپت قبلی این بود که حالا حالاها خوراک اضافه خواهم داشت‌. ولی حقیقتش کلمه‌های ایمان‌، حداقل تا این‌جایی که من دیده‌ام‌، اکثریتشان‌ در سطح من نیست‌. اگر هم باشد من خودم خیلی خیلی بیشتر از آن‌ها را در کتاب‌ها و مطالبی که روزانه می‌خوانم می‌بینم! مساله این‌جاست که از روی تنبلی‌، فقط به زور دیکشنری (mdic روی میزکار، google translate روی اینترنت و mobidic روی موبایل) ترجمه‌شان می‌کنم و بعد از چند جمله معنی‌شان از یادم می‌پرد‌. خسته کننده است‌. این طور نیست؟</p>
<p>خوب کمی با خودم دو دو تا چهارتا می‌کنم و یادم می‌آید که روی آن اسکریپت تبدیل kvtml دوست خوبم anki یک فرمت متنی خیلی تمیزی را به عنوان ورودی می‌گرفت و فلش کارتش می‌کرد‌. (اصلا آن اسکریپت بر همین مبنا کار می‌کند) یک همچین نحوی:</p>
<pre class="code literal-block"><span></span>English<span class="p">;</span>انگلیسی
</pre>


<p>که البته می‌توان بهش فایل‌های چند رسانه‌ای هم چسباند و یا با HTML خوشگلش کرد‌. خوب این یعنی می‌شود هر وقت که کلمه‌ای ترجمه می‌کنم‌، ترمینالم را باز کنم و مثلا از یک همچین دستوری استفاده کنم:</p>
<pre class="code literal-block"><span></span><span class="nb">echo</span> <span class="s2">"English;انگلیسی"</span> <span class="p">&amp;</span>gt<span class="p">;&amp;</span>gt<span class="p">;</span> deck.txt
</pre>


<p>یا شایدم همیشه یک ادیتور زیر دستم باز بگذارم‌! ولی نه فکر کنم همان اولی بهتر است‌ (چون ترمینال در دسترس‌تر است). ولی خوب این این‌قدر‌ها هم خوشگل نیست‌. ضمن این که مثل فلش کارت‌های ایمان صدا و عکس ندارد‌. حالا عکس به کنار‌، تلفظ برای من از نان شب واجب‌تر است‌. بعضی کلمات آن‌قدر به چشمم سخت می‌آیند که اصلا نمی‌خوانمشان D:</p>
<p>خوب تلفظ را هم می‌شود مشکلش را با espeak حل کرد‌ (هر چند صدای روباتیکش خیلی نچسب است!). جهنم‌، شروع می‌کنم به نوشتن یک اسکریپت‌. این ایده‌، در میانهٔ راه آن‌قدر این در و آن در می‌خورد‌. آن‌قدر از ابزار‌ها و وسایلی که بقیه نوشته‌اند توش استفاده می‌شود که می‌شود اسکریپتی که اگر اینترنت دم دستش باشد‌، خودش عبارت وارد شده را با استفاده از google translate ترجمه می‌کند و تلفظ google translate را می‌چسباند تنگش و کار را تمام می‌کند‌.</p>
<p>چون می‌دانم همه حوصلهٔ خواندن نکات فنی اسکریپت را ندارند‌، این پست را در دو بخش می‌نویسم‌. بخش اول‌، برای کاربرانی که فقط می‌خواهند از آن استفاده کنند‌، و بخش دوم برای اشاره به نکات فنی کار ;-)</p>
<p></p>
<h5>معرفی:</h5>
<p>این اسکریپت برای اجرا به fribidi, ffmpeg, curl و html2text نیاز دارد‌. سه تای اول که عموما وضع و حال‌شان مشخص است‌. اما این آخری یک اسکریپت پایتون است که می‌توانید از مخازن‌تان نصب کنید‌. ولی من پیشنهاد می‌کنم به جای آن distribute یا pysetuptools پایتون را نصب کنید و پس از آن با دستور زیر سر و ته این اسکریپت را هم بیاورید:</p>
<pre class="code literal-block"><span></span>sudo pip install html2text
</pre>


<p>دلیلش هم ساده است‌. مخازن پایتون خیلی سریع‌تر از مخازن توزیع‌تان به روز می‌شوند و صد البته در آخر کار مدیریت این بسته‌ها با آن‌ها آسان‌تر است‌! حالا اسکریپت را از <a title="fcgenerator on github" href="https://github.com/shahinism/Scripts/blob/master/Shell/fcgenerator.sh" target="_blank">این‌جا</a> دانلود کنید و به صورت زیر چشم‌تان را به جمالش روشن کنید:</p>
<pre class="code literal-block"><span></span>chmod +x fcgenerator.sh

./fcgenerator.sh -w <span class="s2">"Some english word"</span> -d firstDeck
</pre>


<p>مقدار Some english word که به اپراتور ‎-w نسبت داده شده‌، همان عبارت انگلیسی‌ای است که می‌خواهیم ترجمه‌اش کنیم‌. مقدار firstDeck هم اسم Deckای (مجموعه فلش کارت) که می‌خواهیم این لغت به آن اضافه شود است‌. اگر اینترنت‌تان وصل است که برنامه مثل پلنگ کارش را انجام می‌دهد و فایل‌ها را تولید می‌کند‌. اکر هم نه که می‌توانید به روش‌های دیگری کلمه را اضافه کنید‌.</p>
<p>مثلا فرض کنید که شما از ترجمهٔ google translate حال نمی‌کنید‌. خوب راحت است‌. کافی است که با استفاده از اپراتور ‎-t ترجمهٔ خودتان را به لغت بچسبانید‌. همین‌طور می‌توانید به جای تلفظ گوگل‌، از espeak استفاده کنید‌. برای این کار هم از اپراتور ‎-e استفاده می‌کنید. طرز کارش ساده است‌، این‌طور نیست؟</p>
<p>بعد از اجرای فرمان بالا اسکریپت برای ما یک فایل firstDeck.txt و یک دایرکتوری firstDeck.media ساخته‌. اگر کلمات دیگری هم داشتید و خواستید به این فلش کارت اضافه کنید‌، کافیست به دایرکتوری که این فایل‌ها در آن قرار دارند بروید و فقط مقدار ‎-w دستور را با کلمهٔ جدید‌تان عوض کنید‌.</p>
<p>حالا نوبت نصب Deck جدید‌تان روی Ankiاست‌. اگر Deck‌های شما هم در مسیر ‎~/.anki/decks قرار دارد (اگر توزیع‌تان خوشمزگی نکرده و جای دیگر نریخته باشد‌، بعید می‌دانم این مسیر فرق کند) می‌توانید با دستور زیر دایرکتوری مدیا را در این مسیر کپی کنید:</p>
<pre class="code literal-block"><span></span>./fcgenerator.sh -i firstDeck
</pre>


<p>اگر هم نه که دستی کپی کنید! حالا Anki را باز کنید‌ و از منوی File گزینهٔ Import را انتخاب کنید‌. در قسمت نام Deck همان چیزی را بنویسید که برای اپراتور ‎-d قرار دادید (در این‌جا firstDeck) و سپس فایل firstDeck.txt را به آن بخورانید‌. تمام شد‌. فلش‌کارت‌های جدید‌تان آماده‌اند‌.</p>
<p>طرز کار اسکریپت خیلی ساده است‌. دیگر باقی‌اش به خودتان بستگی دارد که چطور از آن استفاده می‌کنید‌. می‌توانید برای راحتی کار آن را به PATHتان انتقال دهید و یا یک alias برای خیلی راحت‌تر شدنش تعریف کنید‌. یا حتی می‌توانید یک اسکریپت کوچک دیگر بنویسید که برای لیستی از لغات این فرمان را ایجاد کند و به صورت خودکار یک لیست بلند بالا از لغات + ترجمه + تلفظ‌شان داشته باشید‌! البته جنبه هم در کنارش خوب است‌. با Google طرفید‌. همچین هم زیاده روی نکنید که IPتان را به خاطر فرستادن درخواست‌های زیادی بلاک کند‌، یا کلا در گوگل ترنسلیت را گل بگیرد! ها در ضمن‌، می‌توانید با استفاده از ‎-T (به چه زبانی) و ‎-F (از چه زبانی) به جای حالت پیش‌فرض انگلیسی به فارسی از زبان‌های دیگر هم استفاده کنید.</p>
<h5>چطور کار می‌کند؟</h5>

<p>خوب اکثر دستورات اگر سواد شل اسکریپتینگ داشته باشید‌، سر راست‌اند‌. من در این‌جا فقط به چیز‌های جالبی که از کد‌های دیگران بهره گرفتم اشاره می‌کنم‌. یکی از خوشگل‌ترین‌شان برایم این تابع بود:</p>
<pre class="code literal-block"><span></span><span class="k">function</span> deps<span class="o">(){</span>

<span class="nv">DEPENDENCIES</span><span class="o">=</span><span class="nv">$@</span>

<span class="nv">deps_ok</span><span class="o">=</span>YES

<span class="k">for</span> dep in <span class="nv">$DEPENDENCIES</span>

<span class="k">do</span>

<span class="k">if</span> ! which <span class="nv">$dep</span> <span class="p">&amp;</span>amp<span class="p">;&amp;</span>gt<span class="p">;</span>/dev/null<span class="p">;</span> <span class="k">then</span>

<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$dep</span><span class="s2"> is not installed. please install it and try again."</span>

<span class="nv">deps_ok</span><span class="o">=</span>NO

<span class="k">fi</span>

<span class="k">done</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$deps_ok</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"NO"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>

<span class="nb">echo</span> -e <span class="s2">"Unmet dependencies ^"</span>

<span class="nb">echo</span> -e <span class="s2">"Aborting!"</span>

<span class="nb">exit</span> 1

<span class="k">else</span>

<span class="k">return</span> 0

<span class="k">fi</span>

<span class="o">}</span>
</pre>


<p>خوب می‌دانم چیز ساده‌ای است. ولی حقیقتش من عقلم نمی‌رسید که می‌توان به این خوشگلی پیش‌نیاز‌های اسکریپت را بررسی کرد‌. این اسکریپت را از <a title="bash support function check dependencies" href="http://www.snabelb.net/content/bash_support_function_check_dependencies" target="_blank">این لینک</a> برداشتم و کمی دستکاری‌اش کردم تا به اسکریپت من بیاید‌.</p>
<p>بخش بعدی ماجرا‌، هیولا‌ترین قسمت اسکریپت است‌. Google مثل همیشه احمق‌بازی در آورده و ما را از داشتن یک API ساده محروم کرده‌. ولی خوب این مرحمت گوگل باعث نشده که <a title="access google translate from a terminal" href="http://crunchbang.org/forums/viewtopic.php?id=17034" target="_blank">این دوست </a>ندیده و نشنیدهٔ عزیزمان دست از انگولک گوگل و نجات ما بردارد‌.</p>
<pre class="code literal-block"><span></span><span class="nv">result</span><span class="o">=</span><span class="k">$(</span>curl -s -i --user-agent <span class="s2">""</span> -d <span class="s2">"sl=</span><span class="nv">$FROMT</span><span class="s2">"</span> -d <span class="s2">"tl=</span><span class="nv">$TARGETT</span><span class="s2">"</span> --data-urlencode <span class="s2">"text=</span><span class="nv">$WORD</span><span class="s2">"</span> http://translate.google.com<span class="k">)</span>

<span class="nv">encoding</span><span class="o">=</span><span class="k">$(</span>awk <span class="s1">'/Content-Type: .* charset=/ {sub(/^.*charset=["'</span><span class="se">\'</span><span class="s1">']?/,""); sub(/[ "'</span><span class="se">\'</span><span class="s1">'].*$/,""); print}'</span> <span class="p">&amp;</span>lt<span class="p">;&amp;</span>lt<span class="p">;&amp;</span>lt<span class="p">;</span><span class="s2">"</span><span class="nv">$result</span><span class="s2">"</span><span class="k">)</span>

<span class="nv">TRANSLATION</span><span class="o">=</span><span class="k">$(</span>iconv -f <span class="nv">$encoding</span> <span class="p">&amp;</span>lt<span class="p">;&amp;</span>lt<span class="p">;&amp;</span>lt<span class="p">;</span><span class="s2">"</span><span class="nv">$result</span><span class="s2">"</span> <span class="p">|</span> awk <span class="s1">'BEGIN {RS="</span>



<span class="s1">"};/&amp;lt;span[^&amp;gt;]* id=["'</span><span class="se">\'</span><span class="s1">']?result_box["'</span><span class="se">\'</span><span class="s1">']?/'</span> <span class="p">|</span> html2text<span class="k">)</span>
</pre>


<p>مساله ساده است‌. ما صفحه وبی داریم که می‌توانیم در جای خاصی از آن بگوییم که ترجمهٔ چه کلمه‌ای را می‌خواهیم و این صفحه در مقابل در جای خاص دیگری از خودش ترجمهٔ کلمه را به ما نشان می‌دهد‌. اسم این صفحه http://translate.google.com است که چون از متد GET (اگر درست یادم باشد) استفاده می‌کند‌، می‌توان با تغییر متغیر‌هایش نتیجهٔ کلمات مختلف را در آن دید‌. ضمن این که اضافه کنم که این دوستمان از روش جالبی برای پیدا کردن این متد‌ها (غیر از نگاه کردن به URL استفاده کرده) که هر چند به نظرم استفاده‌اش در این‌جا بی‌خود است‌، ولی کاربرد‌های باحال‌تری می‌توان برایش پیدا کرد. فعلا برای فهمیدن ماجرا از زبان خودش به صفحه‌ای که در بالا گفتم رجوع کنید‌!</p>
<p>در ادامه کافیست که از صفحه‌ای که گرفته‌ایم‌، آن المنت خاصی که می‌خواهیم را جدا کنیم (جایی که ترجمه نشان داده می‌شود) و به html2text بخورانیم که نهایتا فقط متن به ما نشان داده شود‌. ولی از آن‌جا که html2text فقط یک فرمت یونیکد را می‌فهمد و فرمت کدینگ صفحهٔ نتیجهٔ گوگل با توجه به زبان پاسخ متفاوت است (چرا؟) با استفاده از iconv سعی می‌کند که کدینگ درست را به خوردش بدهد‌. و حالا چون نمی‌خواهد هر بار دستی وارد کند که از کدام کدینگ تبدیل کن‌، با awk سر صفحه را می‌خواند و کدینگ صفحه را پیدا می‌کند ;-)</p>
<p>و آخرین بخش ماجرا مربوط می‌شود به دانلود صدا. برای این کار از <a title="google translate download sound" href="https://gist.github.com/873364" target="_blank">این اسکریپت</a> کمک گرفتم‌. ولی چون نمی‌خواستم نتیجهٔ کار خیلی شلخته شود (دو فرمت متفاوت در صورت استفاده از espeak و google translate در کنار هم) با ffmpeg کلیه فرمت‌ها را به ‎.ogg تغییر دادم که آقایمان نیز از ما راضی باشد.</p>
</div>
    </div>

    <div class="text-center">
                    <a class="btn btn-success" href="posts/wp/twlyd-khwdkhr-flsh-khrt-nglysy-bh-frsy/#disqus_thread" data-disqus-identifier="cache/posts/wp/twlyd-khwdkhr-flsh-khrt-nglysy-bh-frsy.html">Comments</a>


    </div>

    </article><article class="h-entry post-text"><div class="text-center">

        <h1 class="p-name entry-title"><a href="posts/wp/dryft-tlt-systm-bdwn-stfdh-z-conky/" class="u-url"> Calculate the total CPU time.</a></h1>
            شاهین
      <a href="posts/wp/dryft-tlt-systm-bdwn-stfdh-z-conky/" rel="bookmark"><time class="published dt-published" datetime="2012-11-24T00:55:09+03:30" title="2012-11-24 00:55">2012-11-24 00:55</time></a>
    </div>
    <div class="e-content entry-content">
    <div>
<p><a href="http://dl.dropbox.com/u/25017694/Blog-photos/ConkyOni3.png"><img class=" " title="ConkyOni3" src="http://dl.dropbox.com/u/25017694/Blog-photos/ConkyOni3.png" alt="" width="540" height="44"></a> برای دیدن در اندازهٔ بزرگ کلیک کنید</p>
<p>و فعلا چند اشکال به آن وارد است‌: اول این که دارم از یک برنامهٔ خیلی گنده‌، برای یک کار ساده استفاده می‌کنم‌. دوم این که در حالت شل قدرت زیادی برای انگولک خروجی Conky ندارم (مثلا آن قسمت درصد استفاده از CPU برای درصد‌های مختلف تک رقمی‌، دو رقمی و سه رقمی‌، طول‌های متفاوتی می‌گیرد و کمی قضیه را لوس می‌کند) و سوم این که اگر به ماندن در همین وضعیت رضایت دهم‌، سوادم هیچ وقت زیاد نمی‌شود‌ D:</p>
<p>پس تصمیم می‌گیرم که خروجی فعلی کانکی را (البته با چند تغییر کوچک) با ابزار ساده‌تری جایگزین کنم‌. خوب کار تقریبا پیچیده و سختی به نظر می‌رسد (وقتی که از لینوکس هیچ چیز ندانم) اما خوب همین Conky هم اطلاعاتش را از روی هوا نمی‌گیرد که! از طرفی مسالهٔ زبان پایش به میان می‌آید‌. به چه زبانی بنویسم؟ من که ته تهش پایتون را (آن هم دست و پا شکسته) می‌دانم‌.</p>
<p>بعد از کمی جستجو و دو دو تا چهار تا با دانسته‌های قبلی‌ام‌، مساله را این‌طور حل می‌کنم (از راست به چپ تصویر):</p>
<p></p>
<ul>
<li>زمان: روی توزیعم با دستور date می‌توانم زمان حاضر را به طور کامل ببینم و البته می‌توانم آن را به صورت دلخواهم فرمت کنم‌.</li>
    <li>صدا: حقیقتش کشف کردم نیازی به این ندارم و زیاد دنبال واکشی مقدارش نگشتم‌. ولی مطمئنم یک راه ساده برای فهمیدنش هست ;-)</li>
    <li>مجموع آپلود/دانلود نشست حاضر (TU/TD): خوب بعد از کمی جستجو‌، با دوست قدیمی ولی ناشناخته‌ام proc آشنا شدم‌، که از قرار خیلی خیلی‌، بیشتر از چیز‌هایی که می‌خواهم را بهم می‌رساند‌. فعلا ‎/proc/net/dev جواب تا این‌جای کار است‌.</li>
    <li>سرعت دانلود/آپلود (D/U): راستش را بخواهید‌، این یکی مرا خیلی در کف نگه داشت‌! فکر می‌کردم باید جایی مثلا در proc برای این قضیه باشد‌. ولی نکته‌اش این‌جا بود که من اصلا نفهمیده بودم که چه می‌خواهم‌. که البته با تقلب از روی این <a title="code-project-monitor-proc-python-and-clutter" href="http://www.tuxradar.com/content/code-project-monitor-proc-python-and-clutter" target="_blank">آموزش</a> آن هم به صورت اتفاقی قضیه را درک کردم و شبیه سازی (البته نکاتی هم باقی می‌ماند که در ادامه مطرح می‌کنم).</li>
    <li>وضعیت رم: خوب این یکی هم مثل date. می‌دانستم که دستوری به اسم free برای این‌کار ساخته شده‌. ولی باید کمی خروجی‌اش را انگولک می‌کردم و چیزی که می‌خواستم را بیرون می‌کشیدم.</li>
    <li>وضعیت CPU: این یکی ترکیبی از همهٔ کار‌هاییست که در بالا باید انجام دهم به علاوه کلی چیز جدید که باید یاد بگیرم‌. فایل ‎/proc/stat وضعیت فعلی CPU را در خودش نگه می‌دارد که با اسکریپتی که در <a title="cpu usage monitor script on github" href="https://github.com/moisespsena/linux-cpu-usage/blob/master/cpu-usage-monitor.sh" target="_blank">این‌جا</a> دیدم فهمیدم که چطور وضعیت کل CPU را واکشی کنم‌. اما من وضعیت کل را نمی‌خواستم‌، بلکه به دنبال وضعیت تک تک هسته‌ها بودم که خوب باید دست و بالم رو کثیف‌تر می‌کردم ;-)</li>
</ul>
<p>خوب تمام این کار‌ها را می‌شود با پایتون هم انجام داد (با هر زبان دیگری هم می‌شود) ولی‌، دم دستی‌ترین چیز ممکن shell scripting است‌. هم احتمالا کمتر از مفسر پایتون به سیستم فشار می‌آورد و هم این که اصلا چیزی در موردش نمی‌دانم (نه این که اصلا‌، ولی نه در حد یک اسکریپت نویس ;-)). این می‌شود که طی دو روز گذشته‌، تمام فکر و ذکرم را می‌گذارم روی نوشتن این اسکریپت‌، تا هم چیز یاد بگیرم‌، و هم مستقل‌تر شوم ;-)</p>
<p>اسکریپت حاضر است و از <a title="sysdata script on github" href="https://github.com/shahinism/Scripts/blob/master/Shell/sysdata.sh" target="_blank">این‌جا</a> قابل دریافت. در ادامه ذره‌، ذره به بررسی‌اش می‌پردازیم‌:</p>
<h5>تاریخ</h5>

<p>خوب اولین چیزی که لازم داشتیم‌، خروجی گرفتن زمان فعلی سیستم بود که گفتیم با دستور date قادر به انجامش هستیم‌. به صورت زیر:</p>
<pre class="code literal-block"><span></span><span class="nv">date</span><span class="o">=</span><span class="k">$(</span>date +<span class="s2">"%a %Y.%m.%d %H:%M"</span><span class="k">)</span>
</pre>


<p>نکتهٔ این دستور آن‌جاست که من برای مقدار دهی به متغیر date، از خروجی یک دستور استفاده کرده‌ام (کاری که در ادامه خیلی زیاد انجام می‌دهم‌). برای این کار کافیست دستور مورد نظر را در ‎$(‎)‎ بنویسیم‌. به همین راحتی!</p>
<h5>اطلاعات شبکه</h5>

<p>اولین چیز‌هایی که می‌خواهیم‌، این است که بفهمیم چقدر دانلود یا آپلود کرده‌ایم‌. که همانطور که گفتم این اطلاعات را در فایل ‎/proc/net/dev می‌توان یافت‌. همینطور‌، با محاسبهٔ این که در یک ثانیهٔ گذشته‌، چقدر دانلود/آپلود کرده‌ایم‌، می‌توان سرعت دانلود بر ثانیه را محاسبه کرد. این است که برای تمیزی کار‌، اول یک تابع می‌نویسیم که از proc ذکر شده‌، مقدار بایت‌های ارسالی یا دریافتی را واکشی کند:</p>
<pre class="code literal-block"><span></span><span class="k">function</span> getNetBytes

<span class="o">{</span>

<span class="nv">Brecived</span><span class="o">=</span><span class="k">$(</span>cat <span class="nv">$netInterface</span> <span class="p">|</span> grep <span class="s2">"eth0"</span> <span class="p">|</span> awk <span class="s1">'{print($2)}'</span><span class="k">)</span>

<span class="nv">Btransmited</span><span class="o">=</span><span class="k">$(</span>cat <span class="nv">$netInterface</span> <span class="p">|</span> grep <span class="s2">"eth0"</span> <span class="p">|</span> awk <span class="s1">'{print($10)}'</span><span class="k">)</span>

<span class="o">}</span>
</pre>


<p>متغیر ‎$netInterface اشاره به همان فایل ‎/proc/net/dev می‌کند که در اول اسکریپت تعریفش کرده‌ام‌. بعد هم با grep تنها خطی که مربوط به اینترفیسی که می‌خواهم است را جدا می‌کنم (eth0) و حالا با awk خانهٔ شمارهٔ ۲ را برای بایت‌های دریافت شده‌، و خانهٔ شمارهٔ ۱۰ این خروجی را برای بایت‌های فرستاده شده جدا می‌کنم‌. این کار را به روش‌های دیگری هم می‌شد انجام داد‌، ولی به نظرم با این روش‌، خط‌های کمتری تایپ کردم ;-)</p>
<p>حالا با دستورات زیر‌، چیز‌هایی که می‌خواهم را محاسبه می‌کنم:</p>
<pre class="code literal-block"><span></span><span class="nv">dlSpeed</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="k">$((</span> <span class="nv">$Brecived</span><span class="o">-</span><span class="nv">$oldBRecived</span> <span class="k">))</span> <span class="p">|</span> awk <span class="s1">'{printf( "%.2f", $1/1024)}'</span><span class="k">)</span>

<span class="nv">upSpeed</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="k">$((</span> <span class="nv">$Btransmited</span><span class="o">-</span><span class="nv">$oldBTransmited</span> <span class="k">))</span> <span class="p">|</span> awk <span class="s1">'{printf( "%.2f", $1/1024)}'</span><span class="k">)</span>

<span class="nv">traffic</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$Brecived</span><span class="s2"> </span><span class="nv">$Btransmited</span><span class="s2">"</span> <span class="p">|</span> awk <span class="s1">'{printf( "%.2f", ($1+$2)/1024/1024 )}'</span><span class="k">)</span>
</pre>


<p>طی این دستورات‌، از قابلیت متغیر‌گیری به صورت ‎$num و همینطور‌، پرینت فرمت شده (برای نمایش حداکثر دو رقم اعشار) awk استفاده کرده‌ام. این کار‌ها با dc هم قابل انجام بود‌، ولی خروجی به تمیزی awk نبود‌. همانطور که می‌بینید در این دستورات از متغیر‌های ‎$oldBRecived و ‎$oldBTransmited استفاده شده‌ که در واقع وضعیت یک ثانیه قبل دانلود/آپلود را در خود نگاه می‌دارند‌. تنها کافیست دستورات فوق را هر یک ثانیه اجرا کنیم تا خروجی درست را بگیریم‌. (حلقهٔ کامل این دستورات در آخر مطلب توضیح داده می‌شود)</p>
<p>نکته‌ای که می‌ماند دقت این محاسبه است‌. حقیقتش همانطور که گفتم من این روش را از این‌جا [link] یاد گرفتم. اما دقیقا همان را پیاده سازی نکردم. مساله سر زمان محاسبه بود. نمی‌دانم چرا نویسنده در آن‌جا از epoch (تاریخ ۱/۱/۱۹۷۰) استفاده کرده بود (خوشحال می‌شوم اگر کسی می‌داند به من هم توضیح دهد‌.) نویسنده در آن‌جا می‌گوید مساله سر چند کیلوبایت است و از این حرف‌ها!</p>
<h5>وضعیت RAM</h5>

<p>گفتم که دستور free -m این‌کارها را انجام می‌دهد‌، پس:</p>
<pre class="code literal-block"><span></span><span class="k">function</span> getRamInfo

<span class="o">{</span>

<span class="nv">totalMemory</span><span class="o">=</span><span class="k">$(</span>free -m <span class="p">|</span> grep <span class="s2">"Mem:"</span> <span class="p">|</span> awk <span class="s1">'{printf( "%.2f", $2/1024)}'</span> <span class="k">)</span>

<span class="nv">usedMemory</span><span class="o">=</span><span class="k">$(</span>free -m <span class="p">|</span> grep <span class="s2">"buffers/cache"</span> <span class="p">|</span> awk <span class="s1">'{printf( "%.2f", $3/1024)}'</span><span class="k">)</span>

<span class="nv">memInPercent</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$totalMemory</span><span class="s2"> </span><span class="nv">$usedMemory</span><span class="s2">"</span> <span class="p">|</span> awk <span class="s1">'{printf( "%.0f", $2/($1/100)) }'</span><span class="k">)</span>

<span class="o">}</span>
</pre>


<p>فکر نکنم نکته‌ای باقی مانده باشد که قبلا توضیح نداده باشم‌. پس دیگر توضیح نمی‌دهم!</p>
<h5>وضعیت CPU</h5>

<p>خوب گفتم که برای یادگیری این کار‌، از این اسکریپت[link] استفاده کردم. ولی این اسکریپت تنها وضعیت کل CPU را بر می‌گرداند‌. من آن را طوری تغییر دادم که هر بار‌، آدرس هسته‌ای که می‌خواهم اطلاعاتش را بدانم در ورودی بگیرد‌، و فقط همان را هسته را محاسبه کند و در خروجی نشان دهد:</p>
<pre class="code literal-block"><span></span><span class="k">function</span> getCpuInfo<span class="o">()</span>

<span class="o">{</span>

<span class="nv">CORE</span><span class="o">=</span><span class="nv">$1</span>

<span class="nv">addr</span><span class="o">=</span><span class="s2">"^cpu</span><span class="si">${</span><span class="nv">CORE</span><span class="si">}</span><span class="s2">"</span>

<span class="nb">local</span> <span class="nv">CPU</span><span class="o">=(</span><span class="sb">`</span>cat /proc/stat <span class="p">|</span> grep <span class="nv">$addr</span><span class="sb">`</span><span class="o">)</span> <span class="c1"># Get the total CPU statistics.</span>

<span class="nb">unset</span> CPU<span class="o">[</span>0<span class="o">]</span> <span class="c1"># Discard the "cpu" prefix.</span>

<span class="nb">local</span> <span class="nv">IDLE</span><span class="o">=</span><span class="si">${</span><span class="nv">CPU</span><span class="p">[4]</span><span class="si">}</span> <span class="c1"># Get the idle CPU time.</span>



<span class="c1"># Calculate the total CPU time.</span>

<span class="nb">local</span> <span class="nv">TOTAL</span><span class="o">=</span>0

<span class="k">for</span> VALUE in <span class="s2">"</span><span class="si">${</span><span class="nv">CPU</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do</span>

<span class="nb">let</span> <span class="s2">"TOTAL=</span><span class="nv">$TOTAL</span><span class="s2">+</span><span class="nv">$VALUE</span><span class="s2">"</span>

<span class="k">done</span>



<span class="c1"># Catch current cores last state</span>

<span class="nv">PREV_IDLE</span><span class="o">=</span><span class="k">$(</span><span class="nb">eval</span> <span class="nb">echo</span> <span class="se">\P</span>REV_IDLE<span class="nv">$CORE</span><span class="k">)</span>

<span class="nv">PREV_TOTAL</span><span class="o">=</span><span class="k">$(</span><span class="nb">eval</span> <span class="nb">echo</span> <span class="se">\P</span>REV_TOTAL<span class="nv">$CORE</span><span class="k">)</span>



<span class="c1"># Calculate the CPU usage since we last checked.</span>

<span class="nb">let</span> <span class="s2">"DIFF_IDLE=</span><span class="nv">$IDLE</span><span class="s2">-</span><span class="nv">$PREV_IDLE</span><span class="s2">"</span>

<span class="nb">let</span> <span class="s2">"DIFF_TOTAL=</span><span class="nv">$TOTAL</span><span class="s2">-</span><span class="nv">$PREV_TOTAL</span><span class="s2">"</span>

<span class="nb">let</span> <span class="s2">"DIFF_USAGE=(1000*(</span><span class="nv">$DIFF_TOTAL</span><span class="s2">-</span><span class="nv">$DIFF_IDLE</span><span class="s2">)/</span><span class="nv">$DIFF_TOTAL</span><span class="s2">+5)/10"</span>



<span class="nb">eval</span> <span class="se">\P</span>REV_TOTAL<span class="nv">$CORE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TOTAL</span><span class="s2">"</span>

<span class="nb">eval</span> <span class="se">\P</span>REV_IDLE<span class="nv">$CORE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$IDLE</span><span class="s2">"</span>

<span class="o">}</span>
</pre>


<p>برای این کار از یک متغیر برای تابع استفاده می‌کنم و مقدارش را به متغیر CORE اختصاص می‌دهم‌. با استفاده از این آدرس یک عبارت با قائده (Regex) به صورت "‎^cpu${CORE}‎" می‌سازم‌. این عبارت باقائده با خطوطی که در اولشان عبارت cpuN را دارند مطابقت می‌کند‌. و سپس با استفاده از داده‌هایی که دارم یک آرایه با استفاده از پردازش فایل ‎/proc/stat می‌سازم و آن را به متغیر CPU نسبت می‌دهم‌. خوب حالا چون اولین خانهٔ این آرایه اسم CPU را دارد‌، و به درد محاسبات بعدی نمی‌خورد‌، آن را از آرایه بیرون می‌اندازم (unset CPU[0]‎) و همین‌طور مقدار خانهٔ IDLE را هم در متغیری به همین نام ذخیره می‌کنم‌.</p>
<p>با جمع کردن تمامی مقادیر موجود در آرایهٔ CPU می‌توانم کل وضعیت کارکرد CPU را به دست آورم‌. این می‌شود که به صورت زیر این کار را انجام می‌دهم:</p>
<pre class="code literal-block"><span></span><span class="nb">local</span> <span class="nv">TOTAL</span><span class="o">=</span>0

<span class="k">for</span> VALUE in <span class="s2">"</span><span class="si">${</span><span class="nv">CPU</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do</span>

<span class="nb">let</span> <span class="s2">"TOTAL=</span><span class="nv">$TOTAL</span><span class="s2">+</span><span class="nv">$VALUE</span><span class="s2">"</span>

<span class="k">done</span>
</pre>


<p>ساده است این‌طور نیست؟ آن let آن‌جا همان کار ‎(())$ را می‌کند‌. حالا وقت انجام محاسبات است‌. چون هر بار نیاز است که وضعیت قبلی CPU مورد نظر را داشته باشیم‌، پس لازم است برای هر CPU متغیر‌های مربوطه را بسازیم‌. که این کار را با دستورات زیر انجام می‌دهیم:</p>
<pre class="code literal-block"><span></span><span class="nb">eval</span> <span class="se">\P</span>REV_TOTAL<span class="nv">$CORE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TOTAL</span><span class="s2">"</span>

<span class="nb">eval</span> <span class="se">\P</span>REV_IDLE<span class="nv">$CORE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$IDLE</span><span class="s2">"</span>
</pre>


<p>این دستور eval فوق‌العاده است‌. با استفاده از آدرس CPU فعلی (CORE) متغیر‌های مورد نظرم را می‌سازد و مقادیر مربوطه را درشان ذخیره می‌کند‌. اما چون نمی‌خواهم زیادی کثیف کاری شود‌، قبل از انجام محاسبات‌، متغیر‌هایی که ساخته‌ایم را به یک نام ثابت در می‌آورم تا کارم را آسان کنم:</p>
<pre class="code literal-block"><span></span><span class="nv">PREV_IDLE</span><span class="o">=</span><span class="k">$(</span><span class="nb">eval</span> <span class="nb">echo</span> <span class="se">\P</span>REV_IDLE<span class="nv">$CORE</span><span class="k">)</span>

<span class="nv">PREV_TOTAL</span><span class="o">=</span><span class="k">$(</span><span class="nb">eval</span> <span class="nb">echo</span> <span class="se">\P</span>REV_TOTAL<span class="nv">$CORE</span><span class="k">)</span>
</pre>


<p>حالا این دو متغیر‌، وضعیت قبلی CPU را در خود نگه می‌دارند‌. پس نوبت این است که محاسباتم را انجام دهم:</p>
<pre class="code literal-block"><span></span><span class="nb">let</span> <span class="s2">"DIFF_IDLE=</span><span class="nv">$IDLE</span><span class="s2">-</span><span class="nv">$PREV_IDLE</span><span class="s2">"</span>

<span class="nb">let</span> <span class="s2">"DIFF_TOTAL=</span><span class="nv">$TOTAL</span><span class="s2">-</span><span class="nv">$PREV_TOTAL</span><span class="s2">"</span>

<span class="nb">let</span> <span class="s2">"DIFF_USAGE=(1000*(</span><span class="nv">$DIFF_TOTAL</span><span class="s2">-</span><span class="nv">$DIFF_IDLE</span><span class="s2">)/</span><span class="nv">$DIFF_TOTAL</span><span class="s2">+5)/10"</span>
</pre>


<p>چیز خاصی نیست دیگر‌، همه چیز روشن است ;-)</p>
<h5>پایان کار</h5>

<pre class="code literal-block"><span></span><span class="k">while</span> true<span class="p">;</span>

<span class="k">do</span>

getNetBytes

getRamInfo

<span class="k">for</span> <span class="o">((</span> <span class="nv">COUNT</span><span class="o">=</span>0<span class="p">;</span> COUNT <span class="p">&amp;</span>lt<span class="p">;</span> <span class="nv">$CORES</span><span class="p">;</span> COUNT++ <span class="o">))</span><span class="p">;</span><span class="k">do</span>

getCpuInfo <span class="nv">$COUNT</span>

<span class="nb">eval</span> <span class="se">\c</span>pu<span class="nv">$COUNT</span><span class="o">=</span><span class="nv">$DIFF_USAGE</span>

<span class="k">done</span>



<span class="nv">dlSpeed</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="k">$((</span> <span class="nv">$Brecived</span><span class="o">-</span><span class="nv">$oldBRecived</span> <span class="k">))</span> <span class="p">|</span> awk <span class="s1">'{printf( "%.2f", $1/1024)}'</span><span class="k">)</span>

<span class="nv">upSpeed</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="k">$((</span> <span class="nv">$Btransmited</span><span class="o">-</span><span class="nv">$oldBTransmited</span> <span class="k">))</span> <span class="p">|</span> awk <span class="s1">'{printf( "%.2f", $1/1024)}'</span><span class="k">)</span>

<span class="nv">traffic</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$Brecived</span><span class="s2"> </span><span class="nv">$Btransmited</span><span class="s2">"</span> <span class="p">|</span> awk <span class="s1">'{printf( "%.2f", ($1+$2)/1024/1024 )}'</span><span class="k">)</span>



<span class="nb">printf</span> <span class="se">\</span>

<span class="s2">"CPU: %3s,%3s,%3s,%3s | RAM: %sG/%sG (%s%%) | LAN: ↓: %4sƘ ↑: %4sƘ T↕: %6s | %s\n"</span> <span class="se">\</span>

<span class="s2">"</span><span class="nv">$cpu0</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$cpu1</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$cpu2</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$cpu3</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$usedMemory</span><span class="s2">"</span> <span class="se">\</span>

<span class="s2">"</span><span class="nv">$totalMemory</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$memInPercent</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$dlSpeed</span><span class="s2">"</span> <span class="se">\</span>

<span class="s2">"</span><span class="nv">$upSpeed</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$traffic</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$date</span><span class="s2">"</span>

<span class="nv">oldBRecived</span><span class="o">=</span><span class="nv">$Brecived</span>

<span class="nv">oldBTransmited</span><span class="o">=</span><span class="nv">$Btransmited</span>

sleep 1

<span class="k">done</span>
</pre>


<p>حالا نوبت این است که کار را تمام کنم‌. یک حلقهٔ همیشه درست می‌سازم و فقط بهش می‌گویم بعد از این که همهٔ کار‌هایت را انجام دادی یک ثانیه استراحت کن (برای این که سرعت اینترنت را درست محاسبه کند‌، این مقدار ضروری است). بر همین اساس تابع‌های getNetBytes و getRamInfo را صدا می‌کنم تا متغیر‌های جدیدشان را تولید کنند‌. اما در مورد تابع getCpuInfo قضیه کمی فرق دارد‌. قرار است که چهار بار این تابع را با متغیر‌های متفاوت صدا کنیم و نتیجهٔ حاصله‌اش را در متغیرهای جداگانه ذخیره کنیم‌. این است که آن حلقهٔ for سر و کله‌اش پیدا می‌شود‌. یک حلقهٔ for به سبک C که خداییش به نظرم کامل‌ترین حلقه‌های for است D: حالا تابع را درش به صورت getCpuInfo $COUNT صدا می‌زنم و متغیر ‎$DIFF_USAGE که همان طرصد مصرف است را به یک متغیر به صورت cpuN نسبت می‌دهم‌. این N همان آدرس هسته است.</p>
<p>همان‌طور که می‌بینید در ادامه محاسبهٔ سرعت اینترنت می‌آید که قبلا توضیحش داده‌ام‌. printf را فعلا ول کنید و به دو خط بعدش نگاهی کنید‌. همان دو متغیری که وضعیت قبلی ترافیک را نگه می‌دارند‌. فکر کنم دیگر همه چیز روشن شده باشد‌.</p>
<p>حالا برسیم به آن printf. حتما می‌پرسید چرا از echo استفاده نکردم‌. echo خوب است‌، ولی خیلی ساده هم هست‌. آن مشکل کنترل فضای پرینت که در Conky گرفتارش بودم‌، این‌جا هم پیدا می‌شد‌. یک نگاهی به این خروجی بیاندازید:</p>
<pre class="code literal-block"><span></span>CPU: 48,3,40,3 <span class="p">|</span> RAM: 1.11G/1.95G <span class="o">(</span>57%<span class="o">)</span> <span class="p">|</span> LAN: ↓:0.00Ƙ ↑:0.00Ƙ T↕:221.20 <span class="p">|</span> Sat 2012.11.24 14:41

CPU: 8,4,76,4 <span class="p">|</span> RAM: 1.11G/1.95G <span class="o">(</span>57%<span class="o">)</span> <span class="p">|</span> LAN: ↓:0.00Ƙ ↑:0.00Ƙ T↕:221.20 <span class="p">|</span> Sat 2012.11.24 14:41

CPU: 24,5,64,6 <span class="p">|</span> RAM: 1.11G/1.95G <span class="o">(</span>57%<span class="o">)</span> <span class="p">|</span> LAN: ↓:0.00Ƙ ↑:0.00Ƙ T↕:221.20 <span class="p">|</span> Sat 2012.11.24 14:41
</pre>


<p>می‌بینید‌، هنوز هم طول خروجی کم و زیاد می‌شود که اصلا خوب نیست‌. این است که باید دنبال دستوری باشم که خروجی را آرایش کند و بیرون بدهد‌. printf سالاری که از زمان یادگیری C می‌شناسم این کار را برایم می‌کند‌. کافیست فضای متغیر‌ها را به صورت ‎%Ns که N همان طول مینیموم رشته است را مشخص کنم‌. خودش باقی کار‌ها را انجام می‌دهد‌. خوب همین دیگر‌. کارمان تمام شد‌. مرحلهٔ بعدی این است که یک خروجی json دار درست حسابی بسازم که i3 بتواند رنگی رنگی‌اش کند ;-)</p>
<p><a href="http://dl.dropbox.com/u/25017694/Blog-photos/SysdataOni3.png"><img title="SysdataOni3" src="http://dl.dropbox.com/u/25017694/Blog-photos/SysdataOni3.png" alt="" width="527" height="50"></a> برای دیدن در اندازهٔ بزرگ‌تر کلیک کنید</p>
</div>
    </div>

    <div class="text-center">
                    <a class="btn btn-success" href="posts/wp/dryft-tlt-systm-bdwn-stfdh-z-conky/#disqus_thread" data-disqus-identifier="cache/posts/wp/dryft-tlt-systm-bdwn-stfdh-z-conky.html">Comments</a>


    </div>

    </article><article class="h-entry post-text"><div class="text-center">

        <h1 class="p-name entry-title"><a href="posts/wp/tbdyl-pdf-frsy-bh-mtn-b-stfdh-z-chnd-b/" class="u-url">تبدیل PDF فارسی به متن با استفاده از چند ابزار لینوکسی و کمی پایتون</a></h1>
            شاهین
      <a href="posts/wp/tbdyl-pdf-frsy-bh-mtn-b-stfdh-z-chnd-b/" rel="bookmark"><time class="published dt-published" datetime="2012-11-22T00:28:24+03:30" title="2012-11-22 00:28">2012-11-22 00:28</time></a>
    </div>
    <div class="e-content entry-content">
    <div>
<p>مشکل این‌جاست که در ایمکس فونت سراسری‌ام متن فارسی را به صورت جدا جدا نشان می‌دهد‌. ولی طبق روشی که به آن اشاره کردم‌، کاراکتر‌هایی که در رنج خاصی از کد‌های یونیکد هستند‌، باید با فونت Tahoma (انتخاب من) نمایش داده شوند. اما وقتی فایل خروجی Okular را باز می‌کنم می‌بینم کاراکتر‌ها کاملا درست‌، ولی با فونتی غیر از تاهوما دیده می‌شوند‌. خوب تجربه ثابت کرده که هیچ مشکلی به این راحتی حل نمی‌شود‌. کمی از خروجی را به یک فایل tex تبدیل می‌کنم و خروجی PDFش را بررسی می‌کنم‌. خروجی تقریبا قابل قبول است ولی در بعضی از خطوط کاراکتر‌ها به صورت مبهمی به هم ریخته‌اند‌. از آن‌جایی که خودم برنامهٔ officeای روی سیستم ندارم و <a title="وقتی دزدی می‌کن(م،ن،ید)" href="http://shahinism.com/blog/1391/08/25/%d9%88%d9%82%d8%aa%db%8c-%d8%af%d8%b2%d8%af%db%8c-%d9%85%db%8c%e2%80%8c%da%a9%d9%86%d9%85%d8%8c%d9%86%d8%8c%db%8c%d8%af/" target="_blank">وضع اینترنت‌ام</a> هم معلوم است‌، از دوست <a title="لیبره آفیس قدم رو" href="http://emanlog.com/?p=303" target="_blank">libreoffice کار قهارم</a> می‌خواهم که فایل خروجی Okular را یک بار دیگر و این‌بار با libreoffice تست کند و ببیند آیا قابل ویرایش است یا نه‌؟ ایمان در جواب می‌گوید که کاراکتر‌ها مثل تصویر عمل می‌کنند و قدرت ویرایش چندانی روی آن‌ها ندارم.(اگر دروغ گفته‌، یقهٔ خودش رو بگیرید ;-))</p>
<p>پس حالا نوبت این است که کمی دست‌هایمان را کثیف‌تر کنیم‌. مساله ساده است‌. فایلی داریم شامل کاراکتر‌هایی که امیدواریم حداقل یونیکد باشند‌، ولی می‌خواهیم آن‌ها را به رنج استانداردی که می‌شناسیم تبدیل کنیم (یک Find &amp; Replace سریع و دوست داشتنی D:)‌. پایتون دوست‌داشتنی چند تابع خیلی‌، خیلی باحال برای کمک به ما در همچین وضعیت‌هایی دارد‌. اولی‌شان ord است‌. کارش این است که یک کاراکتر را به عنوان ورودی بگیرد و در خروجی کد معادلش را چاپ کند‌. دیگری unichr است که تقریبا کاری برعکس کار ord می‌کند‌. یک کد (که فکر می‌کند یونیکد است) در ورودی می‌گیرد‌، و کاراکتر یونیکد معادلش را در خروجی بر می‌گرداند‌.</p>
<p>پس برای شروع کار چند تابع کوچک می‌نویسیم که برای دستکاری فایل کمک‌مان کند‌. تابع اول‌مان‌، چیزی است که در بقیه راه نیازش داریم‌. تابعی که یک فایل را از ورودی بخواند‌:</p>
<pre class="code literal-block"><span></span>def read_file<span class="o">(</span>file_name<span class="o">)</span>:

<span class="nv">the_file</span> <span class="o">=</span> codecs.open<span class="o">(</span>file_name, <span class="nv">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="o">)</span>

<span class="k">return</span> the_file
</pre>


<p>همین‌طور برای این که خیال‌مان راحت شود‌، تابعی می‌نویسیم که کل محتوای فایل ورودی‌اش را به صورت کاراکتر به کاراکتر (هر کاراکتر در یک خط) چاپ کند:</p>
<pre class="code literal-block"><span></span>def show_characters<span class="o">(</span>input_file<span class="o">)</span>:

<span class="k">for</span> line in read_file<span class="o">(</span>input_file<span class="o">)</span>.readlines<span class="o">()</span>:

<span class="k">for</span> char in line:

print char
</pre>


<p>حالا نوبت بخش هیجان‌انگیز‌تر ماجرا می‌رسد‌. تابعی دیگر می‌نویسیم که این‌بار به جای کاراکتر‌ها‌، کد‌های معادل‌شان را چاپ کند:</p>
<pre class="code literal-block"><span></span>def show_unicode_code<span class="o">(</span>input_file<span class="o">)</span>:

<span class="k">for</span> line in read_file<span class="o">(</span>input_file<span class="o">)</span>.readlines<span class="o">()</span>:

<span class="k">for</span> char in line:

print ord<span class="o">(</span>char<span class="o">)</span>
</pre>


<p>و سر‌انجام تابعی می‌نویسیم که عکس کار بالا را انجام دهد:</p>
<pre class="code literal-block"><span></span>def replace_unicode_char<span class="o">(</span>input_file<span class="o">)</span>:

<span class="k">for</span> line in read_file<span class="o">(</span>input_file<span class="o">)</span>.readlines<span class="o">()</span>:

print unichr<span class="o">(</span>int<span class="o">(</span>line<span class="o">))</span>.encode<span class="o">(</span><span class="s1">'utf-8'</span><span class="o">)</span>
</pre>


<p>مطمئنا می‌شد این توابع را به صورت‌های ساده‌تری هم نوشت‌. ولی خوب اولا سواد من به همین‌قدر می‌رسید‌، دوما هم به نظرم برنامه خوانا‌تر شده‌. برای کسانی که پایتون می‌دانند به نظرم کد‌ها به قدر کافی گویا هستند (آن‌هایی هم که نمی‌دانند کافیست انگلیسی‌شان کفایت کند‌. نا سلامتی هنر پایتون همین است D:). فقط یک نکته در تابع replace_unicode_char باقی می‌ماند و آن هم این که کاراکتر‌های ورودی به صورت رشته هستند و قبل از خوراندنشان به unichar باید تبدیل به عدد (int) شوند‌. همینطور اگر می‌خواهید کاراکتر‌ها را در خروجی چاپ کنید‌، باید به صورت utf-8 کد کنید که خود دستور به قدر کافی گویا هست‌.</p>
<p>من کل این توابع به علاوهٔ یک تابع مهم‌تر از آن‌ها را (که پایین‌تر توضیح‌اش می‌دهم) به صورت یک اسکریپت نوشته‌ام که می‌توانید از<a title="لینک به اسکریپت chrvalidator.py" href="https://github.com/shahinism/Scripts/blob/master/Python/chrvalidator/chrvalidator.py" target="_blank"> این‌جا </a>دریافتش کنید‌. که خوب به عنوان راهنما اضافه کنم که در صورتی که خواستید فایل را به صورت کاراکتر به کاراکتر در خروجی ببینید از دستور زیر بهره بگیرید:</p>
<pre class="code literal-block"><span></span>python chrvalidator.py -i INPUT_FILE -c
</pre>


<p>اگر خواستید که کد‌های یونیکد کاراکتر‌هایش را ببینید از دستور زیر استفاده کنید:</p>
<pre class="code literal-block"><span></span>python chrvalidator.py -i INPUT_FILE -u
</pre>


<p>و اگر هم خواستید که بر عکس کار فوق (تبدیل کد‌های یونیکد به کاراکتر‌های نظیرشان) را انجام دهید‌، به جای ‎-u در دستور فوق از ‎-U استفاده کنید‌. خوب بگذارید به مسالهٔ اصلی‌مان برگردیم‌. برای شروع کار بیایید با دستورات زیر‌، لیستی از کد‌های کاراکتر استفاده شده در فایل‌مان به دست آوریم:</p>
<pre class="code literal-block"><span></span>python chrvalidator.py -i ashamloo.txt -u <span class="p">&amp;</span>gt<span class="p">;</span> chrcodes.txt

sort -u chrcodes.txt <span class="p">&amp;</span>gt<span class="p">;</span> uniq.txt
</pre>


<p>خوب همان‌طور که معلوم است اول از همه کد تمام کاراکتر‌ها را استخراج کردیم‌. و سپس از آن‌جایی که مطمئنیم کاراکتر‌های تکراری زیادی داریم‌، و صد البته مطمئن‌تریم که یک فایل مرتب شده بیشتر به دردمان می‌خورد با استفاده از دستور sort -u کاراکتر‌های تکراری را حذف کرده و فایل را مرتب می‌کنیم‌. حالا همین فایل مرتب شده را دوباره به اسکریپت‌مان می‌خورانیم تا کاراکتر‌های نظیر‌شان را پیدا کنیم:</p>
<pre class="code literal-block"><span></span>python chrvalidator.py -i uniq.txt <span class="p">&amp;</span>gt<span class="p">;</span> uniqchr.txt
</pre>


<p>یک بررسی سرسری‌، نشان‌مان می‌دهد که تنها کاراکتر‌های محدودی از مجموع کاراکتر‌ها نیاز به تعویض دارند‌. دسته‌ای از کل کاراکتر‌ها مربوط به حروف انگلیسی یا اعدادند‌. دسته‌ای دیگر هم در این بین کاراکتر‌های استانداردند. و این وسط ما اکثرا نیاز به تغییر کاراکتر‌هایی موسوم به <a title="unicode character table" href="http://www.ssec.wisc.edu/~tomw/java/unicode.html#xFE70" target="_blank">Arabic Presentation Forms-B</a> داریم‌. خوب همانطور که می‌بینید در بین این کاراکتر‌ها برای نمونه حرف «ب» در سه حالت مختلف «اول‌، وسط‌، آخر» نمایش داده می‌شود که هر کدام کاراکتر مربوط به خود و در نتیجه کد مربوط به خود را دارند‌. برای همین ما تابعی دیگری نیز به صورت زیر به اسکریپت‌مان اضافه می‌کنیم:</p>
<pre class="code literal-block"><span></span><span class="k">for</span> line in read_file<span class="o">(</span>input_file<span class="o">)</span>.readlines<span class="o">()</span>:

<span class="k">for</span> char in line:

<span class="k">if</span> ord<span class="o">(</span>char<span class="o">)</span> in <span class="o">(</span>64343, 64344, 64345<span class="o">)</span>:

<span class="nv">char</span> <span class="o">=</span> <span class="s2">"پ"</span>
</pre>


<p>در این تابع همان‌طور که پر واضح است‌، می‌گوییم فایل را کاراکتر به کاراکتر بخوان‌، کد دسیمال کاراکتر را پیدا کن‌، و اگر این کد دسیمال شبیه به یکی از سه عدد (کد‌های مربوط به حروف پ اول‌، وسط و آخر) بود آن را با حرف پ جایگزین کن‌. ساده است‌، این‌طور نیست؟ خوب من این کار را برای تقریبا چهل کاراکتر استاندارد انجام دادم که نتیجه‌اش در اسکریپت معلوم است (اگر شما خواستید فایل دیگری را به این روش تبدیل کنید و کاراکتری به این لیست اضافه کردید‌، خوشحال می‌شوم که اسکریپت تکمیل شده‌تان را با من و بقیه به اشتراک بگذارید‌)‌. در آخر کار هم با دستور زیر تابع را می‌بندیم:</p>
<pre class="code literal-block"><span></span>sys.stdout.softspace<span class="o">=</span>False

try:

print char.encode<span class="o">(</span><span class="s2">"utf-8"</span><span class="o">)</span>,

except UnicodeDecodeError:

print char,
</pre>


<p>خوب خط اول این مجموعه مربوط به این است که به پایتون بفهمانیم در هنگام چاپ کاراکتر‌ها بین‌شان فاصله نگذارد‌. اگر این مقدار درست باشد‌، کاراکتر‌ها به صورت س ل ا م نوشته می‌شوند، که خوب به درد ما نمی‌خورد‌. همینطور ممکن است به دلیل این که بعضی اوقات در بین کاراکتر‌ها‌، کاراکتر به صورت utf-8 کد شده‌ای پیدا شود و خروجی را بشکند‌، با یک try, except جلوی این اتفاق را می‌گیریم‌، که یک کمی ممکن است گیج کنند باشد‌. در این مورد فقط به من اعتماد داشته باشید که اسکریپت کار می‌کند ;-)</p>
<p>برای پایان کار هم فایل تکست اولیه‌مان را به صورت زیر با اسکریپت حاضرمان ویرایش می‌کنیم:</p>
<pre class="code literal-block"><span></span>python chrvalidator.py -i ashamloo.txt <span class="p">&amp;</span>gt<span class="p">;</span> validashamloo.txt
</pre>


<p>خوب کار تقریبا تمام شد‌. ولی خوب‌، کامپیوتر است دیگر‌. همیشه که درست عمل نمی‌کند‌. فایل خروجی نمونهٔ مرا در<a title="ashamloo text file" href="http://dl.dropbox.com/u/25017694/Blog_files/ashamloo.txt.xz" target="_blank"> این‌جا</a> می‌بینید‌. خالی از اشکال هم نیست‌، ولی خوب طبیعتا مشکلات زیادی را برایم حل می‌کند (دیگر لازم نیست به آن فونت کذایی Arial زل بزنم). دیگر باقی کار‌ها می‌افتد گردن یک ویراستار به درد بخور‌. (البته شاید بتوان از <a title="نسخهٔ جدید ویرایشگر متن نگار" href="http://shahinism.com/blog/1391/07/10/%d9%86%d8%b3%d8%ae%d9%87%d9%94-%d8%ac%d8%af%db%8c%d8%af-%d9%88%db%8c%d8%b1%d8%a7%db%8c%d8%b4%da%af%d8%b1-%d9%85%d8%aa%d9%86-%d9%86%da%af%d8%a7%d8%b1/" target="_blank">نگار</a> هم کمک گرفت‌، که فعلا دارم شدیدا رویش کار می‌کنم‌. نسخهٔ فعلی‌اش مشکلاتی دارد‌، ولی امیدوارم بتوانم حل‌شان کنم‌)</p>
<p><strong>پی‌نوشت:</strong> Okular از قرار‌، قادر نیست PDF‌هایی که رمزگذاری شده‌اند را باز کند (خودم امتحان نکردم) در آن صورت یک ابزار پایتونی برای این کار وجود دارد که در آینده در موردش می‌نویسم‌. تا این‌جای کار‌، خروجی‌های این تابع زیاد با روش ذکر شده همخوانی ندارد‌، پس باید به فکر دستکاری‌اش باشم‌. اسم این تابع هم در صورتی که دل‌تان می‌خواهد کشفش کنید pdfminer است.</p>
</div>
    </div>

    <div class="text-center">
                    <a class="btn btn-success" href="posts/wp/tbdyl-pdf-frsy-bh-mtn-b-stfdh-z-chnd-b/#disqus_thread" data-disqus-identifier="cache/posts/wp/tbdyl-pdf-frsy-bh-mtn-b-stfdh-z-chnd-b.html">Comments</a>


    </div>

    </article><article class="h-entry post-text"><div class="text-center">

        <h1 class="p-name entry-title"><a href="posts/wp/wqty-dzdy-mykhnmnyd/" class="u-url">وقتی دزدی می‌کن(م،ن،ید)</a></h1>
            شاهین
      <a href="posts/wp/wqty-dzdy-mykhnmnyd/" rel="bookmark"><time class="published dt-published" datetime="2012-11-15T16:17:14+03:30" title="2012-11-15 16:17">2012-11-15 16:17</time></a>
    </div>
    <div class="e-content entry-content">
    <div>
<p>حتما شما هم دیده‌اید دیگر‌، آدم‌هایی که تا تقی به توقی می‌خورد دم از حکومت دو هـــــــزار و پانصد سالهٔ آریایی و فرهنگش می‌زنند و کلی هم به آن افتخار می‌کنند‌. بعدش هم پشت‌بندش از عبارات نوازش‌گرانه‌ای نسبت به اعراب و دست ساخت‌هاشان برای رفع مسئولیت استفاده می‌کنند‌.</p>
<p>حرف من نیست که کدام یک از این حرف‌ها بی‌خود است و کدام یکی نه‌. می‌خواهم بگویم کرم از درخت است آقا جان‌. خودمان هم در کسری از ثانیه‌، اگر پایش بیافتد‌، آن‌چنان دروغ و دزدی‌ای می‌کنیم‌، که خود خدا هم در چگونگی‌اش می‌ماند! اگر می‌گویند و می‌شنویم که فساد در قبل از انقلاب به دم در خانه‌مان رسیده بود (که هنوز هم نتوانسته‌ام درک کنم اگر طبیعت انسان می‌شود فساد‌، پس چرا این‌ها نمی‌شود) به حول قوهٔ فرهنگ دو هزار و پانصد ساله‌ای که داریم‌، بیشعوری به عمق وجودمان رسوخ کرده‌.</p>
<p>ماشالله نیست که بیشعور‌های سطح بالایمان کم اینترنت‌مان را با بهانهٔ این که کشور‌های غربی هم آن را محدود می‌کنند محدود کرده‌اند (کسی هم نیست بگوید آن‌ها اینترنت را با کیفیتی غیر قابل مقایسه با آنی که شما ارائه می‌دهید و با قیمتی خیلی‌، خیلی‌، خیلی پایین‌تر از چیزی که شما به مردم تحمیل می‌کنید ارائه می‌دهند‌، چرا آن‌وقت شما چیز‌های بدش رو بهانه قرار می‌دهید‌) و اصلا بیشعور‌های سطح بالای دنیوی (یکیش همین دار و دستهٔ گوگل) باقی جاهای باقی مانده را از دستمان در نیاورده‌اند، این شرکت‌های به قولی غیر دولتی که از میان همین مردم در آمده‌اند‌، در آن زخم سر باز کرده مثل چی نمک می‌ریزند و کیف می‌کنند‌!</p>
<p>نمی‌دانم این تبلیغات اخیر پارس آنلاین را در سایتش دیده‌اید یا نه‌. این‌جاها را ببینید:</p>
<p>این سرویس مناسب چه کسانی است؟</p>
<blockquote>کاربران پرمصرفی که مصرف گیگ بسیار بالایی دارند. قاعدتاً برای این گروه از کاربران به لحاظ مالی مقرون به صرفه نخواهد بود تا پکیج های حجمی محدود به همراه گیگ اضافه را خریداری نمایند.

کاربرانی که نیاز به اطمینان خاطر از بابت اتصال دائمی به اینترنت و عدم قطعی اینترنت خود دارند و مایلند در تمام شبانه روز آنلاین باشند. برای این دسته از کاربران نیز بهینه نیست که پکیج های حجمی محدود به همراه گیگ اضافه خریداری نمایند.</blockquote>

<p>یا خصوصا این بخش را:</p>
<blockquote>کاربرانی که پکیج های نامحدود را خریداری می نمایند مطمئن باشند <strong>همواره سرعت اسمی پکیج خود را دریافت می نمایند و هیچ نگرانی از این بابت وجود ندارد و می توانند بدون محدودیت حجمی از اینترنت پرسرعت استفاده نمایند.</strong>
</blockquote>

<p>مای از همه جا بی‌خبر‌، که دیگر داشت دردش خیلی زیاد می‌شد که هر ماه یک پکیج چهار گیگی بخریم و در صورت کم آمدنش که عموما همان ۱۰ روز اول می‌آمد‌، پول یک گیگ حجم را ۵۰۰۰ تومانی واریز کنیم (خداییش درد دارد) به امید این که یک ماه اینترنت با سرعت ۱۲۸ کیلوبایت (دانلود) و بدون استرس تمام شدن حجم داشته باشیم‌، خر شدیم (هر چه گشتم عبارت با مسماتری پیدا نکردم) و به مبلغ ۲۸۵۰۰ تومان‌، یعنی ۲۷۰۰۰ تومان هزینهٔ سرویس + ۱۵۰۰ تومان مالیات (یعنی حتی مالیات هم دادم) یک دانه‌اش را خریدم‌. تا دو هفتهٔ اول خوب بود‌. واقعا خوب بود‌. سرعت گاها تا ۱۳۰ کیلوبایت هم می‌رسید‌. ولی این وضعیت تا زمانی ادامه داشت که حجم دانلودی‌ام زیر هشت گیگابایت بود‌.</p>
<p>الان که این متن را می‌نویسم یک هفته‌ای می‌شود که سرعت دانلودم به زور از ۱۳، ۱۴ کیلوبایت فراتر می‌رود‌. تازه آن هم در صورتی که بتوانم کانکت شوم‌. خواستم بگویم که همچین یاد حرف آن بندهٔ خدایی افتادم که گفته بود:</p>
<blockquote>

اگر همین فردا کل کابینهٔ دولت را یکجا بردارند و همتایان سوئیسی‌شان را بنشانند سر جایشان‌، یک هفتهٔ بعد باز هم وضع همین است.

</blockquote>

<p>هر چه هم سعی کردم نفهمیدم این حرف را از کدام بندهٔ خدا خوانده‌ام‌.</p>
</div>
    </div>

    <div class="text-center">
                    <a class="btn btn-success" href="posts/wp/wqty-dzdy-mykhnmnyd/#disqus_thread" data-disqus-identifier="cache/posts/wp/wqty-dzdy-mykhnmnyd.html">Comments</a>


    </div>

    </article><article class="h-entry post-text"><div class="text-center">

        <h1 class="p-name entry-title"><a href="posts/wp/dstn/" class="u-url">داستان…</a></h1>
            شاهین
      <a href="posts/wp/dstn/" rel="bookmark"><time class="published dt-published" datetime="2012-11-09T23:13:46+03:30" title="2012-11-09 23:13">2012-11-09 23:13</time></a>
    </div>
    <div class="e-content entry-content">
    <div>
<p>حقیقتش آتش این عشق به کتاب خواندن هر چند دیگر داشت به دست فراموشی سپرده می‌شد‌، به لطف خدا بیامرز گوگل ریدر و اسطوره‌هایش‌، در چند سال اخیر خاموش نشد و فعلا سر جایش است‌. اما چه کنیم که برای شخصی مثل من که گاها هشتش با نهش قاطی می‌شود تا همین هزینهٔ ماهی یک بار اینترنتش را جور کند‌، تحقق همهٔ فانتزی‌های دوران کودکی‌، حتی اگر مجموعشان یکی دو تا باشد‌، کم کم به آرزو تبدیل می‌شود‌. خصوصا که آدم بد‌های دنیا از بین سه میلیارد و خرده‌ای جمعیت روی زمین‌، چشمشان را به پشت سفید هفتاد و اندی ایرانی دوخته‌اند و قیمت‌هایشان را دم به دم بالا می‌برند ;-)</p>
<p>این مقدمهٔ بی‌نمک بلند را گفتم تا به این‌جا برسم که خوشبختانه جدای از اینترنت بی‌مزه‌مان که شده میدان ارابه کشی یک سری فرماندهٔ در حسرت جنگ مانده و باقی عرصه‌های قلم و هنر و سخن‌مان هم شده ضمیمهٔ دستمالی رهبران آن فرماندهان ذکر شده‌، گاها آدم چیز‌هایی می‌بیند که جدا امیدوار کننده است‌.</p>
<p><a href="http://dl.dropbox.com/u/25017694/Blog-photos/dastanmag.jpg"><img title="عکس روی جلد نسخهٔ آبان ماه مجلهٔ داستان" src="http://dl.dropbox.com/u/25017694/Blog-photos/dastanmag.jpg" alt="عکس روی جلد نسخهٔ آبان ماه مجلهٔ داستان" width="150" height="223"></a> عکس روی جلد نسخهٔ آبان ماه مجلهٔ داستان</p>
<p>چند ماه پیش (دقیقا تیر ماه) بود که سر گذرم از یک مطبوعاتی‌، چشمم به مجله‌ای خوشدست و جمع و جور به اسم «‌<strong>داستان‌</strong>»<a title="وبلاگ مجلهٔ داستان روی بلاگفا" href="http://dastanmag.blogfa.com/" target="_blank">+</a> افتاد که به بهانهٔ هدیه برای خواهرم یک نسخه‌اش را خریدم‌. مجله زیر مجموعهٔ مجلات همشهری است.</p>
<p>خط اصلی حرف‌هایش را داستان‌، کتاب و نویسنده‌ها تشکیل می‌دهند‌. داستان‌هایی هر چند کوچک ولی جدا خواندنی‌. کتاب‌هایی که گاها آرزوی پیدا کردن یک نسخه‌شان به دلت می‌ماند‌. نویسنده‌هایی که بعضا با تمام آماتور بوندنشان‌، آن‌قدر شیرین و دوست داشتنی می‌نویسند که هرگز دوست نداری به ته نوشته‌شان برسی‌.</p>
<p>از طرفی دیگر طراحی صفحات مجله‌، کیفیت چاپش‌ و حتی عکس‌های خوشگلی که آن‌قدر زیبا بین متن‌ها جا ساز شده‌اند که آدم را یاد موزه می‌اندازند‌، می‌تواند عطش تهیهٔ آخرین نسخهٔ این مجله را برای منی که همچون فانتزی بلند بالایی منباب کتاب و کتاب‌خوانی دارم‌، چندین و چند برابر کند‌.</p>
<p>مخلص کلام این که حیفم آمد همچین مجله‌ای را بخوانم و تجربهٔ شیرین خواندنش را با شما در میان نگذارم‌.</p>
<p><strong>*:</strong> قصهٔ آن جام کمی طول و دراز است‌. خلاصه‌اش این که یکی دوست دارد با سیگار کتاب بخواند‌. یکی با ماگ قهوه‌. یکی هم با جام آب انگور گندیده ;-)</p>
</div>
    </div>

    <div class="text-center">
                    <a class="btn btn-success" href="posts/wp/dstn/#disqus_thread" data-disqus-identifier="cache/posts/wp/dstn.html">Comments</a>


    </div>

    </article><article class="h-entry post-text"><div class="text-center">

        <h1 class="p-name entry-title"><a href="posts/wp/shq-bzy-b-trmynl-lynwkhs-urxvt-rngamy/" class="u-url">عشق بازی با ترمینال لینوکس‌ (urxvt, رنگ‌آمیزی و کانفیگش)</a></h1>
            شاهین
      <a href="posts/wp/shq-bzy-b-trmynl-lynwkhs-urxvt-rngamy/" rel="bookmark"><time class="published dt-published" datetime="2012-10-25T08:50:59+03:30" title="2012-10-25 08:50">2012-10-25 08:50</time></a>
    </div>
    <div class="e-content entry-content">
    <div>
<p>برای من یکی‌، ترمینال حکم چوب جادوگری را دارد‌. یعنی آن‌قدر قدرت دارد که صاحبش را تنها به دانش‌اش محدود می‌کند‌. در دنیای ترمینال‌، تقریبا همه چیز ممکن است‌. این است که لازم می‌شود بهترین چوب جادوگری ممکن را برای رفع نیاز‌های‌مان آماده کنیم‌.</p>
<p>قبلا در مورد Terminator پستی داشتم‌ (<a title="ترمیناتور، آخر‌الزمان ترمینال‌ها" href="http://shahinism.com/blog/1391/03/31/%d8%aa%d8%b1%d9%85%db%8c%d9%86%d8%a7%d8%aa%d9%88%d8%b1%d8%8c-%d8%a2%d8%ae%d8%b1%e2%80%8c%d8%a7%d9%84%d8%b2%d9%85%d8%a7%d9%86-%d8%aa%d8%b1%d9%85%db%8c%d9%86%d8%a7%d9%84%e2%80%8c%d9%87%d8%a7/" target="_blank">+</a>). تا همین چند روز پیش هم از آن استفاده می‌کردم‌. واقعا معرکه بود‌. همه چیز را آماده داشت و تا جای ممکن کمکت می‌کرد‌. اما چند روزی است که <a title="urxvt official web page" href="http://software.schmorp.de/pkg/rxvt-unicode.html" target="_blank">urxvt</a> و قابلیت‌هایش نظرم را جلب کرده‌. این است که ضمن جایگزین کردنش با Terminator چیز‌هایی از آن یاد گرفتم که می‌خواهم در این پست در موردش صحبت کنم‌.</p>
<p></p>
<h5>رنگ‌آمیزی urxvt و Terminator</h5>
<p>اول این که حیفم آمد این روش تغییر رنگ Terminator را که یاد گرفته‌ام باز‌گو نکنم‌. این است که در این پست با یک تیر دو نشان می‌زنم‌.</p>
<p>دوم هم این که شاید این کار را بیهوده بدانید‌. ولی قرار است که مدت زیادی در این ترمینال کار کنیم و به نظرم حیاتی‌ترین کاری که باید انجام دهیم‌، قابل تحمل کردن رنگ‌بندی‌اش است ;-)</p>
<p>ترمینال‌هایی مثل urxvt و Terminator سر جمع ۱۸ رنگ را برای رنگ کردن خروجی‌شان استفاده می‌کنند‌. رنگ پس‌زمینه‌، رنگ اصلی خروجی‌، هشت رنگ تیره و هشت رنگ روشن‌. سر هم کردن این همه رنگ‌، جوری که بتوان از ترکیب‌شان استفاده کرد‌، جدا کار طاقت‌فرسایی است‌. حقیقتش من یکی که هرگز موفق نشدم به صورت دستی این کار را انجام دهم‌. همین سختی هم باعث شده که <a title="4bit webpage" href="http://ciembor.github.com/4bit/" target="_blank">4bit</a> به وجود بیاید‌. طرز کارش خیلی سر راست و ساده است‌. پالت رنگ‌تان را ایجاد کنید‌، و وقتی از خروجی خوشتان آمد روی Get scheme کلیک کنید (‌<a title="my urxvt color scheme" href="https://raw.github.com/shahinism/Python_scripts/master/xtt/color_scheme_example" target="_blank">رنگ‌های مورد استفاده من</a>). همان‌طور که می‌بینید‌، برای اکثر ترمینال‌ها یک خروجی حاضر کرده‌‌، جز Terminator. خوب اگر می‌خواهید مثل من urxvt را کانفیگ کنید‌، کد مربوطه‌اش را بگیرید و بسته به تنظیمات توزیع‌تان آن را در ‎.Xdefaults یا ‎.Xresources وارد کنید‌ (برای فهمیدن چند و چون ماجرا man urxvt توضیحات خوبی داده).</p>
<p>حالا برگردیم به تنظیم رنگ برای آن یکی ترمینال محبوب‌مان‌. خیلی ساده‌، همان فایل مربوط به urxvt را بگیرید‌. <a title="xterm to terminator python script" href="https://raw.github.com/shahinism/Python_scripts/master/xtt/xterm_to_terminator.py" target="_blank">این اسکریپت پایتون</a> را که نوشته‌ام را هم بگیرید و دو تا را کنار هم قرار داده و در ترمینال تایپ کنید:</p>
<pre class="code literal-block"><span></span>python xterm_to_terminator.py color_scheme_file
</pre>


<p>خروجی را کپی کنید و در مسیر ‎.config/terminator/config جایگزین خطوط مربوطه کنید‌. (همه چیز سر راست است فکر کنم ;-))</p>
<p>یک نکته هم اضافه کنم‌. 4bit رنگ‌های خروجی‌اش را به صورت colorN یا background ارائه می‌دهد‌. در حالت کلی خوب است‌. ولی ممکن است شما دوست نداشته باشید تمام نرم‌افزار‌هایی که تنظیم رنگ‌شان را از منابع X می‌خوانند همین رنگی شود‌. این است که می‌توانید با تبدیل متغیر‌ها به صورت URxvt<em>colorN یا URxvt</em>background آن‌ها را به urxvt محدود کنید ;-)</p>
<p>رنگ آمیزی تمام شد‌.</p>
<h5>کانفیگ urxvt</h5>

<p>urxvt عالی است‌. امکانات فوق‌العاده‌ای دارد‌. ولی تنظیمات پیش‌فرضش حال به هم زن است‌! یک ترمینال بی روح سفید نافرم‌! مشکل سفیدی‌اش که حل شد‌. ولی هنوز کار دارد‌.</p>
<h6>font:</h6>

<p>نویسندهٔ اصلی urxvt قبلا از mlterm استفاده می‌کرد‌. اما همیشه مجبور بود برای دیدن کاراکتر‌های ژاپنی (یا شایدم چینی) و لاتین‌، بین فونت‌های مختلف سوئیچ کند‌. چون هیچ فونت مناسبی پیدا نمی‌کرد که تمام کاراکتر‌های مورد نیازش را داشته باشد‌. همین می‌شود که کلافه از این که چرا توسعه دهنده‌ها فکر می‌کنند تمام کاراکتر‌های unicode را می‌توان با یک فونت نشان داد‌، دست به انگولک rxvt می‌زند و علاوه بر قابلیت یونیکد‌، پستیبانی از چند فونت را هم به آن اضافه می‌کند. برای تغییر فونت می‌توانید مثل من خط زیر را به ‎.Xdefaults اضافه کنید:</p>
<pre class="code literal-block"><span></span>URxvt*font: xft:Terminus:pixelsize<span class="o">=</span>12
</pre>


<p>و یا اگر فکر می‌کنید فونت انتخابی‌تان به حد کافی کامل نیست‌، از ویژگی چند فونتی به صورت زیر استفاده کنید:</p>
<pre class="code literal-block"><span></span>URxvt.font: 9x15bold,

-misc-fixed-bold-r-normal--15-140-75-75-c-90-iso10646-1,

-misc-fixed-medium-r-normal--15-140-75-75-c-90-iso10646-1,

<span class="o">[</span><span class="nv">codeset</span><span class="o">=</span>JISX0208<span class="o">]</span>xft:Kochi Gothic:antialias<span class="o">=</span>false,

xft:Code2000:antialias<span class="o">=</span><span class="nb">false</span>
</pre>


<p>یک قابلیت جالب دیگر urxvt این است که می‌توان تعیین کرد که نوشته‌های Bold, Italic و یا Underline با فونت‌های متفاوتی نشان داده شوند‌. من خودم این‌ها را تنظیم نکردم (حقیقتش وقت نکردم هنوز) ولی می‌توانید در manpage به دنبال کانفیگ‌های boldFont, italicFont, boldItalicFont و … بگردید‌.</p>
<h6>تنظیم رابط:</h6>

<p>اسکرول‌بار به نظرم چیز زیادی‌ای است‌. ضمن این که خود urxvt میانبر‌هایی برای پیمایش متن دارد‌. همچنین urxvt این قابلیت را دارد که بهش بفهمانیم که چند خط از خروجی ترمینال را برای‌مان ذخیره کند تا بتوانیم آن را پیمایش کنیم‌.</p>
<pre class="code literal-block"><span></span>URxvt*scrollBar: False

URxvt*scrollTtyOutput: False

URxvt*scrollTtyKeypress: True

URxvt*secondaryScroll: True

URxvt*saveLines: 8000

URxvt*letterSpace: 0

URxvt*cursorBlink: True

URxvt*cursorUnderline: True
</pre>


<p>پنج خط اول این تنظیمات که باید در فایل منبع X‌تان ذخیره کنید مربوط به چیز‌هایی است که ذکر‌شان رفت‌. ممکن است با توجه به شرایط نصب و کانفیگ‌تان احساس کنید که کاراکتر‌های متن در urxvt کمی فشرده است‌. تنظیم leterSpace می‌تواند در این رابطه کمک کند‌. اعدادی در بازهٔ اعداد صحیح می‌تواند برای کنترل این آپشن استفاده شود‌.</p>
<p>همینطور به طور پیش‌فرض نشانکر Urxvt ثابت است و من دوست دارد که بی‌حیائی کند و چشمک بزند‌. و البته به جای آن مربع همیشگی کاراکتر _ را ترجیح می‌دهم‌. دو خط آخر این تنظیمات مربوط به همین علایق است ;-)</p>
<h6>Modifier:</h6>

<p>کلید Modifier همان کلیدی است که برای زدن کاراکتر‌های ترکیبی (کنترل) urxvt مورد استفاده قرار می‌گیرد‌. این کلید قرار است به طور پیش‌فرض Alt باشد ولی نمی‌دانم چرا اصلا هیچ‌کدام از Modifier ها برای من کار نمی‌کرد‌. اگر شما هم در چنین وضعیتی هستید‌، با استفاده از خط زیر این ویژگی را تعریف کنید:</p>
<pre class="code literal-block"><span></span>URxvt*modifier: alt
</pre>


<h6>افزونه‌ها:</h6>

<p>یکی از قابلیت‌های خوشگل urxvt افزونه‌های perl‌اش است‌. افزونه‌هایی که قابلیت‌های گاها غیرقابل باوری به آن اضافه می‌کنند‌. فعلا ما تنها به باورپذیر‌هایش کار داریم‌. و اما از آن‌جایی که افزونه‌هایی که به طور پیش‌فرض همراه urxvt هستند کفاف نیازمان را نمی‌دهند‌، یک چند‌تایی هم از <a title="urxvt-perls on git" href="https://github.com/muennich/urxvt-perls" target="_blank">این‌جا</a> می‌گیریم‌.</p>
<p>فایل‌های این افزونه‌ها را دریافت کنید‌، و در مسیر ‎/usr/lib/urxvt/perl (یا اگر ۶۴ بیتی هستید lib64) قرار دهید‌. حالا خط زیر را برای وارد کردن‌شان به urxvt اضافه کنید:</p>
<pre class="code literal-block"><span></span>URxvt.perl-ext-common : default,matcher,tabbed,keyboard-select,url-select,clipboard
</pre>


<p>چند‌تای اول همراه خود i3 هستند که من آن tabbed را خیلی دوست دارم‌. می‌گذارد urxvt برای‌تان تب کند ;-) شوخی کردم‌، همان تب‌بندی خودمان است‌. برای این که به طور به درد بخوری کانفیگش کرده باشیم‌، خطوط زیر را به تنظیمات اضافه کنید (اعداد جلویشان همان شماره رنگ‌ها هستند):</p>
<pre class="code literal-block"><span></span>URxvt.tabbed.tabbar-fg: 5

URxvt.tabbed.tabbar-bg: 0

URxvt.tabbed.tab-fg: 14

URxvt.tabbed.tab-bg: 0
</pre>


<p>فوق‌العاده است‌. با Shift و فلش پایین می‌توانید تب جدید اضافه کنید‌. با Shift و فلش‌های دو طرف به این‌ور آن‌ور بروید و با Ctrl+D تب را ببندید‌. کلید‌های بیشترش را از <a title="urxvt tabs on arch wiki" href="https://wiki.archlinux.org/index.php/Rxvt-unicode#Tabs" target="_blank">ویکی آرچ</a> یاد بگیرید ;-)</p>
<p>اما سه افزونهٔ آخر آن‌هایی هستند که urxvt-perls برایمان ساخته‌. حقیقتش این است که این‌ها فقط یه سری تابع ساده به زبان perlاند‌. پس باید غیر از فعال کردن‌شان‌، کلید‌های میانبری برای اجرای‌شان تعریف کنیم‌.</p>
<h6>تعریف کلید میانبر:</h6>

<p>مثل همه جای دیگر‌، کار بسیار آسانی است‌. کلید متا یا Modifier‌مان را که تعریف کردیم‌، حالا کافیست که با سینتکس:</p>
<pre class="code literal-block"><span></span>keysym.: Action
</pre>


<p>یک کلید میانبر تعریف کنیم‌. خوب بگذارید کمی مثال‌های واقعی‌تری بزنیم‌. افزونهٔ اول‌مان keyboard-select است که قابلیت‌های پیمایش ماهی در ترمینال به ما می‌دهد‌. تقریبا از ماوس بی‌نیازمان می‌کند. خطوط زیر را برای کانفیگش اضافه کنید:</p>
<pre class="code literal-block"><span></span>URxvt.keysym.M-Escape: perl:keyboard-select:activate

URxvt.keysym.M-s: perl:keyboard-select:search
</pre>


<p>حالا گفتیم با M-Escape یا همان Alt+Esc تابع پرل به نام keyboard-select را فعال کن. این کلید‌ها کمک می‌کند که با کلید‌های میانبر vim درون متن ترمینال پیمایش کنید‌. همینطور M-s قابلیت سرچ درون متن ترمینال را از تابع keyboard-select رو نویس می‌کند‌. (این قابلیت به صورت پیش‌فرض در urxvt وجود دارد ولی این یکی بهتر است ;-))</p>
<p>افزونهٔ بعدی url-select است‌. خیلی پیش می‌آید که می‌خواهیم تنها روی یک url از توی ترمینال کلیک کنیم‌. خوبیت ندارد که تابع Search را برای این کار انتخاب کنیم‌. این است که به صورت زیر این افزونه را فعال می‌کنیم:</p>
<pre class="code literal-block"><span></span>URxvt.keysym.M-u: perl:url-select:select_next

URxvt.url-select.autocopy: True

URvxt.url-select.button: 2

URxvt.url-select.launcher: firefox

URxvt.url-select.underline: True
</pre>


<p>فکر کنم تنظیمات به قدر کافی گویا هستند‌. پس دیگر زیاد شلوغش نمی‌کنم!</p>
<p>و افزونهٔ آخر clipboard که یک کمی درد‌سرش بیشتر است‌. این تابع به طور پیش‌فرض از xsel برای کپی و پیست متن استفاده می‌کند‌. (البته در ادامه می‌گویم که اگر خواستید چطور تغییرش دهید‌). این برنامه به دستور xsel -ib متن را کپی می‌کند (می‌توانید این دستور را تایپ کنید‌، انتر کنید‌، متن مورد نظر‌تان را تایپ کنید و Ctrl+D بزنید) و با xsel -ob متن را پیست کنید‌. به نظرم فکر خوبی است که این برنامه را نصب کنید (ضمن این که باقی برنامه‌ها هم عکس‌العمل خوبی بعد از نصب این برنامه نشان دادند ;-)) و بعد با خطوط زیر این افزونه را تنظیم کنید:</p>
<pre class="code literal-block"><span></span>URxvt.keysym.M-c: perl:clipboard:copy

URxvt.keysym.M-v: perl:clipboard:paste

URxvt.keysym.M-C-v: perl:clipboard:paste_escaped
</pre>


<p>جای Ctrl+c و یا غیره ما از همان M استفاده کردیم‌ (آن هم از روی کالیبر بالایمان ;-)) ولی اگر دوست دارید که همان کلید‌های همیشگی را داشته باشید‌، به جای M حرف C بزرگ را تایپ کنید!</p>
<p>اما اگر حال نصب xsel را ندارید و دستور کپی دیگری مد نظرتان است‌، می‌توانید آن دستور‌ها را به صورت زیر جایگزین xsel کنید:</p>
<pre class="code literal-block"><span></span>URxvt.clipboard.copycmd: Command

URxvt.clipboard.pastecmd: Command
</pre>


<p>خوب تا همین اندازه فکر کنم برای شروع کار کافی باشد‌. فایل کانفیگ کامل من را می‌توانید در<a title="My xdefaults config" href="https://raw.github.com/shahinism/.configs/master/.Xdefaults" target="_blank"> این لینک </a>ببینید‌. اما هنوز هم نکاتی هست که ذکرشان خالی از لطف نیست:</p>
<h5>نکات اضافه:</h5>

<ul>
<li>یکی از قابلیت‌های خیلی به درد بخور urxvt این است که می‌توان به صورت daemon اجرایش کرد‌. یعنی یک بار هستهٔ daemon را اجرا می‌کنید و پس از آن ترمینال‌های مختلف را روی همان هستهٔ اصلی به صورت کلاینت صدا می‌کنید‌. مزیت این کار سرعت خیلی بالای فراخوانی ترمینال‌هاست‌. ولی خوب یک مشکل هم دارد‌. اگر یک ترمینال کرش کند‌، کل ترمینال‌ها به فنا می‌روند‌، ولی خوب مگر تا به حال چند بار ترمینال زیر دست‌تان کرش کرده؟ این است که روی i3 با هر بار لود مدیر پنجره urxvtd را برای ران شدن daemon صدا می‌کنم و هر وقت نیاز به ترمینال داشتم urxvtc را اجرا می‌کنم ;-) توصیه می‌کنم که<a href="https://wiki.archlinux.org/index.php/Rxvt-unicode#Improved_Kuake-like_Behavior_in_Openbox" target="_blank"> این بخش</a> از ویکی آرچ را در این رابطه بخوانید‌. اسکریپت به درد بخوری است‌!</li>
    <li>ممکن است بعد از بعد از هر بار تغییر Xdefaults فایل کانفیگ به درستی لود نشود‌، این است که می‌توانید از دستور زیر برای بارگذاری دوباره‌اش استفاده کنید:</li>
</ul>
<pre class="code literal-block"><span></span>xrdb -merge ~/.Xdefaults
</pre>


<ul>
<li>قبلا گفتم که می‌توان برای حالت‌های Bold, Italic و … فونت‌های مختلفی تعیین کرد‌. حالا اضافه می‌کنم که رنگ‌های این فونت‌ها نیز قابل تغییر است در manpage به دنبال آپشن‌هایی مثل colorBD, colorIT, colorUL و … بگردید‌.</li>
    <li>مسیر پلاگین‌های perl برای urxvt به صورت پیش‌فرض ‎/usr/lib/urxvt/perl است‌. اما ممکن است دوست نداشته باشید که این افزونه‌ها به صورت systemwide در دسترس باشد‌. یا شاید شما دسترسی نوشتن در این آدرس را ندارید‌. با آپشن زیر می‌توانید مسیر جدیدی برای این افزونه‌ها اضافه کنید:</li>
</ul>
<pre class="code literal-block"><span></span>perl-lib: PATH
</pre>


<ul>
<li>گاها ممکن است نیاز داشته باشید که ترمینال‌های‌تان را به صورت login shell ران کنید‌. که خوب مزیت‌های خودش را دارد‌. با اپشن loginShell: True می‌توانید به این عمل دست یابید‌.</li>
    <li>نکتهٔ آخر و خیلی مهم هم این که شما می‌توانید تمام این امکاناتی که بحثشان رفت را تنها در زمان فراخوانی urxvt اعمال کنید‌. تمام آپشن‌های ذکر شده‌، یک آرگومان خط فرمان هم دارند که کار همین‌ها را انجام می‌دهد‌.</li>
</ul>
<p></p>
</div>
    </div>

    <div class="text-center">
                    <a class="btn btn-success" href="posts/wp/shq-bzy-b-trmynl-lynwkhs-urxvt-rngamy/#disqus_thread" data-disqus-identifier="cache/posts/wp/shq-bzy-b-trmynl-lynwkhs-urxvt-rngamy.html">Comments</a>


    </div>

    </article><article class="h-entry post-text"><div class="text-center">

        <h1 class="p-name entry-title"><a href="posts/wp/trmynl-dropdown-mthl-quake-dr-mdyr-pnjrh-i3/" class="u-url">ترمینال dropdown (مثل quake) در مدیر پنجرهٔ i3</a></h1>
            شاهین
      <a href="posts/wp/trmynl-dropdown-mthl-quake-dr-mdyr-pnjrh-i3/" rel="bookmark"><time class="published dt-published" datetime="2012-10-22T18:52:08+03:30" title="2012-10-22 18:52">2012-10-22 18:52</time></a>
    </div>
    <div class="e-content entry-content">
    <div>
<p>گذشت تا امروز که دیدم Arch باز‌ها یک<a title="HOWTO: get a quake-like urxvt terminal in openbox" href="http://downloads.sourceforge.net/tilda" target="_blank"> کلکی سوار</a> کرده‌اند و توانسته‌اند urxvt را به صورت quake در OpenBox (یک راهنمای عالی برای کار با این مدیرپنجره را دوست خوبم <a title="وبلاگ ایمان امینی!" href="http://emanlog.com" target="_blank">ایمان</a> در <a title="Openbox on linuxreview wiki" href="http://wiki.linuxreview.ir/OpenBox" target="_blank">ویکی لینوکس ریویو</a> فراهم کرده) اجرا کنند‌. بماند که کلی ژانگولر بازی در آوردم که پیاده‌اش کنم و اخرش نتوانستم در i3 اجرایش کنم‌.</p>
<p>این شد که طبق معمول دست به<a title="problem on i3 faq site" href="http://faq.i3wm.org/question/671/kuake-like-behavior-with-urxvt/" target="_blank"> دامن i3 </a>باز‌ها شدم و با کمال تعجب دیدم که نوشابه در کوزه و ما دنبال آب می‌گردیم‌! قضیه از این قرار است که i3 با تمام کوچکی‌اش یک قابلیت خیلی ماه دارد به اسم scratchpad. که یعنی می‌توانید با آن هر موقع خواستید هر پنجره‌ای را غیب کنید و هر وقت دیگر خواستید ظاهر کنید‌. این است که برای مثال ما که مصادف شده با مهاجرتم به ترمینال urxvt‌، این چنین i3 را کانفیگ می‌کنیم تا به نتیجهٔ دلخواه‌مان برسیم:</p>
<pre class="code literal-block"><span></span>for_window <span class="o">[</span><span class="nv">instance</span><span class="o">=</span><span class="s2">"dropdown_urxvt"</span><span class="o">]</span> move to scratchpad, border 1pixel

for_window <span class="o">[</span><span class="nv">instance</span><span class="o">=</span><span class="s2">"dropdown_urxvt"</span><span class="o">]</span> focus<span class="p">;</span> resize grow width 300px

bindsym F12 <span class="o">[</span><span class="nv">instance</span><span class="o">=</span><span class="s2">"dropdown_urxvt"</span><span class="o">]</span> scratchpad show, move position 110px 0px
</pre>


<p>آن بخش instance را داشته باشید تا در آخر کار بهش برگردیم‌. در خط اول می‌گوییم که اگر پنجرهٔ مورد نظرمان صدا شد‌، بفرستش به scratchpad و کلا آن بردارش را (که دور تمام پنجره‌ها در i3 وجود دارد) را حذف کن. در خط دوم هم همان پنجرهٔ مورد نظر را کمی عریض‌تر می‌کنیم‌. و در آخر کار هم در خط سوم می‌گوییم که هر وقت کلید F12 را زدیم‌، پنجرهٔ موردنظرمان را که برده‌ای آن پشت مشت‌ها‌، در فلان مختصات صفحه ظاهر کن‌.</p>
<p>در مورد این توضیحات بالا می‌توانید به راحتی در <a title="i3 user guide" href="http://i3wm.org/docs/userguide.html" target="_blank">راهنمای کاربران i3 </a>اطلاعات به درد بخوری پیدا کنید‌. و اما می‌ماند نکات کنکوری:</p>
<p>تا این‌جای کار‌، ما گفتیم که اگه پنجرهٔ مورد نظرمان را دیدی‌، چه کار کن‌. اما حالا مسئله این‌جاست که این پنجره را چطور ایجاد کنیم‌. طوری که منحصر به فرد باشد‌. هر چه باشد نمی‌خواهم هر بار که urxvt را صدا زدم همان بالا باز شود‌. گاهی به یک ترمینال گنده نیاز دارم‌!</p>
<p>urxvt یک قابلیت خیلی به درد بخور دارد و آن هم این که می‌توان آن را به صورت daemon اجرا کرد‌. بعد هم هر وقت خواستیم ترمینالی باز کنیم‌، یک کلاینت از همان daemon باز می‌شود که مزیتش سرعت بالای در دسترس قرار گرفتن پنجره است‌.</p>
<p>این است که اول از همه ترتیبی می‌دهیم که با باز شده i3 به صورت خودکار این daemon هم اجرا شود:</p>
<pre class="code literal-block"><span></span><span class="nb">exec</span> urxvtd
</pre>


<p>حالا هم نوبت به ساخت پنجره‌مان می‌رسد‌. ظاهر خوشی ندارد که هر بار به صورت دستی بازش کنم‌، چون بلافاصله غیب می‌شود و باید با F12 صدایش کرد‌. این است که این را هم می‌گذارم خود i3 موقع بالا آمدن اجرا کند‌. به هر حال ما که یک نمونه از این کلاینت بیشتر نمی‌خواهیم:</p>
<pre class="code literal-block"><span></span><span class="nb">exec</span> urxvtc -name dropdown_urxvt
</pre>


<p>ها‌، همین‌جاست که به i3 می‌فهمانیم که کدام پنجره منظورمان است‌. حالا کافیست که یک بار i3 را ریست کنیم و F12 را بزنیم‌. نتیجهٔ کار عالیست:</p>
<p></p>
<p style="text-align: center;"><a href="http://dl.dropbox.com/u/25017694/Blog-photos/i3_urxvt_dropdown.png"><img class="aligncenter" title="dropdown urxvt in i3" src="http://dl.dropbox.com/u/25017694/Blog-photos/i3_urxvt_dropdown.png" alt="dropdown urxvt in i3" width="491" height="369"></a></p>
<p><strong>پی‌نوشت:</strong> درست است که طی حل این ماجرا راه‌های عجیب و غریبی را غیر از آسان‌ترین راهی که جلوی رویم بود انتخاب کردم‌، ولی چیز‌های جالبی یاد گرفتم که در پست‌های آینده در موردشان خواهم گفت ;-)</p>
<p><strong>پی‌نوشت۲:</strong> ممکن است روی نسخهٔ استیبل i3 (در این تاریخ) با دستور focus که در این آموزش استفاده شده مشکل دارین‌. آخرین نسخهٔ git این مشکل را بر طرف کرده‌!</p>
</div>
    </div>

    <div class="text-center">
                    <a class="btn btn-success" href="posts/wp/trmynl-dropdown-mthl-quake-dr-mdyr-pnjrh-i3/#disqus_thread" data-disqus-identifier="cache/posts/wp/trmynl-dropdown-mthl-quake-dr-mdyr-pnjrh-i3.html">Comments</a>


    </div>

    </article>
</div>
        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-22.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-20.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="shahinism";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
    </div>
    <!--End of body content-->
  </div>

  <footer id="footer" class="site-footer">
    Contents © 2016         <a href="mailto:me@5hah.in">شاهین</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
    
  </footer><script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
  </script><!-- end fancy dates -->
</body>
</html>
