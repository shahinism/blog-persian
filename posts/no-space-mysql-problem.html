<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" dir="rtl" lang="fa">
<head>
<meta charset="utf-8">
<meta name="wot-verification" content="1e0ce5594a67af53269c">
<base href="https://5hah.in/posts/no-space-mysql-problem.html">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>وقایع نگاری یک دیباگ: وقتی MySQL چیزی ذخیره نمی‌کند! | شاهین</title>
<link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/bootstrap-rtl.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../assets/css/colorbox.css" rel="stylesheet" type="text/css">
<link href="../assets/css/style.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="https://5hah.in/posts/no-space-mysql-problem.html">
<link rel="icon" href="favicon.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><meta name="author" content="شاهین">
<link rel="prev" href="multithreading-bug-experiment-on-PyMongo-driver.html" title="وقایع نگاری یک دیباگ: وضعیت عجیب MongoDB" type="text/html">
<link rel="next" href="version-control-is-not-optional.html" title="ورژن کنترل اختیاری نیست!" type="text/html">
<meta property="og:site_name" content="شاهین">
<meta property="og:title" content="وقایع نگاری یک دیباگ: وقتی MySQL چیزی ذخیره نمی‌کند!">
<meta property="og:url" content="https://5hah.in/posts/no-space-mysql-problem.html">
<meta property="og:description" content="مشکل از آن‌جا شروع شد که نوید خبر داد که چند ساعتی است یک وبلاگ وردپرسی که برای یکی از پروژه‌هاست ، عکس‌العمل‌های عجیب و غریب نشان می‌دهد! چطور؟ این که باکس متن بعضی از مطالب نشان داده نمی‌شوند. اولین">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-11-16T19:15:57+03:30">
</head>
<body>
  <a href="#content" class="sr-only sr-only-focusable">متن اصلی را نادیده بگیر</a>

  <div class="navigator">
    
  </div>

  <nav class="navbar navbar-default"><div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../"><img src="../assets/images/logo.png"></a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
<li>
<a href="../stories/about-me.html">درباره</a>
                </li>
<li>
<a href="../">رزومه</a>
                </li>
<li>
<a href="../archive.html">آرشیو</a>
                </li>
<li>
<a href="../categories/index.html">دسته‌ها</a>
                </li>
<li>
<a href="../rss.xml">خوراک</a>

                    
        </li>
</ul>
<!-- DuckDuckGo custom search --><form class="navbar-form navbar-left" role="search" method="get" id="search" action="//duckduckgo.com/">
<div class="input-group">
<input type="hidden" name="sites" value="https://5hah.in/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" class="form-control" placeholder="جستجو..."><span class="input-group-btn">
<input class="btn btn-default" type="submit" value="برو"></span>
</div>
</form>
<!-- End of custom search -->


      </div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container-fluid -->
  </nav><div class="jumbotron">
    <section class="container"><div id="headerbox" class="col-md-6 col-md-offset-3 text-center">
        <h1>شاهین</h1>
        <hr class="hdrline">
<a class="social" href="https://github.com/shahinism">
          <img src="../assets/images/github.png"></a>
        <a class="social" href="https://twitter.com/shahinism">
          <img src="../assets/images/twitter.png"></a>
        <a class="social" href="https://ir.linkedin.com/in/shahinism">
          <img src="../assets/images/linkedin.png"></a>
      </div>
    </section>
</div>

  <div class="container" id="content" role="main">
    <!--Body content-->
    <div class="col-md-6 col-md-offset-3">
      <div class="row">
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><div class="text-center">
          <h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">وقایع نگاری یک دیباگ: وقتی MySQL چیزی ذخیره نمی‌کند!</a></h1>

        شاهین
      <a href="#" rel="bookmark"><time class="published dt-published" datetime="2015-11-16T19:15:57+03:30" itemprop="datePublished" title="2015-11-16 19:15">2015-11-16 19:15</time></a>
    </div>
    
  </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>مشکل از آن‌جا شروع شد که <a class="reference external" href="http://navid.kashani.ir/">نوید</a> خبر داد که چند ساعتی است یک وبلاگ وردپرسی که برای یکی از <a class="reference external" href="http://foundersbuddy.com">پروژه‌هاست</a> ، عکس‌العمل‌های عجیب و غریب نشان می‌دهد! چطور؟ این که باکس متن بعضی از مطالب نشان داده نمی‌شوند. اولین حدسم این بود که شاید بخاطر تغییرات اخیری که در آدرس وبلاگ داده بودم همچین مشکلی پیش آمده و خواستم که تنظیمات را به حالت قبل برگردانند… و مشکل یپچیده‌تر شد! چطور؟ تنظیمات جدید ذخیره نمی‌شد.</p>
<p><a class="reference external" href="http://navid.kashani.ir/">نوید</a>  چند تایی روش پیشنهاد کرد تا شاید بتوانیم اطلاعات بیشتر در رابطه با وضعیت به دست بیاوریم. به سرور لاگین می‌کنم و… tab completion کار نمی‌کند. یک همچین اخطاری می‌دهد:</p>
<pre class="code bash"><a name="rest_code_1b014c5fba9c4b62808e79733fee9a3c-1"></a>bash: cannot create temp file <span class="k">for</span> here-document: No space left on device
</pre>
<p>خوب راست هم می‌گوید انگار… یک <cite>df -h</cite> معلوم می‌کند که پوشهٔ home کاربر حاضر‌، تا خرخره پر شده. یک فایل log که از <a class="reference external" href="http://5hah.in/posts/multithreading-bug-experiment-on-PyMongo-driver.html">دیباگ</a> قبلی باقیمانده، وزنش به ۵ گیگ رسیده و دیگر نمی‌تواند نفس بکشد.</p>
<pre class="code bash"><a name="rest_code_7f0f8e12c1a342e5a52b5332b43f5012-1"></a>rm -rfv PATH_TO_FAT_FILE
</pre>
<p>و دوباره <cite>df -h</cite>… و؟ فضا خالی نشده. فایل پاک نشده؟ <cite>ls -lh PATH_TO_FAT_FILE</cite> می‌گوید که همچین فایلی نداریم. ها از قرار آن پروسهٔ لاگ همچنان فعال است (این‌طوری سیستم فایل فضایش را بعد از پاک کردن فایل مذکور به روز نمی‌کند). پروسه چه بوده حالا؟ Only GOD knows :)</p>
<pre class="code bash"><a name="rest_code_08e9a763a685467d953bd4072e00159c-1"></a>ps -aux <span class="p">|</span> grep PATH_TO_FAT_FILE
</pre>
<p>امیدوار بودم که با شل پایپ کرده باشند که نه انگار… می‌دانم کار کیست ولی او هم به خاطر نمی‌آورد که دستور چه بوده. هوم… لینوکس دیگر اینقدر‌ها هم بی‌شعور نیست. راه حل خودش چیست؟ <cite>lsof</cite></p>
<pre class="code bash"><a name="rest_code_ea2f9b3e248d4a7283d20fc42c7c05f8-1"></a>lsof PATH_TO_FAT_FILE
</pre>
<p>حل شد؟ نه! همچین پروسه‌ای نداریم. یک کم پرزورتر می‌پرسیم:</p>
<pre class="code bash"><a name="rest_code_f3465a9a0a164224b89924b615628eb6-1"></a>sudo !!
</pre>
<p>ها ها، پیدا شد! یک <cite>kill -9</cite> مهمانش کردیم و حالا باید مشکل حل شده باش. ولی…</p>
<pre class="code bash"><a name="rest_code_8ef792b6dfa34da29aaff20c552655ea-1"></a>bash: cannot create temp file <span class="k">for</span> here-document: No space left on device
</pre>
<p>هوم… باز هم؟ می‌گوید temp، حالا اگر فرض بگیریم مثل آدم این‌جور فایل‌ها را در ‎/tmp ذخیره می‌کند، ۱.۵ گیگابایت فضای خالی داریم. پس این اخطار برای چیست؟ قضیه آن‌جا عجیب می‌شود که یک عالمه (عدد جدید است. یک کم بیشتر از خیلی زیاد :)) فایل یک کیلوبایتی داخل ‎/tmp ذخیره شده. محتوایش؟ چیز خاصی نیست. ولی چه ربطی می‌تواند به مشکل داشته باشد؟ کمی جستجو  و <cite>df -i</cite>:</p>
<pre class="code bash"><a name="rest_code_5b6c71785b0d419b85d5603e0d1cfab8-1"></a>...
<a name="rest_code_5b6c71785b0d419b85d5603e0d1cfab8-2"></a>tmpfs                             494K    494K   <span class="m">0</span>    100% /tmp
<a name="rest_code_5b6c71785b0d419b85d5603e0d1cfab8-3"></a>...
</pre>
<p>که چه؟ inode پر است؟ چی هست اصلا؟ به نقل از <a class="reference external" href="https://en.wikipedia.org/wiki/Inode">ویکی‌پدیا</a>:</p>
<blockquote>
آی‌نود (به انگلیسی: inode) به ساختمان داده‌هایی گفته می‌شود که در سیستم‌فایل‌های شبیه به یونیکس مانند UFS استفاده می‌شود. یک inode اطلاعات پایه‌ای در مورد فایل‌ها، دایرکتوری‌ها و اشیاء دیگر موجود در فایل‌سیستم را در خود نگهداری می‌کند.</blockquote>
<p>و خوب طبیعی است. اگر این فضا پر شده که دستور قبل همچین چیزی نشان می‌دهد، امکان ساختن فایل جدید وجود ندارد. یک find خوشگل سر هم می‌کنیم که همهٔ فایل‌های با اسم عجیب غریب یکسانشان را باطل کند. (در پست بعدی جریان این فایل‌ها را شرح می‌دهنم):</p>
<pre class="code bash"><a name="rest_code_dbd25e37eceb4fd381625bf0492823c4-1"></a>find -regextype posix-egrep -type f -regex <span class="s1">'.*[^/]{40}'</span> -delete
</pre>
<p>خیلی ساده یعنی هر فایلی که طول اسمش دقیقا ۴۰ کاراکتر است را پاک کن. و تست دوباره‌، auto completion به کار افتاده. خوب اصلا برای چه لاگین کرده بودیم؟ مشکل دیتابیس MySQL و وردپرس بود. یک بار دیگر صفحه را باز کنیم تا ببینیم دقیقا چه اتفاقی می‌افتد… و… عه؟ مشکل حل شده! بریم ببینیم تنظیمات جدید را ذخیره می‌کند؟ ها‌، آره آن هم حل شده. ضرب‌المثل ربط … به … این‌جا خیلی قشنگ صدق می‌کند :)</p>
<p>به هر حال چند تا درس گنده یاد گرفتم، همچین باگ‌هایی ارزش یک کلاس درس واقعی را دارند‌، این‌طور نیست؟</p>
</div>
    </div>
    <aside class="postpromonav"><nav><div class="bg-info">
        
      </div>
              <ul class="pager hidden-print">
<li class="previous">
                <a href="multithreading-bug-experiment-on-PyMongo-driver.html" rel="prev" title="وقایع نگاری یک دیباگ: وضعیت عجیب MongoDB">ارسال پیشین</a>
            </li>
            <li class="next">
                <a href="version-control-is-not-optional.html" rel="next" title="ورژن کنترل اختیاری نیست!">ارسال بعدی</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>دیدگاه‌‌‌ها</h2>
                        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="shahinism",
            disqus_url="https://5hah.in/posts/no-space-mysql-problem.html",
        disqus_title="\u0648\u0642\u0627\u06cc\u0639 \u0646\u06af\u0627\u0631\u06cc \u06cc\u06a9 \u062f\u06cc\u0628\u0627\u06af: \u0648\u0642\u062a\u06cc MySQL \u0686\u06cc\u0632\u06cc \u0630\u062e\u06cc\u0631\u0647 \u0646\u0645\u06cc\u200c\u06a9\u0646\u062f!",
        disqus_identifier="cache/posts/no-space-mysql-problem.html",
        disqus_config = function () {
            this.language = "fa";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="shahinism";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
    </div>
    <!--End of body content-->
  </div>

  <footer id="footer" class="site-footer">
    Contents © 2016         <a href="mailto:me@5hah.in">شاهین</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
    
  </footer><script src="../assets/js/jquery.min.js"></script><script src="../assets/js/bootstrap.min.js"></script><script src="../assets/js/moment-with-locales.min.js"></script><script src="../assets/js/fancydates.js"></script><script src="../assets/js/jquery.colorbox-min.js"></script><script src="../assets/js/colorbox-i18n/jquery.colorbox-fa.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("fa");
    fancydates(0, "YYYY-MM-DD HH:mm");
  </script><!-- end fancy dates -->
</body>
</html>
