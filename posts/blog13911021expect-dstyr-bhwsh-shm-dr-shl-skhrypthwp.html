<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="شاهین آزاد">
<title>expect دستیار باهوش شما در شل اسکریپت‌ها! | شاهین</title>
<link rel="stylesheet" href="../assets/css/style.css" type="text/css" media="screen">
<link href="../assets/css/custom.css" rel="stylesheet" type="text/css">
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
      <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS fa" href="../rss.xml/">
<link rel="icon" href="favicon.ico" sizes="32x32">
</head>
<body>
    <div class="container">
      <header><p>sometimes you gotta run before you can walk. <small><a href="https://en.wikipedia.org/wiki/Iron_Man">T Stark</a></small></p>
	<a class="nav-link" href="#navigation"></a>
      </header><!--/header--><div class="columns four">
  <article><h2 class="title">expect دستیار باهوش شما در شل اسکریپت‌ها!
</h2>
    <div class="metadata">
      <span class="date">2013-01-10 22:33</span>
      <span class="writer">شاهین آزاد</span>
    </div>
    <p>
      </p>
<p>اگر تا به حال شل اسکریپت نوشته باشید‌، اگر حد اعتیادتان به آن اندازه
باشد که بخواهید هر کاری را آسان‌تر کنید‌، اگر تنبلی‌تان گرفته باشد که
بعد از آسان شدن کار‌هایتان با یک شل اسکریپت‌، رمز‌های جاهای مختلف را به
یاد آورید تا اسکریپت‌تان درست کار کند‌‌، یا آن‌قدر به مغزتان فشار آورید
که جواب صحیح یک سوال اسکریپت را پیدا کنید‌، آن وقت‌ می‌توانید درک کنید
که expect چه ابزار خارق‌العاده‌ای است. کار expect خیلی ساده است‌، بعد از
اجرای اسکریپت‌تان‌، منتظر می‌ماند که اتفاق خاصی رخ دهد‌، مثلا دستوری در
اسکریپت از شما رمز بخواهد‌، آن وقت expect وارد میدان می‌شود و رمز را
وارد می‌کند. یعنی دیگر نیازی نیست که شما دخالتی داشته باشید. اگر فکر
می‌کنید که خوب این که کار سختی نیست و از این حرف‌ها که خوب اول باید
بگویم که کور خوانده‌اید و دوم این که بی‌خیال ادامهٔ این متن شوید ;-)
حالا شیوهٔ عملکرد expect معلوم شد‌، بهتر است نگاهی بیاندازیم به وضعیت
من. بنا به دلایل کاملا غیر عادی و نامعلومی‌، در کشوری کاملا آزاد‌، نیاز
دارم که از sshuttle برای انجام برخی امور استفاده کنم. این برنامه برای
انجام دادن درست کار‌هایش‌، نیاز به iptables دارد که خوب من دوست ندارم که
کاربر عادی‌ام به آن دسترسی داشته باشد. پس همین دوست نداشتن من یک مرحلهٔ
اضافه در فرآیند استفاده از sshuttle هزینه دارد. یعنی یک همچین چیزی:
```bash su Vared Kardan Ramz cd /home/shahin/bin/sshutle ./sshuttle
... Vared Kardan Ramz ``` که خوب بعد از اولین تلاش کانکت نمی‌شود و
باید دوباره دستور را بزنم و منتظر بمانم تا پرامپت رمز ssh ظاهر شود و
باقی قضایا. خوب کمی سخت است. البته این را هم اضافه کنم که خوب می‌دانم
می‌توانم کانکت بدون رمز ssh داشته باشم‌. می‌توانم دستور را درون یک path
قرار دهم. می‌توانم‌، می‌توانم‌… ولی این روشی است که من کار می‌کنم ;-)
این است که دست به دامن expect می‌شوم و همچین اسکریپتی می‌نویسم:
```bash #!/usr/bin/expect -f if {[llength $argv] != 5} { puts "usage:
ssh.exp client_root_pass username password server port" exit 1 } set
rootpass [lrange $argv 0 0] set username [lrange $argv 1 1] set password
[lrange $argv 2 2] set server [lrange $argv 3 3] set port [lrange $argv
4 4] set timeout -1 spawn su -c "/home/shahin/bin/sshuttle/sshuttle
--dns -r <a class="reference external" href="mailto:%24username@%24server">$username@$server</a>:$port 0/0 -vv" match_max 100000 expect
"Password:*" send -- "$rootpass\r" expect "*?assword:*" send --
"$password\r" send -- "\r" expect eof ``` حالا همانطور که معلوم است
کافی است همچین دستوری را تایپ کنم: ```bash ./ssh.exp
client_root_pass username password server port ``` حالا می‌شود این
اسکریپت را بدون هیچ ضرر اضافه‌ای به path اضافه کرد و حالش را برد. برای
این که بفهمید این اسکریپت چطور کار می‌کند راهنما‌های زیادی در اینترنت
می‌یابید. man page خود برنامه هم می‌تواند کمک خوبی باشد. ضمن این که اگر
اسکریپت نویسی بدانید‌، چیز زیادی برای یاد گرفتن پیش‌رویتان نیست ;-)</p>
    
    <div class="pageNav">
      <ul class="pager">
<div class="prev">
    <a href="blog139110136-sl-blg-nwsywp.html">← ارسال پیشین</a>
  </div>
  <div class="next">
    <a href="blog13911103chtwr-z-wbstgy-bh-gythb-frr-khnym-pwp.html">ارسال بعدی →</a>
  </div>
  </ul>
</div>
    <div class="postMeta">
        <section class="comments hidden-print"><h2>دیدگاه‌‌‌ها</h2>
                          <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="shahinism",
            disqus_url="http://5hah.in/posts/blog13911021expect-dstyr-bhwsh-shm-dr-shl-skhrypthwp.html",
        disqus_title="expect \u062f\u0633\u062a\u06cc\u0627\u0631 \u0628\u0627\u0647\u0648\u0634 \u0634\u0645\u0627 \u062f\u0631 \u0634\u0644 \u0627\u0633\u06a9\u0631\u06cc\u067e\u062a\u200c\u0647\u0627!",
        disqus_identifier="cache/posts/blog13911021expect-dstyr-bhwsh-shm-dr-shl-skhrypth.wp.html",
        disqus_config = function () {
            this.language = "fa";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section>
</div>
  </article>
</div>
<!--columns four-->
    </div>
<!--container-->

    <nav id="navigation"><div class="logo"></div>
      
<!-- Custom search -->
<form method="get" id="search" action="http://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="http://5hah.in/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" placeholder="جستجو…" maxlength="255" name="q"><input id="searchsubmit" type="submit" value="DDG Search">
</form>
<!-- End of custom search -->

      <ul>
<li><a class="nav-icon home" href="../">Home</a></li>
      <li><a class="nav-icon about" href="../stories/about-me.html">About</a></li>
      <li><a class="nav-icon resume" href="../">Resume</a></li>
      <li><a class="nav-icon archives" href="../archive.html">Archives</a></li>
      <li><a class="nav-icon tags" href="../categories/index.html">Tags</a></li>
      <li><a class="nav-icon rss" href="../rss.xml">RSS</a></li>

      </ul>
<!--/ul--></nav><!--/navigation--><!--/container--><footer class="container"><div class="columns one">
    <h2>About</h2>
    <p>Not much yet!</p>
  </div>
  <div class="columns one">
    <h2>Social</h2>
    <p class="center">
      <a class="social github" href="http://github.com/shahinism"></a>
      <a class="social twitter" href="http://twitter.com/shahinism"></a>
      <a class="social lastfm" href="http://last.fm/shahinism"></a>
      <a class="social reddit" href="http://reddit.com/user/shahinism"></a>
    </p>
<!-- center -->
  </div>
  <div class="columns one">
    <h2>Projects</h2>
  </div>
<!-- column one -->
  <div class="columns one">
    <h2>Links</h2>
  </div>
  <div class="columns four copyright">
    <p> Contents © 2015         <a href="mailto:me@5hah.in">شاهین آزاد</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>          </p>
    <p>Designed by <a href="http://5hah.in">Shahin Azad</a>. All rights reserved.</p>
  </div>
</footer><!--/container-->
</body>
</html>
