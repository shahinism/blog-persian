<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" dir="rtl" lang="fa">
<head>
<meta charset="utf-8">
<base href="http://5hah.in/posts/blog13911021expect-dstyr-bhwsh-shm-dr-shl-skhrypth.html">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>expect دستیار باهوش شما در شل اسکریپت‌ها! | شاهین</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="http://5hah.in/posts/blog13911021expect-dstyr-bhwsh-shm-dr-shl-skhrypth.html">
<link rel="icon" href="favicon.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><meta name="author" content="شاهین آزاد">
<link rel="prev" href="blog139110136-sl-blg-nwsy.html" title="۶ سال شاهینیسم" type="text/html">
<link rel="next" href="blog13911103chtwr-z-wbstgy-bh-gythb-frr-khnym-p.html" title="چطور از وابستگی به گیت‌هاب فرار کنیم: پشتیبان‌گیری از مخازن گیت" type="text/html">
<meta property="og:site_name" content="شاهین">
<meta property="og:title" content="expect دستیار باهوش شما در شل اسکریپت‌ها!">
<meta property="og:url" content="http://5hah.in/posts/blog13911021expect-dstyr-bhwsh-shm-dr-shl-skhrypth.html">
<meta property="og:description" content="حالا شیوهٔ عملکرد expect معلوم شد‌، بهتر است نگاهی بیاندازیم به وضعیت من. بنا به دلایل کاملا غیر عادی و نامعلومی‌، در کشوری کاملا آزاد‌، نیاز دارم که از sshuttle برای انجام برخی امور استفاده کنم. این ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2013-01-10T22:33:39+03:30">
</head>
<body>
  <a href="#content" class="sr-only sr-only-focusable">متن اصلی را نادیده بگیر</a>

  <div class="navigator">
    
  </div>

  <nav class="navbar navbar-inverse"><div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../"><img src="../assets/images/logo.png"></a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
<li>
<a href="../stories/about-me.html">درباره</a>
                </li>
<li>
<a href="../">رزومه</a>
                </li>
<li>
<a href="../archive.html">آرشیو</a>
                </li>
<li>
<a href="../categories/index.html">دسته‌ها</a>
                </li>
<li>
<a href="../rss.xml">خوراک</a>

                    
        </li>
</ul>
<!-- DuckDuckGo custom search --><form class="navbar-form navbar-left" role="search" method="get" id="search" action="//duckduckgo.com/">
<div class="input-group">
<input type="hidden" name="sites" value="http://5hah.in/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" class="form-control" placeholder="جستجو..."><span class="input-group-btn">
<input class="btn btn-default" type="submit" value="برو"></span>
</div>
</form>
<!-- End of custom search -->


      </div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container-fluid -->
  </nav><div class="jumbotron">
    <section class="container"><div class="col-md-6 col-md-offset-3 text-center">
        <h1>شاهین</h1>
        <hr class="hdrline">
<a class="social" href="https://twitter.com/shahinism">
          <img src="../assets/images/github.png"></a>
        <a class="social" href="https://github.com/shahinism">
          <img src="../assets/images/twitter.png"></a>
        <a class="social" href="https://ir.linkedin.com/in/shahinism">
          <img src="../assets/images/linkedin.png"></a>
      </div>
    </section>
</div>

  <div class="container" id="content" role="main">
    <!--Body content-->
    <div class="col-md-6 col-md-offset-3">
      <div class="row">
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><div class="text-center">
          <h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">expect دستیار باهوش شما در شل اسکریپت‌ها!</a></h1>

        شاهین آزاد
      <a href="#" rel="bookmark"><time class="published dt-published" datetime="2013-01-10T22:33:39+03:30" itemprop="datePublished" title="2013-01-10 22:33">2013-01-10 22:33</time></a>
    </div>
    
  </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>حالا شیوهٔ عملکرد expect معلوم شد‌، بهتر است نگاهی بیاندازیم به وضعیت من. بنا به دلایل کاملا غیر عادی و نامعلومی‌، در کشوری کاملا آزاد‌، نیاز دارم که از sshuttle برای انجام برخی امور استفاده کنم. این برنامه برای انجام دادن درست کار‌هایش‌، نیاز به iptables دارد که خوب من دوست ندارم که کاربر عادی‌ام به آن دسترسی داشته باشد. پس همین دوست نداشتن من یک مرحلهٔ اضافه در فرآیند استفاده از sshuttle هزینه دارد. یعنی یک همچین چیزی:</p>
<pre class="code literal-block">su

Vared Kardan Ramz

<span class="nb">cd</span> /home/shahin/bin/sshutle

./sshuttle ...

Vared Kardan Ramz
</pre>


<p>که خوب بعد از اولین تلاش کانکت نمی‌شود و باید دوباره دستور را بزنم و منتظر بمانم تا پرامپت رمز ssh ظاهر شود و باقی قضایا. خوب کمی سخت است. البته این را هم اضافه کنم که خوب می‌دانم می‌توانم کانکت بدون رمز ssh داشته باشم‌. می‌توانم دستور را درون یک path قرار دهم. می‌توانم‌، می‌توانم‌… ولی این روشی است که من کار می‌کنم ;-)</p>
<p>این است که دست به دامن expect می‌شوم و همچین اسکریپتی می‌نویسم:</p>
<pre class="code literal-block"><span class="c">#!/usr/bin/expect -f</span>



<span class="k">if</span> <span class="o">{[</span>llength <span class="nv">$argv</span><span class="o">]</span> !<span class="o">=</span> 5<span class="o">}</span> <span class="o">{</span>
    puts <span class="s2">"usage: ssh.exp client_root_pass username password server port"</span>
<span class="nb">exit </span>1

<span class="o">}</span>



<span class="nb">set </span>rootpass <span class="o">[</span>lrange <span class="nv">$argv</span> <span class="m">0</span> 0<span class="o">]</span>

<span class="nb">set </span>username <span class="o">[</span>lrange <span class="nv">$argv</span> <span class="m">1</span> 1<span class="o">]</span>

<span class="nb">set </span>password <span class="o">[</span>lrange <span class="nv">$argv</span> <span class="m">2</span> 2<span class="o">]</span>

<span class="nb">set </span>server <span class="o">[</span>lrange <span class="nv">$argv</span> <span class="m">3</span> 3<span class="o">]</span>

<span class="nb">set </span>port <span class="o">[</span>lrange <span class="nv">$argv</span> <span class="m">4</span> 4<span class="o">]</span>



<span class="nb">set </span>timeout -1



spawn su -c <span class="s2">"/home/shahin/bin/sshuttle/sshuttle --dns -r </span><span class="nv">$username</span><span class="s2">@</span><span class="nv">$server</span><span class="s2">:</span><span class="nv">$port</span><span class="s2"> 0/0 -vv"</span>

match_max 100000

expect <span class="s2">"Password:*"</span>

send -- <span class="s2">"</span><span class="nv">$rootpass</span><span class="s2">\r"</span>



expect <span class="s2">"*?assword:*"</span>

send -- <span class="s2">"</span><span class="nv">$password</span><span class="s2">\r"</span>

send -- <span class="s2">"\r"</span>

expect eof
</pre>


<p>حالا همانطور که معلوم است کافی است همچین دستوری را تایپ کنم:</p>
<pre class="code literal-block">./ssh.exp client_root_pass username password server port
</pre>


<p>حالا می‌شود این اسکریپت را بدون هیچ ضرر اضافه‌ای به path اضافه کرد و حالش را برد. برای این که بفهمید این اسکریپت چطور کار می‌کند راهنما‌های زیادی در اینترنت می‌یابید. man page خود برنامه هم می‌تواند کمک خوبی باشد. ضمن این که اگر اسکریپت نویسی بدانید‌، چیز زیادی برای یاد گرفتن پیش‌رویتان نیست ;-)</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="blog139110136-sl-blg-nwsy.html" rel="prev" title="۶ سال شاهینیسم">ارسال پیشین</a>
            </li>
            <li class="next">
                <a href="blog13911103chtwr-z-wbstgy-bh-gythb-frr-khnym-p.html" rel="next" title="چطور از وابستگی به گیت‌هاب فرار کنیم: پشتیبان‌گیری از مخازن گیت">ارسال بعدی</a>
            </li>
        </ul></nav></aside></article><script>var disqus_shortname="shahinism";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
    </div>
    <!--End of body content-->
  </div>

  <footer id="footer" class="site-footer">
    Contents © 2015         <a href="mailto:me@5hah.in">شاهین آزاد</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
    
  </footer><script src="../assets/js/all-nocdn.js"></script><script src="../assets/js/colorbox-i18n/jquery.colorbox-fa.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("fa");
    fancydates(0, "YYYY-MM-DD HH:mm");
  </script><!-- end fancy dates -->
</body>
</html>
