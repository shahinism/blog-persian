<!DOCTYPE html><html lang="fa"><head><meta charset="utf-8"><meta name="description" content=""><meta name="author" content="شاهین آزاد"><title>پشتیبان‌گیری با rsync, cron, dropbox | شاهینیسم</title><link href="../assets/css/rst.css" rel="stylesheet" type="text/css"><link href="../assets/css/code.css" rel="stylesheet" type="text/css"><link href="../assets/css/colorbox.css" rel="stylesheet" type="text/css"><link href="../assets/css/theme.css" rel="stylesheet" type="text/css"><link href="../assets/css/custom.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
<![endif]--><link rel="alternate" type="application/rss+xml" title="RSS fa" href="../rss.xml"></head><body class="home blog">
    
    <script type="text/javascript">var addthis_config={"ui_language":"${lang}"};</script><div id="siteWrapper">
      <h1 id="vcard author">
        <a href="../" title="شاهینیسم">شاهینیسم</a>
        <a href="http://internetdefenseleague.org"><img src="http://internetdefenseleague.org/images/badges/final/footer_badge.png" alt="Member of The Internet Defense League" style="float: left; position: absolute; margin: 0px 90px;"></a>
      </h1>

      <div id="mainNav">
        <ul><li><a href="../stories/drbrh-mn-2.html">About</a>



  </li><li><a href="../archive.html">Archives</a>



  </li><li><a href="../categories/index.html">Tags</a>



  </li><li><a href="http://feeds.feedburner.com/Shahinism">RSS</a>


</li>
        </ul></div>
      <div id="siteDescription">
        
        
        
      </div>
      <div id="coreContent" class="hfeed">
        
<div id="coreContent">
  <div class="post single hentry">
    <div class="postContent">
      <h3 class="entry-title">
<h1>پشتیبان‌گیری با rsync, cron, dropbox</h1>

</h3>
      <div class="entry-content">
        <p>خوب قربانش بروم‌، با <a class="reference external" href="http://shahinism.github.io/posts/blog13910825wqty-dzdy-mykhnmnyd.html">اعجوبه‌ای</a> که به نام اینترنت به ما می‌فروشند‌، زیاد سعادت آن را نداریم که از Cloud و امکاناتش در هر زمینه که لازم بود بهره ببریم. این است که عمدتا بیخودی مجبوریم به خودمان استرس وارد کنیم. مساله این‌جاست که تا همین چند وقت پیش من از سرویس‌های تحت وب برای مدیریت برخی از اطلاعات مهم‌ام استفاده می‌کردم. اما الان دیگر بنا به دلایلی به آن‌ها بی‌اعتماد شده‌ام. این است که این فایل‌ها و ابزار‌های مورد نیازم را روی سیستم خودم دارم و حالا با روش‌هایی که طی پست‌های بعد می‌گویم‌، به روز و نگهداری‌شان می‌کنم.</p>
<p>ولی نکته این‌جاست که با این کار مهم‌ترین مزیت سیستم‌های تحت وب را از دست داده‌ام. چطور؟ اول این که قابلیت انتقال این فایل‌های مهم را از دست داده‌ام و ثانیا این که نمی‌توانم ازشان یک backup درست درمان داشته باشم! نمی‌توانم؟ خوب دروغ گفتم‌، قرار است در نگاه اول این‌طور به نظر برسد! با چند ابزار ساده و به درد بخور لینوکسی، کمی هم چاشنی <a class="reference external" href="http://dropbox.com">Dropbox</a> ‌، هم می‌شود قابلیت انتقال را داشت و هم backup!</p>
<div class="section" id="dropbox">
<h2>Dropbox را نصب کنید</h2>
<p>خوشبختانه <a class="reference external" href="http://dropbox.com">dropbox</a> یک نرم‌افزار متن‌باز GPL‌ایه خوب برای لینوکس دارد که قابلیت Sync کردن فایل‌ها با اکانت dropbox‌مان را بهمان می‌دهد. آن را متناسب با توزیع‌تان پیدا و نصب کنید. مثلا من از این <a class="reference external" href="http://slackbuilds.org/repository/14.0/network/dropbox/">SlackBuild</a> استفاده کردم.</p>
<p>بعد از نصب احتمالا اگر خودتان دستکاری‌اش نکرده باشید <strong>‎~/Dropbox</strong> پوشه‌ای است که قرار است با اکانت‌تان Sync شود. من آن را در مسیر دیگری قرار دادم. شما هم می‌توانید بسته به نیاز‌تان مسیر بهتری را انتخاب کنید. هر چه باشد فایل‌های مهمی تویش است‌، خوبیت ندارد همین‌طوری توی چشم باشد که ;-)</p>
<p>برای اجرای خودکار این برنامه در هنگام ورود به سیستم کافیست دستور <strong>dropboxd</strong> را در هنگام ورود به محیط‌کار‌تان اجرا کنید. یعنی یا آن را به فایل <strong>‎~/.xinitrc</strong> تان اضافه کنید. یا مثل من بگذارید توی تنظیمات i3 که اجرا شود. روش‌های دیگری هم هست‌، ولی همین یکی فکر کنم کفایت کند‌!</p>
</div>
<div class="section" id="backup">
<h2>اسکریپت backup</h2>
<p>حالا که تنها کافیست فایل‌های مهم‌مان را درون یک پوشه بریزیم تا خود به خود روی <a class="reference external" href="http://dropbox.com">Dropbox</a> کپی شود‌، یک اسکریپت می‌خواهیم که این کار را به نحو مناسبی برای‌مان انجام دهد. عملا کپی (cp) کردن فایل جواب مساله‌مان نیست. چطور؟ خوب ممکن است بخواهیم فایل‌مان را تغییر دهیم یا چه می‌دانم‌، فایل خاصی به دایرکتوری اضافه کنیم. این است که دوست قدیمی‌مان rsync را صدا می‌زنیم. اسکریپت من یک هم‌چین چیزی از آب در آمد:</p>
<pre class="code bash literal-block">
rsync -a -v ~/.pwsafe* ~/Workspace/Dropbox/safe
rsync -r -v ~/Workspace/org ~/Workspace/Dropbox
</pre>
<p>سر راست است این‌طور نیست؟ فعلا شروع کار است‌، احتمالا در آینده عملش طولانی‌تر هم می‌شود‌، ولی احتمالا باز هم به همین سادگی‌ست. حالا کافیست هر بار آن را اجرا کنم تا فایل‌ها خیلی تمیز کپی شوند داخل پوشهٔ <a class="reference external" href="http://dropbox.com">dropbox</a> ام و برنامهٔ dropbox آن را برایم بفرستد روی Cloud!</p>
</div>
<div class="section" id="id2">
<h2>اجرای خود‌کار اسکریپت</h2>
<p>الان هم اسکریپت‌مان خوب کار می‌کند و هم پوشهٔ <a class="reference external" href="http://dropbox.com">dropbox</a> فایل‌ها را خیلی راحت روی Cloud می‌فرستد. ولی هنوز یک ضعف وجود دارد. این که هر بار باید خودم یادم باشد که اسکریپت را اجرا کنم. خوب با این حافظهٔ من‌، می‌دانم که کل این پروسهٔ backup‌گیری با شکست مواجه می‌شود. اولین انتخابم این است که مثلا کاری کنم که موقع خاموش‌کردن سیستم این اسکریپت اجرا شود که چندان عقلانی به نظر نمی‌رسد! به هر حال اینترنت ماست دیگر‌! همیشه که سر حال نیست.</p>
<p>این است که به سراغ آن یکی دوست قدیمی‌مان می‌رویم‌، cron! وظیفهٔ این دوست‌مان این است که یک دستوری را بگیرد و به طبق زمان‌بندی خاصی اجرایش کند. اگر درست نمی‌شناسیدش کافیست یک سری به manpage‌اش بزنید و یا <a class="reference external" href="http://www.cyberciti.biz/faq/how-do-i-add-jobs-to-cron-under-linux-or-unix-oses/">این پست cyberciti</a> را بخوانید.</p>
<p>برای اضافه‌کردن یک job جدید‌، کافیست دستور <strong>crontab -e</strong> را وارد کنیم. خودش فایل را باز می‌کند و نوبت ویرایش شما می‌رسد. اما قبل از آن بهتر است که تعیین کنید که کدام ویرایش‌گر برای این کار استفاده شود. خودش به صورت پیش‌فرض از vi استفاده می‌کند که من دوستش ندارم. این است که با گذاشتن <strong>export EDITOR=vim</strong> داخل ‎~/.zshrc‌ام بهش می‌گویم که از vim استفاده کند که بسیار قابل تحمل‌تر است.</p>
<p>حالا خط زیر را به عنوان job اضافه می‌کنم.</p>
<pre class="code literal-block">
@hourly ID=backup-hourly /home/shahin/Workspace/bin/dropbackup.sh &gt; /home/shahin/.cronstatus
</pre>
<p>یعنی هر ساعت (‎@hourly) دستور dropbackup.sh را اجرا کن و خروجی‌اش را جای ایمیل کردن برایم (ایمیل داخل خود سیستم منظورم است) آن را درون فایل ‎.cronstatus ذخیره کن. به همین راحتی ;-)</p>
<p><strong>ویرایش اول</strong>: تگ ID حتما باید در دستور وجود داشته باشد‌، در غیر این صورت دستور به درستی عمل نمی‌کند.</p>
</div>
      </div>
      <div class="postMeta">
        <div class="postDate"><span>ارسال شده:</span> <abbr class="published">2013-05-28 10:25</abbr></div>
        


        <div class="categories">

<span>ارسال‌های بیشتر دربارهٔ</span>

<a class="tag" href="../categories/dropbox.html"><span class="badge-info">dropbox</span></a>

<a class="tag" href="../categories/crontab.html"><span class="badge-info">crontab</span></a>

<a class="tag" href="../categories/cron.html"><span class="badge-info">cron</span></a>

<a class="tag" href="../categories/rsync.html"><span class="badge-info">rsync</span></a>

<a class="tag" href="../categories/backup.html"><span class="badge-info">backup</span></a>


</div>
      </div>
    </div>

    <div class="pageNav">
      
<ul class="pager"><div class="prev">
    <a href="introduction-to-irc.html">← ارسال پیشین</a>
  </div>
  
  
  <div class="next">
    <a href="emacs-as-a-terminal-emulator.html">ارسال بعدی →</a>
  </div>
  
  </ul></div>
    <div class="postMeta">
      
      
    
        <div id="disqus_thread"></div>
        <script type="text/javascript">
        var disqus_shortname ="shahinism";
        
            var disqus_url="http://shahinism.github.io/posts/backup_with_dropbox.html";
        
        var disqus_title="\u067e\u0634\u062a\u06cc\u0628\u0627\u0646\u200c\u06af\u06cc\u0631\u06cc \u0628\u0627 rsync, cron, dropbox";
        var disqus_identifier="cache/posts/backup_with_dropbox.html";
        var disqus_config = function () {
            this.language = "";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    

      
    </div>

  </div>
</div>
  
      </div>
    </div>
    <div id="footer">
      <h5>Elsewhere</h5>
      <ul class="elsewhere"><a href="https://plus.google.com/117086743723717964659/posts">Google Plus</a> |
<a href="http://www.goodreads.com/user/show/4795670-shahin-azad">Good Reads</a> |
<a href="https://identi.ca/shahinism">Identica</a> |
<a href="http://twitter.com/shahinism">Twitter</a> |
<a href="https://github.com/shahinism">Github</a>
      </ul><div class="footerContent">
        
<!-- Custom search -->
<form method="get" id="searchform" action="http://duckduckgo.com/">
<div id="search">
<input type="hidden" name="sites" value="http://shahinism.github.io"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="جستجو…"><input type="submit" id="searchsubmit" value="DDG Search"></div>
</form>
<!-- End of custom search -->

        <p> Contents © 2013 <a href="mailto:ishahinism@gmail.com">شاهین آزاد</a> - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a> </p>
        <p> Design by <a href="http://themes.jimbarraud.com/manifest/">Jimbarraud</a> + some <a href="http://shahinism.com">Shahinism</a> twists. </p>
      </div>
    </div>
    
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23874419-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></body></html>