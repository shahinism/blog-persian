<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="شاهین آزاد">
<title>دریافت متن ترانهٔ MP3 با لینوکس | شاهین</title>
<link rel="stylesheet" href="../assets/css/style.css" type="text/css" media="screen">
<link href="../assets/css/custom.css" rel="stylesheet" type="text/css">
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
      <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS fa" href="../rss.xml/">
<link rel="icon" href="favicon.ico" sizes="32x32">
</head>
<body>
    <div class="container">
      <header><p>sometimes you gotta run before you can walk. <small><a href="https://en.wikipedia.org/wiki/Iron_Man">T Stark</a></small></p>
	<a class="nav-link" href="#navigation"></a>
      </header><!--/header--><div class="columns four">
  <article><h2 class="title">دریافت متن ترانهٔ MP3 با لینوکس
</h2>
    <div class="metadata">
      <span class="date">2013-02-07 20:03</span>
      <span class="writer">شاهین آزاد</span>
    </div>
    <p>
      </p>
<div>
<p>بله‌، بله‌، خودم خوب می‌دانم که هزار و یک برنامهٔ پخش MP3 آن بیرون است
که این کار را خودشان مثل آدم انجام می‌دهند. ولی Nokia N70 بنده‌، شعورش
به این چیز‌ها قد نمی‌دهد. همین‌قدر هم که می‌تواند فایل صوتی پخش کند‌،
جای شکرش باقی است. خوب حقیقتش می‌شود که با خرج کمی GPRS و البته با یک
کمی انگولک این متن‌ها را پیدا کرد‌. ولی خوب کالیبر‌، بالا‌تر از این
حرف‌هاست. این است که تصمیم گرفتم‌، برای این کار برنامه‌ای سر هم کنم.</p>
<div class="section" id="id1">
<h2>مقدمات</h2>
<p>اولین قدم‌، پیدا کردن سایتی بود که هم متن ترانه‌ها را به قدر کفایت داشته
باشد‌، هم یک API درست درمان‌، یعنی رابطی که بتوان مثل آدم از طریق برنامه
با آن به تبادل داده پرداخت نیز ارائه کند. خوب‌، خوشبختانه‌، این
خارجکی‌ها‌، بر خلاف ما‌، سایت بدرد بخور زیاد دارند. پس انتخاب‌هایم خیلی
زیاد بودند. اما کمی بیشتر که جستجو کردم دیدم <a class="reference external" href="https://gist.github.com/febuiles/1549991">آدم
سالاری</a> قبلا همچین اسکریپتی
نوشته که مثل چــی هم کار می‌کند ;-) اصل اسکریپت همچین جایی است:
```bash curl -s
"<a class="reference external" href="http://makeitpersonal.co/lyrics?artist=%24artist&amp;title=%24title">http://makeitpersonal.co/lyrics?artist=$artist&amp;title=$title</a>" ```
خیلی ساده با curl یک درخواست به API سایت می‌فرستیم که در آن ‎$artist اسم
خوانندهٔ ترانه و ‎$title اسم خود ترانه است. که البته‌، چون url‌ها نحو
(Syntax) خاص خودشان را دارند‌، این اسکریپت‌نویس دوست داشتنی ما‌، با دو
خط زیر‌، اسم خواننده و ترانه را معتبر می‌کند: ```bash artist=`perl
-MURI::Escape -e 'print uri_escape($ARGV[0]);' "$artist_name"`
title=`perl -MURI::Escape -e 'print uri_escape($ARGV[0]);'
"$song_title"` ``` همین‌؟ تمام شد؟‌ خوب این اسکریپت کاری که
می‌خواستیم را انجام داد. ولی شاهین را که می‌شناسید‌. دوست دارد کار‌هایش
را
<a class="reference external" href="http://shahinism.com/blog/1390/09/26/%da%86%e2%80%8c%da%86%e2%80%8c%da%86-%db%b9-%da%86%d8%b7%d9%88%d8%b1-%d8%a8%d9%87-%d8%b5%d9%88%d8%b1%d8%aa-%d9%81%d9%84%d9%87%e2%80%8c%d8%a7%db%8c-%d9%84%db%8c%d9%86%da%a9%e2%80%8c%d9%87%d8%a7/">فله‌ای</a>
انجام دهد! یک کمی سخت است که هر بار بیایم اسم ترانه و خواننده را به
اسکریپت بگویم‌، بعد شیلنگ خروجی را بگیرم توی یک فایلی که می‌خواهم و از
این حرف‌ها. پس می‌رویم سراغ دستکاری بیشتر این اسکریپت.</p>
</div>
<div class="section" id="id2">
<h2>خجالت بکش شاهین</h2>
<p>حتما می‌دانید که می‌توان به فایل‌های MP3 تگ زد. همین تگ‌هایی که اسم
خواننده و ترانه و ژانر و این‌جور حرف‌ها را می‌توان بهشان خوراند که تا
دست آخر با MP3 Player خیلی راحت‌تر بشود سر و سامان‌شان داد. البته اگر
راست کار‌تان<a class="reference external" href="http://shahinism.com/blog/1389/01/15/%d9%85%d9%88%d8%b3%db%8c%d9%82%db%8c_%d8%af%d8%b1_%d9%88%d8%a8_%d9%81%d8%a7%d8%b1%d8%b3%db%8c%e2%80%8c/">سایت‌های موسیقی
ایرانی</a>
است‌، از این تگ‌ها مطمئنا خیری نسیب‌تان نشده‌، چون از دَم مثل ندید
بدید‌ها پرش کرده‌اند با آدرس سایت داغان‌شان ;-) به هر حال‌، از آن‌جایی
که آلبوم موسیقی مورد نظر من‌، مثل آدم تگ خورده بود‌، قصد داشتم تا از این
تگ‌ها استفاده کنم. همیشه هم در مخیله‌ام این‌طور تصور می‌کردم که این
تگ‌ها با یک روش مخوفی درون فایل موسیقی که اصلا نمی‌دانم چیست قایم
شده‌اند و خواندن‌شان نیاز به کتاب‌خانه‌ای چیزی دارد که من از طرز کارش سر
در نمی‌آورم. این بود که قصد داشتم اصلا کل اسکریپت را به برنامه‌ای به
پایتون تغییر دهم. ولی خوب‌، یک سرچ کوچک کردم و کلی <strong>خجالت کشیدم</strong>.
همان‌طور که در<a class="reference external" href="http://phoxis.org/2011/08/24/bash-script-reading-id3v1-tags/">این
لینک</a>
توضیح داده شده‌، عموما‌، ۱۲۸ بیت آخر فایل MP3 شامل تگ‌های آن است. و
ابزار‌های به ظاهر سادهٔ گنو/لینوکسی‌، مثل چـــی‌، کمک‌مان می‌کنند که این
تگ‌ها را بخوانیم‌. ببینید: ```bash tag=$(tail -c128 "$file" | tr
'\0' ' ') id3=$(head -c10 "$file" | tr '\0' ' ') ```</p>
</div>
<div class="section" id="id3">
<h2>سر هم کردن اسکریپت نهایی</h2>
<p>دیگر حالا‌، هم همهٔ ابزار‌های مورد نیاز‌مان را داریم‌، هم کلی چیز جدید
یاد گرفته‌ایم. این است که‌، اسکریپت نهایی را سر هم می‌کنیم. که می‌توانید
از <a class="reference external" href="https://github.com/shahinism/Scripts/blob/master/Shell/lyric">این
لینک</a>
دریافتش کنید. برای استفاده از آن هم کافیست که اسم هر تعداد ترانهٔ MP3 را
که دل‌تان می‌خواهد در جلویش تایپ کنید تا خودش باقی کار‌ها را انجام دهد.
<strong>نکته:</strong> خوب گاها پیش می‌آید که اسم ترانه‌، شامل کلماتی نظیر (Live) و
یا (Bonus) باشد. و یا شاید اسم سایتی‌، چیزی را شامل شود. در این صورت‌،
احتمالا API ما بر می‌گرداند که چیزی پیدا نکردم و از این حرف‌ها‌. ولی
اسکریپت بیشعور ما آن را هم درون یک فایل هم اسم ترانه با فرمت txt ذخیره
می‌کند. این‌جایش را دیگر خودتان می‌توانید با هنر دستکاری فایل
لینوکسی‌تان‌، راست و ریست کنید ;-)</p>
</div>
</div>
    
    <div class="pageNav">
      <ul class="pager">
<div class="prev">
    <a href="blog13911111chr-gnwlynwkhs-r-dwst-drm-bh-sbkh-shhywp.html">← ارسال پیشین</a>
  </div>
  <div class="next">
    <a href="blog13920107yn-ymkhs-dwst-dshtny-mqdmhwp.html">ارسال بعدی →</a>
  </div>
  </ul>
</div>
    <div class="postMeta">
        <section class="comments hidden-print"><h2>دیدگاه‌‌‌ها</h2>
                          <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="shahinism",
            disqus_url="http://5hah.in/posts/blog13911119dryft-mtn-trnhhy-mp3-b-lynwkhswp.html",
        disqus_title="\u062f\u0631\u06cc\u0627\u0641\u062a \u0645\u062a\u0646 \u062a\u0631\u0627\u0646\u0647\u0654 MP3 \u0628\u0627 \u0644\u06cc\u0646\u0648\u06a9\u0633",
        disqus_identifier="cache/posts/blog13911119dryft-mtn-trnhhy-mp3-b-lynwkhs.wp.html",
        disqus_config = function () {
            this.language = "fa";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section>
</div>
  </article>
</div>
<!--columns four-->
    </div>
<!--container-->

    <nav id="navigation"><div class="logo"></div>
      
<!-- Custom search -->
<form method="get" id="search" action="http://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="http://5hah.in/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" placeholder="جستجو…" maxlength="255" name="q"><input id="searchsubmit" type="submit" value="DDG Search">
</form>
<!-- End of custom search -->

      <ul>
<li><a class="nav-icon home" href="../">Home</a></li>
      <li><a class="nav-icon about" href="../stories/about-me.html">About</a></li>
      <li><a class="nav-icon resume" href="../">Resume</a></li>
      <li><a class="nav-icon archives" href="../archive.html">Archives</a></li>
      <li><a class="nav-icon tags" href="../categories/index.html">Tags</a></li>
      <li><a class="nav-icon rss" href="../rss.xml">RSS</a></li>

      </ul>
<!--/ul--></nav><!--/navigation--><!--/container--><footer class="container"><div class="columns one">
    <h2>About</h2>
    <p>Not much yet!</p>
  </div>
  <div class="columns one">
    <h2>Social</h2>
    <p class="center">
      <a class="social github" href="http://github.com/shahinism"></a>
      <a class="social twitter" href="http://twitter.com/shahinism"></a>
      <a class="social lastfm" href="http://last.fm/shahinism"></a>
      <a class="social reddit" href="http://reddit.com/user/shahinism"></a>
    </p>
<!-- center -->
  </div>
  <div class="columns one">
    <h2>Projects</h2>
  </div>
<!-- column one -->
  <div class="columns one">
    <h2>Links</h2>
  </div>
  <div class="columns four copyright">
    <p> Contents © 2015         <a href="mailto:me@5hah.in">شاهین آزاد</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>          </p>
    <p>Designed by <a href="http://5hah.in">Shahin Azad</a>. All rights reserved.</p>
  </div>
</footer><!--/container-->
</body>
</html>
