<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" dir="rtl" lang="fa">
<head>
<meta charset="utf-8">
<meta name="wot-verification" content="1e0ce5594a67af53269c">
<meta name="keywords" content="برنامه‌نویسی‌، لینوکس، پایتون‌، اندروید‌، روبی‌، جاوا‌، دیتابیس‌، Programming, Python, Linux, Android, Java, Ruby, Rails, Arch, Database">
<meta name="author" content="شاهین آزاد">
<meta name="description" content="چهاردیواری شخصی یک برنامه‌نویس که در آن یاد می‌گیرد‌، به اشتراک می‌گذارد و گاها غرغر می‌کند!">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>وبلاگ شاهین (صفحهٔ ارسال‌های قدیمی 40) | وبلاگ شاهین</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://5hah.in/index-40.html">
<link rel="prev" href="index-41.html" type="text/html">
<link rel="next" href="index-39.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><script type="application/ld+json">
      {
        "@context" : "http://schema.org",
        "@type" : "Organization",
        "name" : "وبلاگ شاهین",
        "url" : "https://5hah.in",
        "sameAs" : [
        "https://twitter.com/shahinism",
        "https://plus.google.com/117086743723717964659",
        "https://www.facebook.com/shahinism",
        "https://www.linkedin.com/in/shahinism"
        ]
      }
    </script>
</head>
<body>
  <a href="#content" class="sr-only sr-only-focusable">متن اصلی را نادیده بگیر</a>

  <div class="navigator">
    
  </div>

  <nav class="navbar navbar-default"><div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="."><img src="assets/images/logo.png"></a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
<li>
<a href="stories/about-me">درباره</a>
                </li>
<li>
<a href="docs/resume.pdf">رزومه</a>
                </li>
<li>
<a href="archive.html">آرشیو</a>
                </li>
<li>
<a href="categories/">دسته‌ها</a>
                </li>
<li>
<a href="rss.xml">خوراک</a>

                    
        </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://5hah.in/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="جستجو" class="form-control" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


      </div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container-fluid -->
  </nav><section class="container"><div id="headerbox" class="col-md-6 col-centered">
      <div class="terminal">
        <span class="prompt"> <span class="cursor"></span></span>
      </div>
    </div>
  </section><div class="container" id="content" role="main">
    <!--Body content-->
    <div class="col-md-7 col-centered">
      <div class="row">
        
  <div class="postindex">
      <article class="h-entry post-text"><div class="publish-date">
          <i class="glyphicon glyphicon-calendar"></i>
          <time class="published dt-published" datetime="2012-10-17T01:10:24+03:30" title="2012-10-17 01:10">2012-10-17 01:10</time>
</div>

        <h1 class="p-name entry-title"><a href="posts/wp/syr-swdy-w-rwshhy-mkhtlfy-khh-bry-dn/" class="u-url">سیر صعودی $ و روش‌های مختلفی که برای دانلود در لینوکس یاد گرفتم!</a></h1>

          <div class="p-summary entry-summary">
            <div>
<p>این شد که تصمیم گرفتم که راهی غیر از وب سرور برای انتقال فایل از سرور (که می‌توان دقیقا یک کامپیوتر با یک اتصال اینترنت به درد بخور فرضش کرد) به کامپیوتر خودمان پیدا کنم‌. در این مسیر همراهم باشید و عمرا قصه نخورید که چرا در سیستم عامل استکباریتان‌، خواب چنین وسایلی را به راحتی نمی‌بینیند:</p>
<p></p>
<h5>Konqueror:</h5>
<p>خوب اولین ابزار دم دستمان مرورگر پیش‌فرض KDE است‌. برای دیدن فایل‌های روی وب‌سرور تنها کافیست در آدرس‌بار چنین چیزی بنویسیم:</p>
<pre class="code literal-block"><span></span>fish://USER@IPSERVER
</pre>


<p>خودش پس از شروع به جستجو پسوورد می‌پرسد که همان پسوورد ssh (پسوورد یوزر) خواهد بود‌. و دیگر می‌توانید با فایل‌ها جوری رفتار کنید که انگار روی کامپیوتر خودتان قرار دارند‌. ولی خوب بدیهی است که با سرعت اینترنت بالای ما‌، خیلی دردناک است‌. برای فایل‌های کوچک حداکثر تا دو سه مگابایتی می‌توان با یک کپی پیست ساده سر و ته قضیه را هم آورد‌. ولی اگر فایل دو گیگ باشد‌، باید دنبال چارهٔ بهتر گشت‌.</p>
<h5>scp</h5>

<p>یا همان Safe CoPy‌، که به این صورت مورد استعمال قرار می‌گیرد:</p>
<pre class="code literal-block"><span></span>scp USER@IPSERVER:PATH_TO_FILE _Path_to_download_
</pre>


<p>بعد از اجرا یک پرامپتی می‌آید و پسوورد می‌پرسد (عین ssh خودمان) و عملیات کپی انجام می‌شود‌. بدبختی‌اش این‌جاست که چون ما خیلی به سرعت انتقالمان اطمینان داریم‌، یک بار زبانم لال، فایلمان ناقص دانلود شود‌ (لنگر است دیگر‌، می‌افتد‌)، دیگر نمی‌توان Resume‌اش کرد و باید دوباره از اول شروع کنید‌.</p>
<p>scp خوب است‌، ولی باز هم زیاد به درد موقعیت ما نمی‌خورد‌. می‌رویم گزینهٔ بعدی.</p>
<h5>Filezilla</h5>

<p>این فایلزیلای پدر سوخته را احتمالا از روی استفاده‌هایش برای FTP می‌شناسید‌. خوب خوشبختانه این‌ها از پروتکلی به اسم SFTP هم پشتیبانی می‌کنند که منظورش این است که SSH می‌تواند برای وصل شدن به سرور مقصد قرار گیرد‌. پس کافیست از منوی فایل روی Site manager کلیک کنید و صفحهٔ باز شده را مثل عکس زیر کانفیگ کنید:</p>
<p style="text-align: center;"><a href="http://dl.dropbox.com/u/25017694/Blog-photos/filezilla.png"><img class="aligncenter" title="Filezilla site manager" src="http://dl.dropbox.com/u/25017694/Blog-photos/filezilla.png" alt="Filezilla site manager" width="419" height="331"></a></p>

<p>و بعد هم روی connect بزنید و تمام‌. خیلی راحت وصل می‌شوید و می‌توانید با Drog &amp; Drop فایل را انتقال دهید به سیستم‌تان‌. آسان بود‌. ولی خوب ما فقیر فقرا که ساعت ۲ تا ۷ صبح سرعت اینترنت‌مان سر به فلک می‌کشد‌، با تک نخی بودن مدل دانلود‌مان احتمالا طی پنج ساعت نمی‌توانیم ۲ درصد یک فایل دو گیگی را دانلود کنیم‌. می‌توانیم؟</p>
<p>پس فایلزیلا هم با تمام خوبی‌هایش بهتر است برود جلو بوق بزند‌. ما باید برای مساله‌مان دنبال یک راه حل بهتر باشیم‌.</p>
<h5>rsync</h5>

<p>یاد‌تان می‌آید گفتیم که scp سرعت خوبی داشت ولی Resume نمی‌کرد‌. یک ابزار دیگر هم داریم که جینگولک بازی‌هایش در زمان Resume فوق‌العاده است و زبان زد خاص و عام‌. مثل این نقل قول:</p>
<blockquote>ای کسانی که ویندوز آورده‌اید‌، اگر راست می‌گویید rsync بیاورید «<del>منبع نامعلوم</del><a href="http://shahinism.com/blog/1391/07/26/%d8%b3%db%8c%d8%b1-%d8%b5%d8%b9%d9%88%d8%af%db%8c-%d9%88-%d8%b1%d9%88%d8%b4%e2%80%8c%d9%87%d8%a7%db%8c-%d9%85%d8%ae%d8%aa%d9%84%d9%81%db%8c-%da%a9%d9%87-%d8%a8%d8%b1%d8%a7%db%8c-%d8%af%d8%a7%d9%86/#comment-537"> منبع خودش اومد اعتراف کرد ;-)</a>»</blockquote>

<p>این می‌شود که از آن به صورت زیر استفاده می‌کنیم:</p>
<pre class="code literal-block"><span></span>rsync -az --progress --rsh<span class="o">=</span><span class="s1">'ssh'</span> --partial USER@IPSERVER:PATH_TO_FILE _Path_to_download
</pre>


<p>خیلی هم خوب‌. یکی از ویژگی‌هایش این است که می‌توانید آدرس یک پوشه را برای دانلود بهش بخورانید و دیگر دست به دستور نزنید و فقط هر وقت خواستید رانش کنید‌. خودش آخرین فایل‌های آن پوشه را می‌گیرد‌. اما امان از سرعت‌. این جینگولک بازی‌های rsync روی قابلیت‌های فوق‌العاده resume‌اش هزینه دارد و آن هم سرعت است‌! که ما به آن هم خیلی نیاز داریم‌. برای این کار بسته به موقعیت می‌توانیم آن آرگومان z را حذف کنیم‌. ولی حقیقتش برای ما فرق چندانی نداشت‌.</p>
<p>این است که rsync هم می‌گذاریم برای وقتی که لازمش داریم و می‌رویم دنبال یک راه حل بهتر که هم Resume کند‌، هم چند نخه دانلود کند‌، و از آن مهم‌تر این که هی مجبورمان نکند پسوورد بزنیم! آخر چه کسی حالش را دارد ساعت ۲ صبح پسوورد یادش بیاورد؟</p>
<h5>lftp</h5>

<p>فوق‌العاده‌ است‌. فوق‌العاده‌. و این‌طوری استفاده می‌شود:</p>
<pre class="code literal-block"><span></span>lftp -c <span class="s2">"mirror -c --use-pget-n=10 --verbose sftp://USER:PASSWORD@IPSERVER/PATH_TO_FILE"</span>
</pre>


<p>هوم‌، یک کمی طولانی شد‌. ولی بگذارید کمی در موردش صحبت کنیم‌. چون واقعا لازم به توضیح است:</p>
<ul>
<li>‎-c اول یعنی این که دستور روبرو را اجرا کن‌.</li>
    <li>mirror یک برنامه توکار برای lftp است‌. یکی دیگر مثلا pget است‌. هر کدام به درد جایی می‌خورد و این mirror الان به درد ما‌. (از pget هم می‌توان استفاده کرد ولی این یکی بیشتر به مزاقم نشست).</li>
    <li>‎-c این آرگومان مال mirror است و یعنی Resume کن اگر می‌توانی D:</li>
    <li>‎--user-pget-n=10 یعنی فایل را ده قسمت کن و همه را با هم بگیر‌. این همان قابلیت چند نخی است که باعث افزایش سرعت می‌شود و دانلود منیجر‌های مدرن با آن پز می‌دهند ;-)</li>
    <li>USER:PASSWORD یعنی این‌ور یوزر را می‌نویسیم و آن‌ورش رمز عبورش را!</li>
    <li>PATH_TO_FILE این‌بار کمی با باقی مواقع فرق دارد‌. قبلا آدرس را از پوشهٔ خانگی یوزری که وارد شده بود وارد می‌کردیم و موضوع حل بود‌. ولی اینجا آدرس را از ریشه (/) می‌نویسیم‌. یعنی اگر در پوشهٔ خانگی‌تان است می‌شود این:</li>
</ul>
<pre class="code literal-block"><span></span>/home/USER/File
</pre>


<p>lftp هم مانند rsync (شاید هم scp) زورش را دارد که پوشه‌ای که به آن خورانده‌ایم را دانلود کند‌.</p>
<p>همین دیگر‌. دیدید؟ باز هم بگویید بد است‌. لامصب را می‌بینید که چقدر به فکر جیب آدم است؟ با هر پولی و با هر سازی که دلتان خواست برایش بنوازید‌، برای‌تان آن‌قدر خوب رقص می‌کند که انگشت به دهن می‌بانید ;-)</p>
</div>
            </div>

            <div class="left">
                            <a class="btn btn-success" href="posts/wp/syr-swdy-w-rwshhy-mkhtlfy-khh-bry-dn/#disqus_thread" data-disqus-identifier="cache/posts/wp/syr-swdy-w-rwshhy-mkhtlfy-khh-bry-dn.html">Comments</a>


            </div>
            <div class="clear"></div>

      </article><article class="h-entry post-text"><div class="publish-date">
          <i class="glyphicon glyphicon-calendar"></i>
          <time class="published dt-published" datetime="2012-10-13T21:43:04+03:30" title="2012-10-13 21:43">2012-10-13 21:43</time>
</div>

        <h1 class="p-name entry-title"><a href="posts/wp/dunst-tl-rsn-khwchkh-bry-mdyrpnjrhh/" class="u-url">Dunst اطلاع رسان کوچک برای مدیر‌پنجره‌های سبک مثل i3 یا DWM</a></h1>

          <div class="p-summary entry-summary">
            <div>
<p><a href="http://dl.dropbox.com/u/25017694/Blog-photos/xfce4-notifyd-example.png"><img class="aligncenter" title="نمونه xfce4-notifyd" src="http://dl.dropbox.com/u/25017694/Blog-photos/xfce4-notifyd-example.png" alt="نمونه xfce4-notifyd" width="392" height="159"></a>جدای از این هم به دلیل قابل کنترل نبودن با کیبورد‌، زیاد به مزاقم خوش نمی‌آمد‌. این شد که امروز چرخی زدم و با <a title="Dunst home page" href="http://knopwob.github.com/dunst/" target="_blank">Dunst</a> آشنا شدم‌ که خودش را این‌طوری معرفی می‌کند:</p>
<p></p>
<blockquote>
<p style="text-align: left;">dunst - dmenu-ish notification daemon</p>

</blockquote>

<p>و خوب از آن‌جایی که Dmenu بخش حیاتی زندگی‌مان در i3 شده‌، احتمالا Dunst هم می‌تواند انتخاب خوبی باشد‌. خصوصا با همچین اسکرین‌شاتی که معلوم می‌شود ظاهری بسیار شبیه به Dmenu دارد‌:</p>
<p><a href="http://www.knopwob.org/public/dunst_wide_640.png"><img class="aligncenter" title="نمونه dunst" src="http://www.knopwob.org/public/dunst_wide_640.png" alt="نمونه dunst" width="384" height="288"></a>برای نصبش کار سختی پیش رو ندارید‌. جز این که اول notification daemon‌ای که قبلا استفاده می‌کردید (روی اسلکور xfce4-notify) را پاک کنید و حالا بسته به توزیع‌تان با مخازن‌تان بگیرید و یا با دو دستور (که در صفحهٔ اصلی پروژه نوشته شده) نصبش کنید‌.</p>
<p>بعد از نصب هم با دستور زیر:</p>
<pre class="code literal-block"><span></span>cp /usr/share/dunst/dunstrc ~/.config
</pre>


<p>یک نمونه از فایل تنظیمات را در پوشهٔ خانگی‌تان کپی کنید‌. از من می‌شنوید چرخی در این فایل بزنید چون تنظیمات خیلی به درد بخوری در آن پیدا می‌کنید‌ (ضمن این که ظاهر اولیه اصلا شباهتی به Dmenu ندارد ;-))</p>
<p>اما بیشترین نقاط قوت این اطلاع رسان ساده در میانبر‌های کیبوردش مخفی شده به طوری که:</p>
<ul>
<li>می‌توانید با Ctrl+Space اخطاری را که روی صفحه ظاهر شده قبل از به پایان رسیدن تایمش ببندید‌.</li>
    <li>می‌توانید با Ctrl+grave آخرین اخطاری که ظاهر شد و شما ندید را به روی صفحه برگردانید (که به نظرم خیلی به درد بخور است). grave همان دکمه‌ای است که باهاش ~ تایپ می‌کنید‌. کنار ۱ و بالای TAB ;-)</li>
    <li>یا اگر زیر بار حملهٔ Notificationها در حال له شدنید با Ctrl+Shift+Space با یک تیر همه را قتل عامل کنید ;-)</li>
</ul>
<p><strong>نکته ۱:</strong> برای ایجاد یک Notification می‌توانید از دستور زیر استفاده کنید:</p>
<pre class="code literal-block"><span></span>notify-send Test
</pre>


<p>که جای Test هر چیزی که خواستید می‌توانید به عنوان پیغام اضافه کنید‌.</p>
<p><strong>نکته ۲:</strong> Dunst تنها قبل از اجرای daemon‌ش فایل کانفیگی که در ‎.config ذخیره کردیم را می‌خواند‌. برای دیدن تغییرات باید اول این daemon را kill کنید و دوباره اجرایش کنید ;-)</p>
</div>
            </div>

            <div class="left">
                            <a class="btn btn-success" href="posts/wp/dunst-tl-rsn-khwchkh-bry-mdyrpnjrhh/#disqus_thread" data-disqus-identifier="cache/posts/wp/dunst-tl-rsn-khwchkh-bry-mdyrpnjrhh.html">Comments</a>


            </div>
            <div class="clear"></div>

      </article><article class="h-entry post-text"><div class="publish-date">
          <i class="glyphicon glyphicon-calendar"></i>
          <time class="published dt-published" datetime="2012-10-01T11:48:18+03:30" title="2012-10-01 11:48">2012-10-01 11:48</time>
</div>

        <h1 class="p-name entry-title"><a href="posts/wp/nskhh-jdyd-wyryshgr-mtn-ngr/" class="u-url">نسخهٔ جدید ویرایشگر متن نگار</a></h1>

          <div class="p-summary entry-summary">
            <div>
<p><a href="https://raw.github.com/shahinism/Negar/master/Screenshot/window1.png"><img title="نمونهٔ خروجی برنامهٔ نگار (در رابط گرافیکی)" src="https://raw.github.com/shahinism/Negar/master/Screenshot/window1.png" alt="" width="443" height="359"></a> برای بزرگ شدن تصویر روی آن کلیک کنید.</p>
<p>قابلیت‌هایی که نسبت به نسخهٔ قبلی به آن اضافه شده عبارتند از:</p>
<p></p>
<ul>
<li>قابلیت جدا کردن کلمات نوشته شده به صورت «‌میشود‌».</li>
    <li>اضافه کردن نیم فاصله بعد از پرانتز (یا علامت‌هایی نظیر آن) که باعث می‌شود کلمه جدا از آن کاراکتر دیده شود که مزیت‌های خودش را دارد‌.</li>
    <li>رابط گرافیکی نوشته شده بر مبنای PyQt4.</li>
    <li>پردازش بهتر آرگومان‌های خط فرمان.</li>
    <li>قابلیت تنظیم آپشن‌ها از طریق خط فرمان.</li>
</ul>
<p>فعلا چیز دیگری یادم نمی‌آید‌. برای نصب هم اول مطمئن شوید که PyQt4 و setuptools را با توجه به توزیع‌تان نصب کرده‌اید‌، سپس با استفاده از سه دستور زیر‌، کار را تمام کنید:</p>
<pre class="code literal-block"><span></span>$ git clone https://github.com/shahinism/Negar.git

$ <span class="nb">cd</span> Negar

$ sudo python setup.py install
</pre>


<p>یک نکته هم در مورد قابلیت جدا کردن کلمات و نحوهٔ کارش اضافه کنم‌. خوب اگر ما همانطور که فاصله‌ها را کنترل می‌کنیم‌، (یعنی با regular expression) می‌خواستیم این کلمات مانند «میشود‌، کمکتان» و… را جدا می‌کردیم‌، در مورد کلماتی مانند «میلاد» به مشکل بر می‌خوردیم‌. برای کنترل چنین وضعیتی از فایلی به اصم untouchable.dat که شامل کلماتی از این دست می‌شود (فایل را از روی یک دیکشنری در پروژهٔ ویراستیار و با کمک چند اسکریپت سریع تولید کرده‌ام و هنوز جای کار بسیاری دارد) استفاده کرده‌ام‌. کاربر می‌تواند کلماتی از این دست که نگار در موردشان درست اقدام نمی‌کند را با استفاده از رابط گرافیکی و یا کنسول به این لیست اضافه کند‌.</p>
<p><strong>پی‌نوشت ۱:</strong> در<a title="پروژهٔ نگار و مصائبش" href="http://shahinism.com/blog/1391/05/21/%d9%be%d8%b1%d9%88%da%98%d9%87%d9%94-%d9%86%da%af%d8%a7%d8%b1-%d9%88-%d9%85%d8%b5%d8%a7%d8%a6%d8%a8%d8%b4/" target="_blank"> معرفی قبلی‌</a>، اشتباهی در مورد اسکرین‌شات کردم و بررسی نکرده منتشرش کردم که متاسفانه‌، باعث سوء تفاهم‌هایی شد که از همین تریبون عذر خواهی می‌کنم ;-)</p>
<p><strong>پی‌نوشت ۲:</strong> دوست عزیزی به اسم رامین‌، پروژه را فورک و چند ویرایش خوب روی سورس انجام داد که از آن‌هایی که می‌توانستم (با توجه به این که سورس را دوباره از نو نوشتم) استفاده کردم‌. اما متاسفانه احساس می‌کنم ایشان از رفتارم سوء برداشت کرده‌اند‌. به هر حال از ایشان عذر خواهی می‌کنم و امید‌وارم مرا ببخشند‌.</p>
<p><strong>پی‌نوشت ۳:</strong> همین دوست عزیز یک نسخهٔ گرافیکی دیگر بر مبنای سورس (که بعضی امکانات این نسخه را ندارد) قبلی نگار توسعه داده که قابلیت غلط گیر املایی هم به آن افزوده شده‌. جالب است‌، <a title="gui negar" href="http://raminnietzsche.github.com/GuiNegar/" target="_blank">تستش کنید</a> ;-)</p>
</div>
            </div>

            <div class="left">
                            <a class="btn btn-success" href="posts/wp/nskhh-jdyd-wyryshgr-mtn-ngr/#disqus_thread" data-disqus-identifier="cache/posts/wp/nskhh-jdyd-wyryshgr-mtn-ngr.html">Comments</a>


            </div>
            <div class="clear"></div>

      </article><article class="h-entry post-text"><div class="publish-date">
          <i class="glyphicon glyphicon-calendar"></i>
          <time class="published dt-published" datetime="2012-09-26T15:52:57+03:30" title="2012-09-26 15:52">2012-09-26 15:52</time>
</div>

        <h1 class="p-name entry-title"><a href="posts/wp/rhnmy-khwth-khr-b-dbus-dr-pytwn-nwshtn-r/" class="u-url">راهنمای کوتاه کار با DBus در پایتون (نوشتن روبات پاسخگو برای Pidgin)</a></h1>

          <div class="p-summary entry-summary">
            <div>
<p>بعد از کمی جستجو‌، با <a title="dbus official webpage" href="http://dbus.freedesktop.org/" target="_blank">DBus</a> آشنا شدم و البته یادم آمد که خیلی وقت پیش‌،<a title="jadi dbus" href="http://jadi.net/2011/07/linux-chera-command-line/" target="_blank"> جادی عزیز‌</a>، کاری تقریبا در همین مایه‌ها با DBus و Pidgin انجام داده بود‌. توضیحات تکمیلی در مورد DBus را می‌توانید در وبلاگ جادی بخوانید‌، خصوصا این که اسکریپت نوشته شده توسط جادی در آن پست‌، پیش در آمد خوبی برای این کار است‌، و حقیقتش تنها منبع به درد بخورم در این زمینه بود‌! (منظورم در زمینهٔ عملی کار با DBus است‌، در زمینهٔ تئوری و به عنوان یک راهنما می‌توان به <a title="dbus-python turorila" href="http://dbus.freedesktop.org/doc/dbus-python/doc/tutorial.html" target="_blank">راهنمای</a> Freedesktop بسنده کرد‌.)</p>
<p>مساله این‌جاست که می‌خواهیم اسکریپتی بنویسیم که پس از اجرا‌، منتظر Pidgin بماند‌. اگر Pidgin پیغامی دریافت کرد‌، اسکریپت به صورت خود‌کار و بلافاصله‌، جوابی را که از قبل بهش خورانده‌ایم رو به مخاطب آن‌ور خط بدهد‌.</p>
<p>با این وصف‌، اسکریپت‌مان دو مرحله خواهد داشت‌.</p>
<p>اول‌، منتظر ماندن برای یک علامت که از طرف Pidgin‌، پس از دریافت پیام ارسال می‌شود‌.</p>
<p>دوم‌، ارسال جواب برای مخاطبی که پیغام را ارسال کرده‌.</p>
<p>برای انجام این کار اول از همه‌، ابزار‌های مورد نیازمان را وارد می‌کنیم‌:</p>
<p>[python]</p>
<p>import sys</p>
<p>import dbus</p>
<p>from PyQt4.QtGui import QApplication</p>
<p>from dbus.mainloop.qt import DBusQtMainLoop</p>
<p>[/python]</p>
<p>قرار بر این بود که اسکریپت پس از اجرا منتظر بماند‌، درست؟ خوب همان‌طور که می‌دانید برنامه‌ها منطقا جوری نوشته می‌شوند که یک کاری را شروع کنند‌، انجام دهند‌، و پایان یابند‌. این روند زیاد برای کار ما مناسب نیست‌. از طرفی استفاده از حلقه‌های بی‌نهایت مرسوم‌‌، جز پیچیده کردن کار‌، نتیجه‌ای به همراه ندارد‌. این است که برای سازگاری بیشتر اسکریپت با برنامه‌های Qt (در ادامه دلیلش را می‌گویم) از QApplication و DBusQtMainLoop برای مدیریت حلقهٔ اصلی استفاده می‌کنیم‌. در ادامه اضافه می‌کنیم:</p>
<p>[python]</p>
<p>bus_loop = DBusQtMainLoop(set_as_default=True)</p>
<p>[/python]</p>
<p>کار با حلقهٔ اصلی هنوز تمام نشده‌، باقی کار را آخر انجام می‌دهیم‌. و اما حالا نوبت به انجام مرحلهٔ اول کارمان می‌رسد. تابع گیرندهٔ سیگنال (همان علامتی که Pidgin پس از دریافت پیغام ارسال می‌کند) را می‌نویسیم‌.</p>
<p>[python]</p>
<p>def connect_dbus(text):</p>
<p>global answer</p>
<p>answer = text</p>
<p>bus = dbus.SessionBus()</p>
<p>bus.add_signal_receiver(pidgin_control_func,</p>
<p>dbus_interface="im.pidgin.purple.PurpleInterface",</p>
<p>signal_name="ReceivedImMsg")</p>
<p>[/python]</p>
<p>اولین سوال در این تابع‌، این است که به کدام DBus وصل شویم؟ به طور معمول دو DBus داریم‌، SystemBus که به صورت سراسری (System wide) است‌‌. و دومی SessionBus که محدود به یوزر اجرا کنندهٔ برنامه می‌شود‌. برای کار ما‌، دومی‌، انتخاب معقول‌تری است‌. پس از اتصال‌، نوبت به نصب یک پیغام‌گیر می‌شود‌. تابع مورد استفاده به صورت bus.add_signal_receiver است که سه آرگومان می‌گیرد‌. که هر کدام به سوالی پاسخ می‌دهند‌:</p>
<p>۱- پس از دریافت سیگنال کدام تابع را صدا کنم؟ پاسخ: pidgin_control_func (تابعی که در مرحلهٔ دوم خواهیم ساخت)</p>
<p>۲- روی DBus به حرف کدام برنامه گوش کنم؟ پاسخ: Pidign که خوب ما از آدرس DBusاش برای معرفی استفاده می‌کنیم‌.</p>
<p>۳- منتظر چه نوع علامتی باشم؟ پاسخ: ReceivedImMsg که با کمی جستجو در مستندات Pidgin به عنوان علامت دریافت پیغام توسط Pidgin شناسایی کردیم ;-)</p>
<p>در این تابع ما از فراخوان می‌خواهیم که آرگومانی را به عنوان text برایمان ارسال کند و آن را به متغیر سراسری answer نسبت می‌دهیم‌. دلیل این کار ساده است‌. چون می‌خواهیم کلا در برنامهٔ اصلی فقط همین تابع را صدا کنیم و خودش باقی کار‌ها را انجام دهد.</p>
<p>نوبت به نوشتن تابع دوم می‌رسد‌:</p>
<p>[python]</p>
<p>def pidgin_control_func(account, sender, message, conversation, flags):</p>
<p>bus = dbus.SessionBus()</p>
<p>obj = bus.get_object("im.pidgin.purple.PurpleService", "/im/pidgin/purple/PurpleObject")</p>
<p>purple = dbus.Interface(obj, "im.pidgin.purple.PurpleInterface")</p>
<p>if purple.PurpleAccountGetUsername(account) != sender:</p>
<p>purple.PurpleConvImSend(purple.PurpleConvIm(conversation), answer)</p>
<p>[/python]</p>
<p>خوب اول از همه این که ما در نوشتن این تابع ۶ آرگومان می‌گیریم‌. و البته این شش آرگومان چیز‌هایی هستند که همان سیگنال ReceivedImMsg برای‌مان می‌فرستد‌. که البته اطلاعات خیلی به درد بخوری‌اند‌. طبق روال قبلی به SessionBus وصل می‌شویم (این کار را می‌شد یک بار انجام داد‌، ولی موقع استفاده به صورت ماژول کمی جفتک می‌انداخت). در ادامه به سه سوال دیگر جواب می‌دهیم:</p>
<p>۱- روی DBus به کدام برنامه گوش کنم؟ پاسخ im.pigin.purple.PurpleService</p>
<p>۲- آدرسش کجاست؟ پاسخ: ‎/im/pidgin/purple/PurpleObject</p>
<p>در واقع با پاسخ به این دو سوال‌، سعی به ساخت یک شیع ارتباطی با برنامهٔ مورد نظر داریم‌. حال با این شیع می‌توانیم یک رابط برای مکاتبهٔ تابع‌مان با Pidgin بسازیم‌.</p>
<p>۳- کدام رابط از آبجکت ساخته شده؟ پاسخ: im.pidgin.purple.PurpleInterface</p>
<p>و خوب حالا تنها برای ارسال پیام کافی است تابع PurpleConvImSend را از شیع ساخته شده صدا کنیم‌ و به دو سوال پاسخ دهیم:</p>
<p>۱- به چه کسی پیغام بفرستم؟ پاسخ: کسی که برای‌مان پیغام فرستاده‌. برای به دست آوردنش کافی است که از تابع PurpleConvIm از شیع‌مان بخواهم که آدرسش را پیدا کند ;-)</p>
<p>۲- چه بگویم؟ پاسخ answer‌‌، همان متغیر سراسری که که در تابع اول‌، مقدار دهی‌اش کردیم‌.</p>
<p>البته من در تابع یک قفل کودک هم گذاشته‌ام‌. چطور؟ ماجرا این‌جاست که با نوشتن هم‌چین تابعی‌، وقتی وسوسه می‌شوید که خود‌تان امتحانش کنید‌، به یک لوپ بی‌نهایت تبدیلش می‌کنید! کافیسیت برای دیدن این لوپ شرط if موجود در تابع را پاک کرده و تابع را امتحان کنید‌. یک بار به خود‌تان پیغام بدهید‌، Pidgin علامت می‌دهد‌، روبات پاسخ می‌دهد و دوباره پس از دریافت پیغام روبات روی Pidgin‌، این برنامه دوباره سیگنال ارسال می‌کند و این کار اگر ولش کنید تا عبد ادامه خواهد داشت ;-)</p>
<p>دیگر وقت اجرای تابع اصلی رسیده‌، و کافیست که:</p>
<p>[python]</p>
<p>app = QApplication([])</p>
<p>connect_dbus(message)</p>
<p>app.exec_()</p>
<p>[/python]</p>
<p>برنامه الان به راحتی اجرا می‌شود و کاری را هم که می‌خواهیم دقیقا انجام می‌دهد(البته طبیعی است که چیز‌های ساده‌ای باید به آن اضافه کنید‌.)‌. ولی هنوز یک مشکل دارد‌، آن هم این که نمی‌توان آن را بست‌! حتی Ctrl+c هم در ترمینال آن را نمی‌کشد‌. این است که از دو خط زیر و دقیقا قبل از ساختن شیع app کمک می‌گیریم:</p>
<p>[python]</p>
<p>import signal</p>
<p>signal.signal(signal.SIGINT, signal.SIG_DFL)</p>
<p>[/python]</p>
<p>کار این تابع این است که وقتی SIGINT یا همان Ctrl+c ما را گرفت (توجه کنید که این کلید در رابط گرافیکی Qt برای کپی متن استفاده می‌شود) آن را به SIG_DFL ترجمه کند‌! یعنی بزند بترکاند برنامه‌مان را ;-)</p>
<p>می‌توانید نسخهٔ کامل اسکریپت را از<a title="Download answering machine" href="https://github.com/shahinism/PyPomo/raw/master/src/answering_machine.py" target="_blank"> این لینک </a>دانلود کنید و به صورت زیر اجرایش کنید:</p>
<pre class="code literal-block"><span></span>python answering_machine.py ANSWER_MESSAGE
</pre>


<p>اما خوب درست است که این اسکریپت تقریبا مشکل‌مان را حل می‌کند‌، اما هنوز یک جای کارش می‌لنگد‌! باز هم من کم حواس باید یادم باشد که اجرایش کنم‌! و از آن بد‌تر در وقت آزادم خاموشش کنم‌! و این اصلا حال نمی‌دهد‌. این است که آن را با <a title="PyPomo Official webpage" href="http://shahinism.github.com/PyPomo/" target="_blank">PyPomo</a> قاطی می‌کنم‌ (آخرین نسخهٔ روی گیت). جوری که وقتی در حال انجام یک پامودور هستم‌، این اسکریپت را روشن کند‌، و وقتی که موقع استراحت است یا interrupt داده‌ام‌، آن را خاموش کند‌. حالا دیگر تقریبا همه چیز حل شده است ;-)</p>
<p><strong>پی‌نوشت۱: </strong>متاسفانه هر کاری کردم نتوانستم این دندانه گذاری کد‌ها را درست کنم‌. مشکل از پلاگین وردپرس‌ام است‌، یا همچین چیزی‌، باید به فکر جایگزینی برایش باشم‌!</p>
<p><strong>پی‌نوشت۲:</strong> می‌دانم برنامه به بهترین شکل ممکن نوشته نشده‌، زیاده کاری دارد و حتی در ترکیبش با PyPomo باگ‌هایی هست که به چشمم نیامده‌، ولی خوب حداقل تلاشم را کرده‌ام دیگر‌. اگر برنامه نظرتان را جلب کرده‌، و راه بهتری بلدید‌، روی گیت فورکش کنید و تغییرات‌تان را اعمال کنید‌. مطمئنم چیز‌های بهتری می‌توان ازش ساخت‌!</p>
</div>
            </div>

            <div class="left">
                            <a class="btn btn-success" href="posts/wp/rhnmy-khwth-khr-b-dbus-dr-pytwn-nwshtn-r/#disqus_thread" data-disqus-identifier="cache/posts/wp/rhnmy-khwth-khr-b-dbus-dr-pytwn-nwshtn-r.html">Comments</a>


            </div>
            <div class="clear"></div>

      </article><article class="h-entry post-text"><div class="publish-date">
          <i class="glyphicon glyphicon-calendar"></i>
          <time class="published dt-published" datetime="2012-09-20T11:41:42+04:30" title="2012-09-20 11:41">2012-09-20 11:41</time>
</div>

        <h1 class="p-name entry-title"><a href="posts/wp/skhrypty-bry-khhsh-hzynh-shrkht-dr-khls/" class="u-url">اسکریپتی برای کاهش هزینهٔ شرکت در کلاس‌های دانشگاه Coursera</a></h1>

          <div class="p-summary entry-summary">
            <div>
<p>زیاده‌گویی بس است‌. خیلی وقت پیش هم در کلاس‌های این سایت شرکت کرده بودم‌، ولی ادامه ندادم‌. چرا؟ حقیقتش مجموعهٔ دانلودی‌اش عالی است‌. فیلم آموزشی‌، زیرنویسش‌، اسلاید و …. اما خودتان که می‌دانید زندگی سایبری (‌حالم از این کلمهٔ آخر به هم می‌خورد‌، جایگزین بهتری نمی‌شناسید؟) در ایران‌، خصوصا با این کیفیت عالی (!) چه هزینهٔ گزافی دارد‌. این شد که دیروز وقتی دوباره لیست این کلاس‌ها‌، وسوسه به مطالعه‌شان را در من تقویت کرد‌، تصمیم به دانلودشان به صورت شبانه گرفتم‌. اما مشکل این‌جاست که باید شب را تا صبح پای کامپیوتر بگذرانم و تک به تک دانلودشان کنم‌، چرا که‌، پروسهٔ دانلود سایت کمی قرتی تشریف دارد و کوکی می‌خواهد‌. قصد داشتم برای چالش هم که شده یک اسکریپت برای این کار بنویسم‌.</p>
<p>اما خوشبختانه بعد از اولین جستجو به کامل‌ترین نسخهٔ ممکن برای این کار رسیدم‌.<a title="coursera doenloader on github" href="https://github.com/jplehmann/coursera" target="_blank"> اسکریپتی که</a> دیروز کار نمی‌کرد‌، و باعث شده بود تصمیم بگیرم تعمیرش کنم‌، ولی باز توسعه دهندهٔ خوش‌فکرش به کارش انداخت و الان مثل چـــی کار می‌کند ;-)</p>
<p>مزیتش نسبت به تمام روش‌های دانلود دیگر این است که فقط کافیست نام کلاس را بهش بگویید و خودش همه چیز‌های مربوطه را برایتان دانلود کرده‌، نام درست را برای‌شان بگذارد و در پوشه‌های جدا دسته بندی می‌کند‌. (هلو …؟)</p>
<p>اول با توجه به توزیع زیر دستتان‌، بستهٔ setuptools از خانوادهٔ پایتون را نصب کنید‌، و باقی کار را مثل زیر انجام دهید:</p>
<pre class="code literal-block"><span></span>easy_install BeautifulSoup

easy_install argparse

git clone https://github.com/jplehmann/coursera.git

<span class="nb">cd</span> coursera
</pre>


<p>و حالا با چنین نحوی می‌توانید دانلود را انجام دهید:</p>
<pre class="code literal-block"><span></span>./coursera CLASS_NAME -u USER_NAME -p PASSWORD
</pre>


<p>برای به دست آوردن CLASS_NAME صفحهٔ کلاس مربوطه را در سایت باز کنید‌. مثلا برای Algorithms 1 همچین چیزی است:</p>
<pre class="code literal-block"><span></span>https://class.coursera.org/algs4partI-2012-001/lecture/index
</pre>


<p>آن بند algs4partI-2012-001 می‌شود نام کلاس‌ الگوریتم‌ها‌. جایش در باقی کلاس‌ها یکسان و معلوم است ;-)</p>
<p><strong>پی‌نوشت</strong>: در آیندهٔ نزدیک یک روش گاز‌انبری و خیلی دم دستی را یادتان می‌دهم که می‌تواند این کوکی‌های کذایی را دور بزند. </p>
</div>
            </div>

            <div class="left">
                            <a class="btn btn-success" href="posts/wp/skhrypty-bry-khhsh-hzynh-shrkht-dr-khls/#disqus_thread" data-disqus-identifier="cache/posts/wp/skhrypty-bry-khhsh-hzynh-shrkht-dr-khls.html">Comments</a>


            </div>
            <div class="clear"></div>

      </article>
</div>
              <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-41.html" rel="prev">ارسال‌های جدید‌تر</a>
            </li>
            <li class="next">
                <a href="index-39.html" rel="next">پست‌های قدیمی‌تر</a>
            </li>
        </ul></nav><script>var disqus_shortname="shahinism";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
    </div>
    <!--End of body content-->
  </div>

  <footer id="footer" class="site-footer">
    Contents © 2016         <a href="mailto:me@5hah.in">شاهین</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
    
  </footer><script src="assets/js/all-nocdn.js"></script><script src="assets/js/colorbox-i18n/jquery.colorbox-fa.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("fa");
    fancydates(0, "YYYY-MM-DD HH:mm");
  </script><!-- end fancy dates -->
</body>
</html>
