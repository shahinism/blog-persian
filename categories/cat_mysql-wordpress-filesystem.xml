<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>شاهین (mysql, wordpress, filesystem)</title><link>http://5hah.in/</link><description></description><atom:link rel="self" href="http://5hah.in/categories/cat_mysql-wordpress-filesystem.xml" type="application/rss+xml"></atom:link><language>fa</language><lastBuildDate>Sun, 27 Dec 2015 07:23:47 GMT</lastBuildDate><generator>https://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>وقایع نگاری یک دیباگ: وقتی MySQL چیزی ذخیره نمی‌کند!</title><link>http://5hah.in/posts/no-space-mysql-problem.html</link><dc:creator>شاهین</dc:creator><description>&lt;div&gt;&lt;p&gt;مشکل از آن‌جا شروع شد که &lt;a class="reference external" href="http://navid.kashani.ir/"&gt;نوید&lt;/a&gt; خبر داد که چند ساعتی است یک وبلاگ وردپرسی که برای یکی از &lt;a class="reference external" href="http://foundersbuddy.com"&gt;پروژه‌هاست&lt;/a&gt; ، عکس‌العمل‌های عجیب و غریب نشان می‌دهد! چطور؟ این که باکس متن بعضی از مطالب نشان داده نمی‌شوند. اولین حدسم این بود که شاید بخاطر تغییرات اخیری که در آدرس وبلاگ داده بودم همچین مشکلی پیش آمده و خواستم که تنظیمات را به حالت قبل برگردانند… و مشکل یپچیده‌تر شد! چطور؟ تنظیمات جدید ذخیره نمی‌شد.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="http://navid.kashani.ir/"&gt;نوید&lt;/a&gt;  چند تایی روش پیشنهاد کرد تا شاید بتوانیم اطلاعات بیشتر در رابطه با وضعیت به دست بیاوریم. به سرور لاگین می‌کنم و… tab completion کار نمی‌کند. یک همچین اخطاری می‌دهد:&lt;/p&gt;
&lt;pre class="code bash"&gt;&lt;a name="rest_code_1b014c5fba9c4b62808e79733fee9a3c-1"&gt;&lt;/a&gt;bash: cannot create temp file &lt;span class="k"&gt;for&lt;/span&gt; here-document: No space left on device
&lt;/pre&gt;&lt;p&gt;خوب راست هم می‌گوید انگار… یک &lt;cite&gt;df -h&lt;/cite&gt; معلوم می‌کند که پوشهٔ home کاربر حاضر‌، تا خرخره پر شده. یک فایل log که از &lt;a class="reference external" href="http://5hah.in/posts/multithreading-bug-experiment-on-PyMongo-driver.html"&gt;دیباگ&lt;/a&gt; قبلی باقیمانده، وزنش به ۵ گیگ رسیده و دیگر نمی‌تواند نفس بکشد.&lt;/p&gt;
&lt;pre class="code bash"&gt;&lt;a name="rest_code_7f0f8e12c1a342e5a52b5332b43f5012-1"&gt;&lt;/a&gt;rm -rfv PATH_TO_FAT_FILE
&lt;/pre&gt;&lt;p&gt;و دوباره &lt;cite&gt;df -h&lt;/cite&gt;… و؟ فضا خالی نشده. فایل پاک نشده؟ &lt;cite&gt;ls -lh PATH_TO_FAT_FILE&lt;/cite&gt; می‌گوید که همچین فایلی نداریم. ها از قرار آن پروسهٔ لاگ همچنان فعال است (این‌طوری سیستم فایل فضایش را بعد از پاک کردن فایل مذکور به روز نمی‌کند). پروسه چه بوده حالا؟ Only GOD knows :)&lt;/p&gt;
&lt;pre class="code bash"&gt;&lt;a name="rest_code_08e9a763a685467d953bd4072e00159c-1"&gt;&lt;/a&gt;ps -aux &lt;span class="p"&gt;|&lt;/span&gt; grep PATH_TO_FAT_FILE
&lt;/pre&gt;&lt;p&gt;امیدوار بودم که با شل پایپ کرده باشند که نه انگار… می‌دانم کار کیست ولی او هم به خاطر نمی‌آورد که دستور چه بوده. هوم… لینوکس دیگر اینقدر‌ها هم بی‌شعور نیست. راه حل خودش چیست؟ &lt;cite&gt;lsof&lt;/cite&gt;&lt;/p&gt;
&lt;pre class="code bash"&gt;&lt;a name="rest_code_ea2f9b3e248d4a7283d20fc42c7c05f8-1"&gt;&lt;/a&gt;lsof PATH_TO_FAT_FILE
&lt;/pre&gt;&lt;p&gt;حل شد؟ نه! همچین پروسه‌ای نداریم. یک کم پرزورتر می‌پرسیم:&lt;/p&gt;
&lt;pre class="code bash"&gt;&lt;a name="rest_code_f3465a9a0a164224b89924b615628eb6-1"&gt;&lt;/a&gt;sudo !!
&lt;/pre&gt;&lt;p&gt;ها ها، پیدا شد! یک &lt;cite&gt;kill -9&lt;/cite&gt; مهمانش کردیم و حالا باید مشکل حل شده باش. ولی…&lt;/p&gt;
&lt;pre class="code bash"&gt;&lt;a name="rest_code_8ef792b6dfa34da29aaff20c552655ea-1"&gt;&lt;/a&gt;bash: cannot create temp file &lt;span class="k"&gt;for&lt;/span&gt; here-document: No space left on device
&lt;/pre&gt;&lt;p&gt;هوم… باز هم؟ می‌گوید temp، حالا اگر فرض بگیریم مثل آدم این‌جور فایل‌ها را در ‎/tmp ذخیره می‌کند، ۱.۵ گیگابایت فضای خالی داریم. پس این اخطار برای چیست؟ قضیه آن‌جا عجیب می‌شود که یک عالمه (عدد جدید است. یک کم بیشتر از خیلی زیاد :)) فایل یک کیلوبایتی داخل ‎/tmp ذخیره شده. محتوایش؟ چیز خاصی نیست. ولی چه ربطی می‌تواند به مشکل داشته باشد؟ کمی جستجو  و &lt;cite&gt;df -i&lt;/cite&gt;:&lt;/p&gt;
&lt;pre class="code bash"&gt;&lt;a name="rest_code_5b6c71785b0d419b85d5603e0d1cfab8-1"&gt;&lt;/a&gt;...
&lt;a name="rest_code_5b6c71785b0d419b85d5603e0d1cfab8-2"&gt;&lt;/a&gt;tmpfs                             494K    494K   &lt;span class="m"&gt;0&lt;/span&gt;    100% /tmp
&lt;a name="rest_code_5b6c71785b0d419b85d5603e0d1cfab8-3"&gt;&lt;/a&gt;...
&lt;/pre&gt;&lt;p&gt;که چه؟ inode پر است؟ چی هست اصلا؟ به نقل از &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Inode"&gt;ویکی‌پدیا&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
آی‌نود (به انگلیسی: inode) به ساختمان داده‌هایی گفته می‌شود که در سیستم‌فایل‌های شبیه به یونیکس مانند UFS استفاده می‌شود. یک inode اطلاعات پایه‌ای در مورد فایل‌ها، دایرکتوری‌ها و اشیاء دیگر موجود در فایل‌سیستم را در خود نگهداری می‌کند.&lt;/blockquote&gt;
&lt;p&gt;و خوب طبیعی است. اگر این فضا پر شده که دستور قبل همچین چیزی نشان می‌دهد، امکان ساختن فایل جدید وجود ندارد. یک find خوشگل سر هم می‌کنیم که همهٔ فایل‌های با اسم عجیب غریب یکسانشان را باطل کند. (در پست بعدی جریان این فایل‌ها را شرح می‌دهنم):&lt;/p&gt;
&lt;pre class="code bash"&gt;&lt;a name="rest_code_dbd25e37eceb4fd381625bf0492823c4-1"&gt;&lt;/a&gt;find -regextype posix-egrep -type f -regex &lt;span class="s1"&gt;'.*[^/]{40}'&lt;/span&gt; -delete
&lt;/pre&gt;&lt;p&gt;خیلی ساده یعنی هر فایلی که طول اسمش دقیقا ۴۰ کاراکتر است را پاک کن. و تست دوباره‌، auto completion به کار افتاده. خوب اصلا برای چه لاگین کرده بودیم؟ مشکل دیتابیس MySQL و وردپرس بود. یک بار دیگر صفحه را باز کنیم تا ببینیم دقیقا چه اتفاقی می‌افتد… و… عه؟ مشکل حل شده! بریم ببینیم تنظیمات جدید را ذخیره می‌کند؟ ها‌، آره آن هم حل شده. ضرب‌المثل ربط … به … این‌جا خیلی قشنگ صدق می‌کند :)&lt;/p&gt;
&lt;p&gt;به هر حال چند تا درس گنده یاد گرفتم، همچین باگ‌هایی ارزش یک کلاس درس واقعی را دارند‌، این‌طور نیست؟&lt;/p&gt;&lt;/div&gt;</description><guid>http://5hah.in/posts/no-space-mysql-problem.html</guid><pubDate>Mon, 16 Nov 2015 15:45:57 GMT</pubDate></item></channel></rss>