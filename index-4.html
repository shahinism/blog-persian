<!DOCTYPE html><html lang="fa"><head><meta charset="utf-8"><meta name="description" content="بعضی وقت‌ها باید قبل از این که بتوانید راه بروید‌، بدوید‌!"><meta name="author" content="شاهین آزاد"><title>شاهینیسم (صفحهٔ ارسال‌های قدیمی 4) | شاهینیسم</title><link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="assets/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"><link href="assets/css/rst.css" rel="stylesheet" type="text/css"><link href="assets/css/code.css" rel="stylesheet" type="text/css"><link href="assets/css/colorbox.css" rel="stylesheet" type="text/css"><link href="assets/css/theme.css" rel="stylesheet" type="text/css"><link href="assets/css/custom.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
<![endif]--><link rel="alternate" type="application/rss+xml" title="RSS fa" href="rss.xml"></head><body class="home blog">
    
    <script type="text/javascript">var addthis_config={"ui_language":"${lang}"};</script><div id="siteWrapper">
      <h1 id="vcard author">
        <a href="." title="شاهینیسم">شاهینیسم</a>
      </h1>

      <div id="mainNav">
        <ul><li><a href="stories/drbrh-mn-2.html">About</a>



  </li><li><a href="archive.html">Archives</a>



  </li><li><a href="categories/index.html">Tags</a>



  </li><li><a href="http://feeds.feedburner.com/Shahinism">RSS</a>


</li>
        </ul></div>
      <div id="siteDescription">
        
        
        
      </div>
      <div id="coreContent" class="hfeed">
        

<div class="post hentry">
  <h5 class="postDate"><abbr class="publishd">
    ارسال شده: 2013-01-10 15:09
  </abbr></h5>
  <div class="postContent">
    <h3 class="entry-title"><a href="posts/blog13911021expect-dstyr-bhwsh-shm-dr-shl-skhrypth.html">expect دستیار باهوش شما در شل اسکریپت‌ها!</a></h3>
    
    <div class="entry-content">
      <p></p><p>اگر تا به حال شل اسکریپت نوشته باشید‌، اگر حد اعتیادتان به آن اندازه باشد که بخواهید هر کاری را آسان‌تر کنید‌، اگر تنبلی‌تان گرفته باشد که بعد از آسان شدن کار‌هایتان با یک شل اسکریپت‌، رمز‌های جاهای مختلف را به یاد آورید تا اسکریپت‌تان درست کار کند‌‌، یا آن‌قدر به مغزتان فشار آورید که جواب صحیح یک سوال اسکریپت را پیدا کنید‌، آن وقت‌ می‌توانید درک کنید که expect چه ابزار خارق‌العاده‌ای است.
کار expect خیلی ساده است‌، بعد از اجرای اسکریپت‌تان‌، منتظر می‌ماند که اتفاق خاصی رخ دهد‌، مثلا دستوری در اسکریپت از شما رمز بخواهد‌، آن وقت expect وارد میدان می‌شود و رمز را وارد می‌کند. یعنی دیگر نیازی نیست که شما دخالتی داشته باشید. اگر فکر می‌کنید که خوب این که کار سختی نیست و از این حرف‌ها که خوب اول باید بگویم که کور خوانده‌اید و دوم این که بی‌خیال ادامهٔ این متن شوید ;-)</p>
<p>حالا شیوهٔ عملکرد expect معلوم شد‌، بهتر است نگاهی بیاندازیم به وضعیت من. بنا به دلایل کاملا غیر عادی و نامعلومی‌، در کشوری کاملا آزاد‌، نیاز دارم که از sshuttle برای انجام برخی امور استفاده کنم. این برنامه برای انجام دادن درست کار‌هایش‌، نیاز به iptables دارد که خوب من دوست ندارم که کاربر عادی‌ام به آن دسترسی داشته باشد. پس همین دوست نداشتن من یک مرحلهٔ اضافه در فرآیند استفاده از sshuttle هزینه دارد. یعنی یک همچین چیزی:</p>
<div class="code"><pre>su

Vared Kardan Ramz

<span class="nb">cd</span> /home/shahin/bin/sshutle

./sshuttle ...

Vared Kardan Ramz
</pre></div>


<p>که خوب بعد از اولین تلاش کانکت نمی‌شود و باید دوباره دستور را بزنم و منتظر بمانم تا پرامپت رمز ssh ظاهر شود و باقی قضایا. خوب کمی سخت است. البته این را هم اضافه کنم که خوب می‌دانم می‌توانم کانکت بدون رمز ssh داشته باشم‌. می‌توانم دستور را درون یک path قرار دهم. می‌توانم‌، می‌توانم‌… ولی این روشی است که من کار می‌کنم ;-)</p>
<p>این است که دست به دامن expect می‌شوم و همچین اسکریپتی می‌نویسم:</p>
<div class="code"><pre><span class="c">#!/usr/bin/expect -f</span>



<span class="k">if</span> <span class="o">{[</span>llength <span class="nv">$argv</span><span class="o">]</span> !<span class="o">=</span> 5<span class="o">}</span> <span class="o">{</span>
    puts <span class="s2">"usage: ssh.exp client_root_pass username password server port"</span>
<span class="nb">exit </span>1

<span class="o">}</span>



<span class="nb">set </span>rootpass <span class="o">[</span>lrange <span class="nv">$argv</span> 0 0<span class="o">]</span>

<span class="nb">set </span>username <span class="o">[</span>lrange <span class="nv">$argv</span> 1 1<span class="o">]</span>

<span class="nb">set </span>password <span class="o">[</span>lrange <span class="nv">$argv</span> 2 2<span class="o">]</span>

<span class="nb">set </span>server <span class="o">[</span>lrange <span class="nv">$argv</span> 3 3<span class="o">]</span>

<span class="nb">set </span>port <span class="o">[</span>lrange <span class="nv">$argv</span> 4 4<span class="o">]</span>



<span class="nb">set </span>timeout -1



spawn su -c <span class="s2">"/home/shahin/bin/sshuttle/sshuttle --dns -r $username@$server:$port 0/0 -vv"</span>

match_max 100000

expect <span class="s2">"Password:*"</span>

send -- <span class="s2">"$rootpass\r"</span>



expect <span class="s2">"*?assword:*"</span>

send -- <span class="s2">"$password\r"</span>

send -- <span class="s2">"\r"</span>

expect eof
</pre></div>


<p>حالا همانطور که معلوم است کافی است همچین دستوری را تایپ کنم:</p>
<div class="code"><pre>./ssh.exp client_root_pass username password server port
</pre></div>


<p>حالا می‌شود این اسکریپت را بدون هیچ ضرر اضافه‌ای به path اضافه کرد و حالش را برد. برای این که بفهمید این اسکریپت چطور کار می‌کند راهنما‌های زیادی در اینترنت می‌یابید. man page خود برنامه هم می‌تواند کمک خوبی باشد. ضمن این که اگر اسکریپت نویسی بدانید‌، چیز زیادی برای یاد گرفتن پیش‌رویتان نیست ;-)</p>
    </div>
    <div class="postMeta">
      <div class="comments">
        
        
    
        <a href="posts/blog13911021expect-dstyr-bhwsh-shm-dr-shl-skhrypth.html#disqus_thread" data-disqus-identifier="cache/posts/blog13911021expect-dstyr-bhwsh-shm-dr-shl-skhrypth.html">Comments</a>
    

        
      </div>
    </div>
  </div>
</div>

<div class="post hentry">
  <h5 class="postDate"><abbr class="publishd">
    ارسال شده: 2013-01-02 13:00
  </abbr></h5>
  <div class="postContent">
    <h3 class="entry-title"><a href="posts/blog139110136-sl-blg-nwsy.html">۶ سال شاهینیسم</a></h3>
    
    <div class="entry-content">
      <p></p><p>شش سال گذشت‌. البته نه دقیقا همین امروز‌، ولی شش سال پیش‌، همین روز‌ها بود که اولین وبلاگ حرفه‌ایم را شروع کردم‌. البته اگر بشود اسمش را حرفه‌ای گذاشت‌. حداقلش آن موقع‌ها فکر می‌کردم که هست‌. این نوشتن‌ها یک سالی ادامه داشت‌، تا این که یک باره همه چیز به هم ریخت‌. دیگر نشد‌، یا بهتر بگویم نتوانستم مثل قبل بنویسم‌. من تنها نبودم‌، خیلی از وبلگ‌نویس‌های خوب آن موقع هم دیگر نمی‌نوشتند و هنوز هم نمی‌نویسند‌. ولی بعضی‌هاشان هنوز هم جزء بهترین‌هایند. موقع تمدید دامینم سر رسید و هویت دیجیتال آن روز‌هایم از بین رفت‌. در فاصلهٔ بین اولین وبلاگم تا شاهینیسم‌، چند باری تلاش کردم که باز هم بتوانم تجربهٔ اولم را تکرار کنم‌. نمی‌شد که نمی‌شد.
از وبلاگ‌ها جدا نشدم. وبلاگ خودم نبود‌، ولی گوگل ریدر بود. هرگز در اجتماعات خوب ظاهر نشدم. هنوز هم نمی‌توانم با اجتماعات کنار بیایم. در اوج دوران فیس‌بوک و توییتر‌، گوگل‌ریدر تنها جایی بود که واقعا از بودنش لذت می‌بردم‌. بعد‌ها اجتماعی‌تر شد‌، که بهتر بود. خیلی آدم‌ها را شناختم. تفکرات زیادی را دیدم‌، ولی لال بودم. حرف‌های زیادی داشتم که نمی‌توانستم بزنم. کم کم زده شدم. از آدم‌ها‌، از ابزار‌ها و از همه بدتر از قانون‌ها! مثلا در اوج دوران تحصیلم به سر می‌بردم‌، ولی بیشتر از آرزوهایم بدم آمده بود. کمی بعد‌تر‌، شاهینیسم شروع شد. اولش می‌خواستم فقط جایی باشد که نوشته‌های چند ساله‌ام را تویش جمع کنم. بعد‌تر وسواس بیشتری به خرج دادم. خودسانسوری کردم. ننوشتم‌، ننوشتم. کمی بعد پای لینوکس ریویو به میان آمد. تجربه‌ای که بعضا خیلی خسته کننده می‌شد‌، ولی نعمتی داشت که کمتر تجربه‌اش را داشتم. کار گروهی بود. یا حداقلش می‌خواست باشد.</p>
<p>دیگر شاهین‌، شاهین قبلی نبود. نمی‌توانست باشد. همانطور که می‌خواست شده بود. آن‌هایی که نوشته‌هایش را می‌خواندند می‌دید. یاد گرفته بود به حرف‌شان بیاورد. خیلی‌هاشان مثل اطرافیانم در دنیای واقعی بودند. با همان بچه بازی‌ها. با همان نق نق‌ها. خیلی‌های دیگر عدایش را در می‌آوردند که مثلا بهترند. اما خیلی‌ها هم بودند که واقعا عالی بودند. از آن‌هایی که آرزو می‌کنی یک ساعت کنارشان بنشینی و گپ بزنی. از آن‌هایی که دوست داری اجتماعت باشند.</p>
<p>امروز دیگر شاهین‌، منی شده که دارد سعی می‌کند نقابش را بردارد. هر چند خوب می‌داند که… . به هر حال‌، شش سال شد. شش سال تغییرم مبارک ;-)</p>
    </div>
    <div class="postMeta">
      <div class="comments">
        
        
    
        <a href="posts/blog139110136-sl-blg-nwsy.html#disqus_thread" data-disqus-identifier="cache/posts/blog139110136-sl-blg-nwsy.html">Comments</a>
    

        
      </div>
    </div>
  </div>
</div>

<div class="post hentry">
  <h5 class="postDate"><abbr class="publishd">
    ارسال شده: 2012-12-13 18:43
  </abbr></h5>
  <div class="postContent">
    <h3 class="entry-title"><a href="posts/blog13910923twlyd-khwdkhr-flsh-khrt-nglysy-bh-frsy.html">تولید خودکار فلش کارت انگلیسی به فارسی برای Anki با کمی شل اسکریپت</a></h3>
    
    <div class="entry-content">
      <p></p><p>حقیقتش آدم خیلی تنبلی هستم‌. آن‌قدر تنبل که گاها وقتی می‌توانم کارم را فقط با یک کمی کار بیشتر راحت کنم‌، کالیبر بالا مانع می‌شود و آن کار را هر چقدر هم تکراری و خسته کننده باشد انجام می‌دهم‌ (دروغ می‌گویم‌، حالش نباشد بی‌خیالش می‌شوم ;-)) دیروز در حین خواندن یک کتاب یودم که دیدم حجم لغت‌های انگلیسی‌ای که نمی‌دانم، در جملات کتاب دارد غوغا می‌کند‌. قبلا به مدل‌های مختلف سعی کرده‌ام که این لغت‌ها را یاد بگیرم‌. روی کاغذ ردیفشان کرده‌ام‌، جعبهٔ <a title="جعبهٔ لایتنر در ویکی پدیا" href="http://fa.wikipedia.org/wiki/%D8%AC%D8%B9%D8%A8%D9%87_%D9%84%D8%A7%DB%8C%D8%AA%D9%86%D8%B1" target="_blank">فلش کارت </a>مقوایی ساخته‌ام‌‌، چه می‌دانم روی یک تکه کاغذ نوشته‌ام‌! ولی هیچ‌کدام‌شان برایم عادت نشده‌اند‌. این می‌شود که کلا بعد از مدتی بی‌خیال این روش‌ها می‌شوم‌.
اما مدتی است که دوباره به <a title="anki official website" href="http://ankisrs.net/" target="_blank">Anki</a> روی آورده‌ام‌. آن وقت‌ها نتوانسته بودم که نصبش کنم و خورده بود توی ذوقم‌. ضمن این که بعد‌ها هم پس از نصب چند باگ کوچک به فنایم داده بود‌. ولی الان مدتی می‌شود که با هم رفیق شده‌ایم‌. ولی خوب چون همانطور که قبلا ذکرش رفت کالیبر بالاست‌، خودم حال کارت درست کردن ندارم. این است که از فلش کارت‌های خوبی که ایمان<a title="صفحهٔ دانلود فلش کارت‌ها" href="http://flashcard.linuxreview.ir/get-flashcard/" target="_blank"> آماده می‌کند</a> استفاده می‌کنم‌.</p>
<p>ولی خوب‌، ایمان هم کالیبرش بالاست‌. شاید هم کمال همنشین… این است که بعد از یک مدتی که خیلی ذوق داشت و همه مدل فلش کارت آماده می‌کرد‌، چون سختش بود‌، کم کم فرمت‌های آماده شده را آنقدر کم کرد که این اواخر دیگر تنها kvtml آماده می‌کرد‌. فرمتی که آماده کردنش خیلی آسان‌تر از باقی قضایا بود‌، ولی مال نرم‌افزار بسیار به درد نخور kwordquiz میزکار KDE بود! این بود که دو سه هفته پیش‌، این ایده به سرم افتاد که اول کمی از کار ایمان کم کنم‌! بندهٔ خدا زحمت زیادی می‌کشد و به هر حال حیف است که فقط مصرف کننده باشم‌. این شد که با پایتون اسکریپتی برایش نوشتم که kvtml‌ها را خیلی راحت به anki تبدیل کند‌. ذکر خیر این اسکریپت را خودش <a title="kvtml 2 anki in emanlog" href="http://emanlog.com/?p=292" target="_blank">کرده‌</a>.</p>
<p>معنی این اسکریپت قبلی این بود که حالا حالاها خوراک اضافه خواهم داشت‌. ولی حقیقتش کلمه‌های ایمان‌، حداقل تا این‌جایی که من دیده‌ام‌، اکثریتشان‌ در سطح من نیست‌. اگر هم باشد من خودم خیلی خیلی بیشتر از آن‌ها را در کتاب‌ها و مطالبی که روزانه می‌خوانم می‌بینم! مساله این‌جاست که از روی تنبلی‌، فقط به زور دیکشنری (mdic روی میزکار، google translate روی اینترنت و mobidic روی موبایل) ترجمه‌شان می‌کنم و بعد از چند جمله معنی‌شان از یادم می‌پرد‌. خسته کننده است‌. این طور نیست؟</p>
<p>خوب کمی با خودم دو دو تا چهارتا می‌کنم و یادم می‌آید که روی آن اسکریپت تبدیل kvtml دوست خوبم anki یک فرمت متنی خیلی تمیزی را به عنوان ورودی می‌گرفت و فلش کارتش می‌کرد‌. (اصلا آن اسکریپت بر همین مبنا کار می‌کند) یک همچین نحوی:</p>
<div class="code"><pre>English;انگلیسی
</pre></div>


<p>که البته می‌توان بهش فایل‌های چند رسانه‌ای هم چسباند و یا با HTML خوشگلش کرد‌. خوب این یعنی می‌شود هر وقت که کلمه‌ای ترجمه می‌کنم‌، ترمینالم را باز کنم و مثلا از یک همچین دستوری استفاده کنم:</p>
<div class="code"><pre><span class="nb">echo</span> <span class="s2">"English;انگلیسی"</span> &amp;gt;&amp;gt; deck.txt
</pre></div>


<p>یا شایدم همیشه یک ادیتور زیر دستم باز بگذارم‌! ولی نه فکر کنم همان اولی بهتر است‌ (چون ترمینال در دسترس‌تر است). ولی خوب این این‌قدر‌ها هم خوشگل نیست‌. ضمن این که مثل فلش کارت‌های ایمان صدا و عکس ندارد‌. حالا عکس به کنار‌، تلفظ برای من از نان شب واجب‌تر است‌. بعضی کلمات آن‌قدر به چشمم سخت می‌آیند که اصلا نمی‌خوانمشان D:</p>
<p>خوب تلفظ را هم می‌شود مشکلش را با espeak حل کرد‌ (هر چند صدای روباتیکش خیلی نچسب است!). جهنم‌، شروع می‌کنم به نوشتن یک اسکریپت‌. این ایده‌، در میانهٔ راه آن‌قدر این در و آن در می‌خورد‌. آن‌قدر از ابزار‌ها و وسایلی که بقیه نوشته‌اند توش استفاده می‌شود که می‌شود اسکریپتی که اگر اینترنت دم دستش باشد‌، خودش عبارت وارد شده را با استفاده از google translate ترجمه می‌کند و تلفظ google translate را می‌چسباند تنگش و کار را تمام می‌کند‌.</p>
<p>چون می‌دانم همه حوصلهٔ خواندن نکات فنی اسکریپت را ندارند‌، این پست را در دو بخش می‌نویسم‌. بخش اول‌، برای کاربرانی که فقط می‌خواهند از آن استفاده کنند‌، و بخش دوم برای اشاره به نکات فنی کار ;-)</p>
<p></p><h5>معرفی:</h5>
<p>این اسکریپت برای اجرا به fribidi, ffmpeg, curl و html2text نیاز دارد‌. سه تای اول که عموما وضع و حال‌شان مشخص است‌. اما این آخری یک اسکریپت پایتون است که می‌توانید از مخازن‌تان نصب کنید‌. ولی من پیشنهاد می‌کنم به جای آن distribute یا pysetuptools پایتون را نصب کنید و پس از آن با دستور زیر سر و ته این اسکریپت را هم بیاورید:</p>
<div class="code"><pre>sudo pip install html2text
</pre></div>


<p>دلیلش هم ساده است‌. مخازن پایتون خیلی سریع‌تر از مخازن توزیع‌تان به روز می‌شوند و صد البته در آخر کار مدیریت این بسته‌ها با آن‌ها آسان‌تر است‌! حالا اسکریپت را از <a title="fcgenerator on github" href="https://github.com/shahinism/Scripts/blob/master/Shell/fcgenerator.sh" target="_blank">این‌جا</a> دانلود کنید و به صورت زیر چشم‌تان را به جمالش روشن کنید:</p>
<div class="code"><pre>chmod +x fcgenerator.sh

./fcgenerator.sh -w <span class="s2">"Some english word"</span> -d firstDeck
</pre></div>


<p>مقدار Some english word که به اپراتور ‎-w نسبت داده شده‌، همان عبارت انگلیسی‌ای است که می‌خواهیم ترجمه‌اش کنیم‌. مقدار firstDeck هم اسم Deckای (مجموعه فلش کارت) که می‌خواهیم این لغت به آن اضافه شود است‌. اگر اینترنت‌تان وصل است که برنامه مثل پلنگ کارش را انجام می‌دهد و فایل‌ها را تولید می‌کند‌. اکر هم نه که می‌توانید به روش‌های دیگری کلمه را اضافه کنید‌.</p>
<p>مثلا فرض کنید که شما از ترجمهٔ google translate حال نمی‌کنید‌. خوب راحت است‌. کافی است که با استفاده از اپراتور ‎-t ترجمهٔ خودتان را به لغت بچسبانید‌. همین‌طور می‌توانید به جای تلفظ گوگل‌، از espeak استفاده کنید‌. برای این کار هم از اپراتور ‎-e استفاده می‌کنید. طرز کارش ساده است‌، این‌طور نیست؟</p>
<p>بعد از اجرای فرمان بالا اسکریپت برای ما یک فایل firstDeck.txt و یک دایرکتوری firstDeck.media ساخته‌. اگر کلمات دیگری هم داشتید و خواستید به این فلش کارت اضافه کنید‌، کافیست به دایرکتوری که این فایل‌ها در آن قرار دارند بروید و فقط مقدار ‎-w دستور را با کلمهٔ جدید‌تان عوض کنید‌.</p>
<p>حالا نوبت نصب Deck جدید‌تان روی Ankiاست‌. اگر Deck‌های شما هم در مسیر ‎~/.anki/decks قرار دارد (اگر توزیع‌تان خوشمزگی نکرده و جای دیگر نریخته باشد‌، بعید می‌دانم این مسیر فرق کند) می‌توانید با دستور زیر دایرکتوری مدیا را در این مسیر کپی کنید:</p>
<div class="code"><pre>./fcgenerator.sh -i firstDeck
</pre></div>


<p>اگر هم نه که دستی کپی کنید! حالا Anki را باز کنید‌ و از منوی File گزینهٔ Import را انتخاب کنید‌. در قسمت نام Deck همان چیزی را بنویسید که برای اپراتور ‎-d قرار دادید (در این‌جا firstDeck) و سپس فایل firstDeck.txt را به آن بخورانید‌. تمام شد‌. فلش‌کارت‌های جدید‌تان آماده‌اند‌.</p>
<p>طرز کار اسکریپت خیلی ساده است‌. دیگر باقی‌اش به خودتان بستگی دارد که چطور از آن استفاده می‌کنید‌. می‌توانید برای راحتی کار آن را به PATHتان انتقال دهید و یا یک alias برای خیلی راحت‌تر شدنش تعریف کنید‌. یا حتی می‌توانید یک اسکریپت کوچک دیگر بنویسید که برای لیستی از لغات این فرمان را ایجاد کند و به صورت خودکار یک لیست بلند بالا از لغات + ترجمه + تلفظ‌شان داشته باشید‌! البته جنبه هم در کنارش خوب است‌. با Google طرفید‌. همچین هم زیاده روی نکنید که IPتان را به خاطر فرستادن درخواست‌های زیادی بلاک کند‌، یا کلا در گوگل ترنسلیت را گل بگیرد! ها در ضمن‌، می‌توانید با استفاده از ‎-T (به چه زبانی) و ‎-F (از چه زبانی) به جای حالت پیش‌فرض انگلیسی به فارسی از زبان‌های دیگر هم استفاده کنید.</p>
<h5>چطور کار می‌کند؟</h5>

<p>خوب اکثر دستورات اگر سواد شل اسکریپتینگ داشته باشید‌، سر راست‌اند‌. من در این‌جا فقط به چیز‌های جالبی که از کد‌های دیگران بهره گرفتم اشاره می‌کنم‌. یکی از خوشگل‌ترین‌شان برایم این تابع بود:</p>
<div class="code"><pre><span class="k">function </span>deps<span class="o">(){</span>

<span class="nv">DEPENDENCIES</span><span class="o">=</span><span class="nv">$@</span>

<span class="nv">deps_ok</span><span class="o">=</span>YES

<span class="k">for </span>dep in <span class="nv">$DEPENDENCIES</span>

<span class="k">do</span>

<span class="k">if</span> ! which <span class="nv">$dep</span> &amp;amp;&amp;gt;/dev/null; <span class="k">then</span>

<span class="nb">echo</span> <span class="s2">"$dep is not installed. please install it and try again."</span>

<span class="nv">deps_ok</span><span class="o">=</span>NO

<span class="k">fi</span>

<span class="k">done</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">"$deps_ok"</span> <span class="o">==</span> <span class="s2">"NO"</span> <span class="o">]]</span>; <span class="k">then</span>

<span class="nb">echo</span> -e <span class="s2">"Unmet dependencies ^"</span>

<span class="nb">echo</span> -e <span class="s2">"Aborting!"</span>

<span class="nb">exit </span>1

<span class="k">else</span>

<span class="k">return </span>0

<span class="k">fi</span>

<span class="o">}</span>
</pre></div>


<p>خوب می‌دانم چیز ساده‌ای است. ولی حقیقتش من عقلم نمی‌رسید که می‌توان به این خوشگلی پیش‌نیاز‌های اسکریپت را بررسی کرد‌. این اسکریپت را از <a title="bash support function check dependencies" href="http://www.snabelb.net/content/bash_support_function_check_dependencies" target="_blank">این لینک</a> برداشتم و کمی دستکاری‌اش کردم تا به اسکریپت من بیاید‌.</p>
<p>بخش بعدی ماجرا‌، هیولا‌ترین قسمت اسکریپت است‌. Google مثل همیشه احمق‌بازی در آورده و ما را از داشتن یک API ساده محروم کرده‌. ولی خوب این مرحمت گوگل باعث نشده که <a title="access google translate from a terminal" href="http://crunchbang.org/forums/viewtopic.php?id=17034" target="_blank">این دوست </a>ندیده و نشنیدهٔ عزیزمان دست از انگولک گوگل و نجات ما بردارد‌.</p>
<div class="code"><pre><span class="nv">result</span><span class="o">=</span><span class="k">$(</span>curl -s -i --user-agent <span class="s2">""</span> -d <span class="s2">"sl=$FROMT"</span> -d <span class="s2">"tl=$TARGETT"</span> --data-urlencode <span class="s2">"text=$WORD"</span> http://translate.google.com<span class="k">)</span>

<span class="nv">encoding</span><span class="o">=</span><span class="k">$(</span>awk <span class="s1">'/Content-Type: .* charset=/ {sub(/^.*charset=["'</span><span class="se">\'</span><span class="s1">']?/,""); sub(/[ "'</span><span class="se">\'</span><span class="s1">'].*$/,""); print}'</span> &amp;lt;&amp;lt;&amp;lt;<span class="s2">"$result"</span><span class="k">)</span>

<span class="nv">TRANSLATION</span><span class="o">=</span><span class="k">$(</span>iconv -f <span class="nv">$encoding</span> &amp;lt;&amp;lt;&amp;lt;<span class="s2">"$result"</span> | awk <span class="s1">'BEGIN {RS="</span>



<span class="s1">"};/&amp;lt;span[^&amp;gt;]* id=["'</span><span class="se">\'</span><span class="s1">']?result_box["'</span><span class="se">\'</span><span class="s1">']?/'</span> | html2text<span class="k">)</span>
</pre></div>


<p>مساله ساده است‌. ما صفحه وبی داریم که می‌توانیم در جای خاصی از آن بگوییم که ترجمهٔ چه کلمه‌ای را می‌خواهیم و این صفحه در مقابل در جای خاص دیگری از خودش ترجمهٔ کلمه را به ما نشان می‌دهد‌. اسم این صفحه http://translate.google.com است که چون از متد GET (اگر درست یادم باشد) استفاده می‌کند‌، می‌توان با تغییر متغیر‌هایش نتیجهٔ کلمات مختلف را در آن دید‌. ضمن این که اضافه کنم که این دوستمان از روش جالبی برای پیدا کردن این متد‌ها (غیر از نگاه کردن به URL استفاده کرده) که هر چند به نظرم استفاده‌اش در این‌جا بی‌خود است‌، ولی کاربرد‌های باحال‌تری می‌توان برایش پیدا کرد. فعلا برای فهمیدن ماجرا از زبان خودش به صفحه‌ای که در بالا گفتم رجوع کنید‌!</p>
<p>در ادامه کافیست که از صفحه‌ای که گرفته‌ایم‌، آن المنت خاصی که می‌خواهیم را جدا کنیم (جایی که ترجمه نشان داده می‌شود) و به html2text بخورانیم که نهایتا فقط متن به ما نشان داده شود‌. ولی از آن‌جا که html2text فقط یک فرمت یونیکد را می‌فهمد و فرمت کدینگ صفحهٔ نتیجهٔ گوگل با توجه به زبان پاسخ متفاوت است (چرا؟) با استفاده از iconv سعی می‌کند که کدینگ درست را به خوردش بدهد‌. و حالا چون نمی‌خواهد هر بار دستی وارد کند که از کدام کدینگ تبدیل کن‌، با awk سر صفحه را می‌خواند و کدینگ صفحه را پیدا می‌کند ;-)</p>
<p>و آخرین بخش ماجرا مربوط می‌شود به دانلود صدا. برای این کار از <a title="google translate download sound" href="https://gist.github.com/873364" target="_blank">این اسکریپت</a> کمک گرفتم‌. ولی چون نمی‌خواستم نتیجهٔ کار خیلی شلخته شود (دو فرمت متفاوت در صورت استفاده از espeak و google translate در کنار هم) با ffmpeg کلیه فرمت‌ها را به ‎.ogg تغییر دادم که آقایمان نیز از ما راضی باشد.</p>
    </div>
    <div class="postMeta">
      <div class="comments">
        
        
    
        <a href="posts/blog13910923twlyd-khwdkhr-flsh-khrt-nglysy-bh-frsy.html#disqus_thread" data-disqus-identifier="cache/posts/blog13910923twlyd-khwdkhr-flsh-khrt-nglysy-bh-frsy.html">Comments</a>
    

        
      </div>
    </div>
  </div>
</div>


<div class="pageNav">
  
  <div class="prev">
    <a href="index-3.html">← ارسال‌های جدید‌تر</a>
  </div>
  
  
  <div class="next">
    <a href="index-5.html">پست‌های قدیمی‌تر →</a>
  </div>
  
</div>


    
        <script type="text/javascript">var disqus_shortname="shahinism";(function(){var a=document.createElement("script");a.async=true;a.type="text/javascript";a.src="http://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)}());</script></div>
    </div>
    <div id="footer">
      <h5>Elsewhere</h5>
      <ul class="elsewhere"><a href="https://plus.google.com/117086743723717964659/posts">Google Plus</a> |
<a href="http://www.goodreads.com/user/show/4795670-shahin-azad">Good Reads</a> |
<a href="https://identi.ca/shahinism">Identica</a> |
<a href="http://twitter.com/shahinism">Twitter</a> |
<a href="https://github.com/shahinism">Github</a>
      </ul><div class="footerContent">
        
<!-- Custom search -->
<form method="get" id="searchform" action="http://duckduckgo.com/">
<div id="search">
<input type="hidden" name="sites" value="http://shahinism.com"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="جستجو…"><input type="submit" id="searchsubmit" value="DDG Search"></div>
</form>
<!-- End of custom search -->

        <p> Contents © 2013 <a href="mailto:ishahinism@gmail.com">شاهین آزاد</a> - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a> </p>
        <p> Design by <a href="http://themes.jimbarraud.com/manifest/">Jimbarraud</a> + some <a href="http://shahinism.com">Shahinism</a> twists. </p>
      </div>
    </div>
    
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23874419-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></body></html>